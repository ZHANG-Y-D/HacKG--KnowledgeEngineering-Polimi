define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],(function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideo=t.PreviewVideoProps=void 0,r=n.__importDefault(r),Object.defineProperty(t,"PreviewVideoProps",{enumerable:!0,get:function(){return i.PreviewVideoProps}}),t.PreviewVideo=function(e){var t=e.sourceContext,s=e.hidePageChrome;return t!==a.PreviewSourceContext.EmbeddedSharedLinkFile&&!s?r.default.createElement(o.PreviewVideoComments2,n.__assign({},e)):r.default.createElement(i.PreviewVideoBasic,n.__assign({},e))}})),define("modules/clean/react/previews/error/preview_error",["require","exports","tslib","react","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/components/css","modules/clean/file_store/utils","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/fullscreen_view","modules/clean/react/previews/error/view","modules/clean/web_timing_logger","modules/clean/react/previews/error/upsell"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewError=t._PreviewError=void 0,r=n.__importDefault(r),p=n.__importStar(p);var f=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){(p.set_tti_exclusion_flow("failed previews not included"),p.mark_time_to_view(),p.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===c.ErrorType.PendingUploadError&&this.props.shareToken)&&new o.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()},Object.defineProperty(t.prototype,"allowOpenInApp",{get:function(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent},enumerable:!1,configurable:!0}),t.prototype.logPreviewSupportDenied=function(){this.props.errorType!==c.ErrorType.LoadError&&this.props.errorType!==c.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(l.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})},t.prototype.render=function(){var e=i.Emstring.em_snippet(s.getFilename(this.props.file),this.props.maxFilenameEmLength);return this.props.errorType===c.ErrorType.UpsellError?r.default.createElement(m.PreviewUpsellErrorView,{areActionablesEnabled:this.props.areActionablesEnabled,allowOpenInApp:this.allowOpenInApp,count:this.props.count,errorType:this.props.errorType,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,filePreviewSession:this.props.filePreviewSession,filename:e,index:this.props.index,onNext:this.props.onNext,onPrevious:this.props.onPrevious,preview:this.props.preview,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sharedLinkInfo:this.props.sharedLinkInfo,shouldDisplayToolbar:this.props.shouldDisplayToolbar,sizeClass:this.props.sizeClass,user:this.props.user,encryptionOptions:this.props.encryptionOptions}):this.props.isFullscreen?r.default.createElement(u.PreviewErrorFullscreenView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e})):r.default.createElement(d.PreviewErrorView,n.__assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e}))},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1},t})(r.default.Component);t._PreviewError=f;var g=a.requireCssWithComponent(f,["/static/css/preview_error-vflujfmWk.css"]);t.PreviewError=g})),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","react","react-redux","comments2/components/annotation_utils","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/video_annotations/annotation_helper","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/clean/react/previews/video/preview_video_basic"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideoComments2=t.ConnectedPreviewVideoComments2=t.PreviewVideoBasicWithPlayerIntegration=void 0;var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.seekToActivatedTimecode()},t.prototype.componentDidUpdate=function(e){e.activatedTimecodeThread===this.props.activatedTimecodeThread||this.isPendingThread(e)||this.seekToActivatedTimecode()},t.prototype.isPendingThread=function(e){var t,n;return(null===(t=e.activatedTimecodeThread)||void 0===t?void 0:t.pending)||(null===(n=this.props.activatedTimecodeThread)||void 0===n?void 0:n.pending)},t.prototype.seekToActivatedTimecode=function(){var e=this.props.activatedTimecodeThread;if(e){var t=0;t=o.isVideoAnnotation(e.annotation)&&e.annotation.timeSec?e.annotation.timeSec:c.VideoAnnotationHelper.unitConvertDomainObjectTimeToSeconds(e.annotation.time),d.videoPreviewEventEmitter.emit(u.EventTypes.SEEK_POSITION_AND_PAUSE,t)}},t.prototype.render=function(){var e=this.props,t=e.onTimeUpdate,i=e.playerIntegrationEnabled;return r.default.createElement(p.PreviewVideoBasic,n.__assign({},this.props,{onTimeUpdate:i?t:void 0}))},t})((r=n.__importDefault(r)).default.PureComponent);t.PreviewVideoBasicWithPlayerIntegration=m,t.ConnectedPreviewVideoComments2=i.connect((function(e){var t=l.getIsPlayerIntegrationEnabled(e);return{showOnboarding:l.getShowOnboardingOnVideo(e),framePreciseCommentsEnabled:l.getFramePreciseCommentsEnabled(e),frameRate:l.getFrameRate(e),playerIntegrationEnabled:t,activatedTimecodeThread:t?l.getActivatedTimecodeThread(e):void 0}}),{onTimeUpdate:a.Actions.updatePlayerCurrentTime,onGutterClick:a.Actions.deactivateAllThreads})(m);var f=(function(e){function o(t){var n=e.call(this,t)||this;return n.store=s.getStoreForComments2(),n}return n.__extends(o,e),o.prototype.render=function(){return r.default.createElement(i.Provider,{store:this.store},r.default.createElement(t.ConnectedPreviewVideoComments2,n.__assign({},this.props)))},o})(r.default.PureComponent);t.PreviewVideoComments2=f})),define("modules/clean/react/workflows/markup/api",["require","exports","modules/clean/react/file_viewer/feedback_form/types","modules/clean/react/file_viewer/feedback_form/api"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitMarkupFeedback=void 0,t.submitMarkupFeedback=function(e,t,i){return r.submitFeedback(n.SubmitFeedbackProductName.DROPBOX_MARKUP,e,t,i)}})),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","keymaster","classnames","react","lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n","modules/clean/react/sticky_position"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewZoomContainer=void 0,r=n.__importDefault(r),i=n.__importDefault(i),o=n.__importDefault(o),a=n.__importStar(a),s=n.__importDefault(s);var g="",_="previewzoomcontainer",h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={controlsHidden:!1},t.flipNext=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipNext&&t.props.onFlipNext(),l.logUserAction(c.UserAction.FlipNext,e)},t.flipPrevious=function(e){void 0===e&&(e=c.UserActionContext.LightboxToolbar),t.props.onFlipPrevious&&t.props.onFlipPrevious(),l.logUserAction(c.UserAction.FlipPrevious,e)},t.onClick=function(e){e.target===e.currentTarget&&(e.preventDefault(),t.onCloseFactory({},c.UserActionContext.LightboxFrame))},t.onMouseMove=function(e){0===s.default(e.target).parents(".preview-toolbar-overlay").length?t.startControlsTimer():clearTimeout(t.controlsHideTimer)},t.onCloseFactory=function(e,n){void 0===e&&(e={}),void 0===n&&(n=c.UserActionContext.LightboxCloseButton),l.logUserAction(c.UserAction.ToggleFullscreenOff,n),t.props.onClose()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),r.default("esc",_,(function(){e.onCloseFactory({},c.UserActionContext.Keyboard)})),null!=this.props.onZoomOut&&r.default("space",_,this.props.onZoomOut),g=r.default.getScope(),r.default.setScope(_),this.startControlsTimer()},t.prototype.componentWillUpdate=function(){r.default.setScope(_)},t.prototype.componentWillUnmount=function(){r.default.clearScope(_),r.default.setScope(g),clearTimeout(this.controlsHideTimer)},t.prototype.startControlsTimer=function(){var e=this;this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout((function(){e.hideControls()}),3e3)},t.prototype.showControls=function(){this.setState({controlsHidden:!1})},t.prototype.hideControls=function(){this.setState({controlsHidden:!0})},t.prototype.renderFlippableControls=function(){return this.props.fileCount?o.default.createElement(u.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null},t.prototype.renderControls=function(){var e=this.props,t=e.renderZoomControls,n=e.scaleFactor,r=i.default("preview-toolbar-container",{hidden:this.state.controlsHidden});return o.default.createElement("div",{className:r,ref:"previewZoomerToolbarContainer"},o.default.createElement("div",{className:"preview-toolbar-overlay-container"},o.default.createElement("div",{className:"preview-toolbar-overlay"},o.default.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),t?o.default.createElement("div",{className:i.default("toolbar-button-entry","zoom-out",{disabled:this.props.zoomOutDisabled}),onClick:this.props.onZoomOut},o.default.createElement(d.Sprite,{alt:m.intl.formatMessage({id:"pK5LJK",defaultMessage:"Zoom out"}),group:"web",name:"zoomout"})):null,t?o.default.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer",onClick:this.props.onViewActualSize},o.default.createElement(p.TitleBubble,{content:m.intl.formatMessage({id:"Jzzn4t",defaultMessage:"View actual size"}),position:f.StickyPosition.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},o.default.createElement("span",null,Math.floor(100*(n||0)),"%"))):null,t?o.default.createElement("div",{className:i.default("toolbar-button-entry","zoom-in",{disabled:this.props.zoomInDisabled}),onClick:this.props.onZoomIn},o.default.createElement(d.Sprite,{alt:m.intl.formatMessage({id:"T8BfJ2",defaultMessage:"Zoom in"}),group:"web",name:"zoom"})):null))))},t.prototype.renderClose=function(){var e=i.default("preview-zoomer-close",{hidden:this.state.controlsHidden});return o.default.createElement("span",null,o.default.createElement("button",{"aria-label":m.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},o.default.createElement(d.Sprite,{alt:m.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),group:"web",name:"xclose"})))},t.prototype.render=function(){var e=i.default("preview-zoomer-container",{"zoomer-drag-disabled":this.props.dragDisabled});return o.default.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())},t.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},t})(o.default.Component);t.PreviewZoomContainer=h})),define("modules/clean/react/previews/preview_html",["require","exports","tslib","react","react-dom","file-viewer/core/index","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/file_viewer/logging","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/toolbar_flip_buttons","modules/clean/react/file_viewer/full_screen_helpers","file-viewer/toolbar/index","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/previews/print_helpers","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/previews/preview_toolbar_frame_messenger","modules/core/i18n"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P){"use strict";var C;Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewHTML=void 0,r=n.__importDefault(r),i=n.__importStar(i),p=n.__importStar(p),m=n.__importStar(m);var M,k=["failed","viewer-ready","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent","tab-switch","content-select"];(function(e){e.ClearMouseTracking="clear-mouse-tracking",e.EnableRegionCreation="enable-region-creation",e.EnterFullscreen="enter-fullscreen",e.ExitViewerFullscreen="exit-viewer-fullscreen",e.PageDown="page-down",e.PageUp="page-up",e.SetCurrentPage="set-current-page",e.PreviewToolbarMounted="preview-toolbar-mounted",e.Print="print",e.ScreenDown="screen-down",e.ScreenUp="screen-up",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out"})(M||(M={}));var T=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getIframeProps=function(){var e={title:t.props.filename,name:"preview-content",type:"text/html",src:t.getIframeSrc(),sandbox:"",className:"previewhtml",ref:t.setRefIframe};return t.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},t.handleTrustedMessageFromChild=function(e){if(t.isHtmlFrameMessage(e)){var n=e.action,r=e.parameters;switch(n){case"failed":t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderFailed);var i=o.RivieraStatus.Unknown;r&&(i=r.rivieraStatusCode),t.props.onError&&t.props.onError(a.mapRivieraStatusToErrorType(i));break;case"viewer-ready":t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess(),t.props.isFullscreen?t.frameMessenger.postMessageToChildren("enter-fullscreen"):t.frameMessenger.postMessageToChildren("exit-viewer-fullscreen"),t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&t.frameMessenger.postMessageToChildren("disable-download"),t.shouldIncreaseTabHeightForExcel()&&t.frameMessenger.postMessageToChildren("increase-tab-height");break;case"exit-parent-fullscreen":_.exitFullScreen(s.UserActionContext.Unknown);break;case"get-keydown-keys-handled-by-parent":t.postKeysHandledByParent();break;case"tab-switch":var l=null!=(null==r?void 0:r.tabId)?{tab_index:r.tabId}:void 0;c.logUserAction(s.UserAction.SwitchWorkbookTab,s.UserActionContext.Browser,l);break;case"content-select":l=null!=(null==r?void 0:r.tabId)?{tab_index:r.tabId}:void 0;c.logUserAction(s.UserAction.SelectWorkbookContent,s.UserActionContext.Browser,l)}}},t.handleIframeLoad=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadSucceeded),t.props.usesFrameMessenger||(t.markWebTiming(),t.logFilePreviewEvent(s.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess())},t.handleIframeError=function(){t.logFilePreviewEvent(s.EventType.FilePreviewDownloadFailed)},t.setRefIframe=function(e){t.iframe=e},t.printDocument=function(e){t.frameMessenger.postMessageToChildren(M.Print,{context:e})},t.keyboardBindings=[y.hydrateKeyboardBinding({keyboardEventCriteria:{which:S.Key.P},callback:function(){return t.printDocument(s.UserActionContext.Keyboard)}})],t}return n.__extends(t,e),t.prototype.getIframeSrc=function(){var e=f.URI.parse(this.props.src);return this.props.isExcel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:s.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()},t.prototype.shouldIncreaseTabHeightForExcel=function(){return this.props.isExcel&&m.is_mobile_or_tablet()},t.prototype.isHtmlFrameMessage=function(e){return k.includes(e.action)},t.prototype.logFilePreviewEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},t.prototype.postKeysHandledByParent=function(){this.frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:A})},t.prototype.markWebTiming=function(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),p.mark_time_to_view(),p.mark_time_to_interactive()},t.prototype.componentDidMount=function(){this.logFilePreviewEvent(s.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(s.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new l.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,k),this.frameMessenger.startListening(),this.postKeysHandledByParent());var e=i.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError},t.prototype.componentWillUnmount=function(){this.props.usesFrameMessenger&&this.frameMessenger.stopListening()},t.prototype.render=function(){var e=this,t={};m.iOS&&(t=a.iOSIframeScrollStyles());var i=this.props,o=i.count,l=i.index,c=i.isFullscreen,p=i.isExcel,f=i.sharePermission,y=i.sizeClass,S=i.onClickNext,C=i.onClickPrevious;return r.default.createElement("div",{className:"preview-content",style:t},r.default.createElement("iframe",n.__assign({},this.getIframeProps())),r.default.createElement(u.PreviewToolbar,{elevateToolbar:p,isFullscreen:c,isHidden:y===d.SizeClass.Small,fadeController:function(e){var t=e.fadeIn,n=e.fadeOut;return r.default.createElement(E.PreviewToolbarFrameMessenger,{activeMouse:t,idleMouse:n})}},r.default.createElement(g.ToolbarFlipButtons,{index:l,count:o,onClickPrevious:C,onClickNext:S}),r.default.createElement(h.FullScreenButton,{className:"toolbar-button-entry",intl:P.intl,onClick:function(){return _.toggleFullScreen(c,s.UserActionContext.Toolbar)}}),r.default.createElement(v.PreviewToolbarButton,{className:"print","data-test":"print",disabled:!b.canPrint(f),spriteGroup:"web",spriteName:"print",tooltip:b.getPrintTooltip(f),onClick:b.canPrint(f)?function(){return e.printDocument(s.UserActionContext.Toolbar)}:function(){}}),r.default.createElement(w.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings})))},t.defaultProps={usesFrameMessenger:!0},t})(r.default.Component);t.PreviewHTML=T;var A=((C={})[S.Key.Escape]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.Enter]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.Space]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.PageUp]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.PageDown]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.LeftArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.UpArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.RightArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.DownArrow]={altKey:!0,ctrlKey:!0,metaKey:!0},C[y.ExtraKeyCodes.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.F]={altKey:!1,ctrlKey:!0,metaKey:!0},C[S.Key.P]={altKey:!0,ctrlKey:!0,metaKey:!0},C[y.ExtraKeyCodes.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},C[y.ExtraKeyCodes.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},C[y.ExtraKeyCodes.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},C[y.ExtraKeyCodes.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.PlusSign]={altKey:!0,ctrlKey:!0,metaKey:!0},C[S.Key.Dash]={altKey:!0,ctrlKey:!0,metaKey:!0},C)})),define("modules/clean/react/previews/preview_image",["require","exports","tslib","classnames","react","react-redux","modules/clean/analytics","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/comments2/components/annotations/loadable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core/index","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/components/css","spectrum/dimensions/index","file-viewer/preview_image/index","modules/clean/file_store/utils","modules/clean/react/previews/toolbar_flip_buttons","file-viewer/toolbar/index","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/file_viewer/file_conversion/utils","file-viewer/assets-metaserver","modules/clean/react/previews/print_helpers","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/file_viewer/logging","modules/clean/react/watermarking/watermarking_layer","modules/clean/react/workflows/markup/markup_layer","modules/core/i18n"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x,D,R,N,L,U,B,W){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewImage=t._PreviewImage=void 0,r=n.__importDefault(r),i=n.__importDefault(i),s=n.__importDefault(s),c=n.__importStar(c),b=n.__importStar(b),S=n.__importStar(S);var V=v.resolveAsset.bind(null,O.assets);function K(){}var j=(function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e.imgLoaded=!1,e.state={},e.logTTI=function(){e.props.filePreviewSession&&e.props.filePreviewSession.markPrimaryEvent(),S.mark_time_to_view(),S.mark_time_to_interactive()},e.logRenderSuccess=function(){e.imgLoaded||(e.imgLoaded=!0,e.logFilePreviewEvent(d.EventType.FilePreviewDownloadSucceeded),e.logFilePreviewEvent(d.EventType.FilePreviewRenderSucceeded),e.props.setRenderStatusSuccess(),null!=e.props.onLoad&&e.props.onLoad())},e.onImageDoubleClick=function(){e.shouldDisableZoom()&&e.props.sizeClass!==y.SizeClass.Small&&e.openFullscreen()},e.openFullscreen=function(){null!=e.props.isFullscreen&&g.enterFullScreen({})},e.logRenderFailure=function(){var t=function(t){var n={};void 0!==t&&(n.rivieraStatusCode=t.toString()),e.logFilePreviewEvent(d.EventType.FilePreviewDownloadFailed,n),e.props.onError&&e.props.onError(h.ErrorType.LoadError,t)};e.rivieraStatusCodeRequest=_.fetchRivieraStatusCode(e.props["preview-url"],t,t)},e.onZoomIn=function(){e.zoomWithMultiplier(1.25),p.logUserAction(d.UserAction.ZoomIn,d.UserActionContext.Toolbar)},e.onZoomOut=function(){e.zoomWithMultiplier(.8),p.logUserAction(d.UserAction.ZoomOut,d.UserActionContext.Toolbar)},e.onZoomOriginalOrFit=function(){var t=e.state,n=t.scaleFactor,r=t.fitScaleFactor;e.setState({scaleFactor:n===r?1:r})},e.onPrint=function(t){c.imagePrint(l.fullSizeUrl(e.props["preview-url"])),p.logUserAction(d.UserAction.Print,t)},e.handleFitScaleFactorChange=function(t){isNaN(t)||e.state.fitScaleFactor===t||e.setState({fitScaleFactor:t})},e.keyboardBindings=n.__spreadArrays(I.getEqualsKeyBindings(L.wrapKeyboardActionWithLogging(e.onZoomIn,d.UserAction.ZoomIn)),I.getMinusKeyBindings(L.wrapKeyboardActionWithLogging(e.onZoomOut,d.UserAction.ZoomOut)),[R.hydrateKeyboardBinding({keyboardEventCriteria:{which:N.Key.P},callback:function(){return e.onPrint(d.UserActionContext.Keyboard)}})]),e.renderLayers=function(t){return function(r){var o=i.default.createElement(C.ImageLayer,n.__assign({},t,r)),a=e.state.scaleFactor||e.state.fitScaleFactor||1,s=r.originalWidth,l=r.originalHeight,c=s&&l?{width:s*a,height:l*a}:void 0,d=s&&l?{width:s,height:l}:void 0,p=r.data.thumbnailUrl,m=c&&d&&e.props.isWatermarkingMode?i.default.createElement(U.WatermarkingLayer,{layerSize:c,pageDimensions:d,thumbUrl:p}):null,f=c&&d&&e.props.isMarkupMode?i.default.createElement(B.MarkupLayer,{layerSize:c,pageDimensions:d,page:0}):null;return c&&e.props.annotationAllowed?[i.default.createElement(u.AnnotationConductorLayer,{layerSize:c,key:"annotation-layer"},i.default.createElement(u.AnnotationInstructionalTooltipPane,{layerSize:c},o,m,f,i.default.createElement(u.AnnotationViewLayer,null)))]:[o,m,f]}},e}return n.__extends(o,t),o.prototype.componentWillUnmount=function(){this.rivieraStatusCodeRequest&&this.rivieraStatusCodeRequest.readyState!==XMLHttpRequest.DONE&&this.rivieraStatusCodeRequest.abort(),this.props.overflowZoomOff()},o.prototype.componentWillMount=function(){this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted)},o.prototype.componentDidMount=function(){this.logOpen();var t=this.props,r=t.nsId,i=t.sjId,o=r+"_"+i;null!=r&&null!=i&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[o]&&this.logRenderFailure(),new Promise((function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)})).then(n.__importStar)},o.prototype.componentWillReceiveProps=function(e){if(e["preview-url"]!==this.props["preview-url"]){var t=e.filePreviewSession;this.logFilePreviewEvent(d.EventType.FilePreviewSupportConfirmed,void 0,t),this.logFilePreviewEvent(d.EventType.FilePreviewDownloadAttempted,void 0,t),this.logOpen(),this.setState({scaleFactor:void 0,fitScaleFactor:void 0}),this.imgLoaded=!1}},o.prototype.componentDidUpdate=function(e,t){t.scaleFactor!==this.state.scaleFactor&&(null!=this.state.scaleFactor&&null!=this.state.fitScaleFactor&&this.state.scaleFactor>this.state.fitScaleFactor?this.props.overflowZoomOn():this.props.overflowZoomOff())},o.prototype.logFilePreviewEvent=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=this.props.filePreviewSession),null!=n&&n.recordEvent(e,t)},o.prototype.logOpen=function(){a.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})},o.prototype.shouldDisableZoom=function(){var e=this.props,t=e.sizeClass;return e.shouldDisplayToolbar||t===y.SizeClass.Small},o.prototype.zoomWithMultiplier=function(e){var t=this.state.fitScaleFactor,n=this.state.scaleFactor||t;if(1!==e&&n){var r=.05*Math.round(n*e/.05);Math.abs(r-n)<.05&&(r+=e>1?.05:-.05),this.setState({scaleFactor:Math.min(Math.max(r,t||0),16)})}},o.prototype.render=function(){var e=this,t=this.props,n=t.count,o=t.currentMode,a=t.index,c=t.onNext,u=t.onPrevious,p=t.shouldDisplayToolbar,m=t.isEditMode,f=t.isFlippingEnabled,_=t.isFullscreen,h=t.sharePermission,y=t.contextMenuDisabled,S=t.windowWidth,E=t.windowHeight,P=t.nsId,I=void 0===P?0:P,O=t.sjId,R=void 0===O?0:O,L=t.fileName,U=t["preview-url"],B=t.user,j=t.file,q=t.shareToken,H=this.state,z=H.scaleFactor,G=H.fitScaleFactor,Y=z||G,J=i.default.createElement("div",{className:r.default("flex-preview-container","image-visible","annotations-visible",s.default.PREVIEW_IMAGE_CONTAINER,{"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":p})},i.default.createElement(C.PreviewImage,{previewMetadata:{content:{".tag":"image",default_src:b.getFallbackSrc(U),src_set:b.getSrcSet(U),full_size_src:l.fullSizeUrl(U),thumbnail_url_tmpl:U}},fileMetadata:{file_id:M.getFileRevisionId({ns_id:I,sjid:R}),file_name:L},fileInfo:{ns_id:I,sj_id:R,file_id:M.getFileRevisionId({ns_id:I,sjid:R}),bootstrap:{state:"ready"}},currentMode:o,data:void 0,filePreviewUiData:{zoomScaleFactor:z,fitScaleFactor:G||0,isSidebarOpen:!1,isFullScreen:!1,isFidelitySurveyVisible:!1},coreFileViewerUiData:{isDocSidebarOpen:!1,showVideoFrameSteppers:!1},fileViewerId:"",intl:W.intl,dispatch:K,config:v.DEFAULT_CONFIG,contextMenuDisabled:!!y,onDoubleClick:this.onImageDoubleClick,onInteractive:this.logTTI,onRenderSucceeded:this.logRenderSuccess,onRenderFailed:this.logRenderFailure,sizerClassName:s.default.PREVIEW_IMAGE,className:r.default(s.default.PREVIEW_IMAGE_WRAPPER,"preview-content"),width:null!=S?S:0,height:null!=E?E:0,layerRenderFn:this.renderLayers,onFitScaleFactorChanged:this.handleFitScaleFactorChange,resolveAsset:V}),!m&&i.default.createElement(A.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),!m&&p&&i.default.createElement(w.PreviewToolbar,{isFullscreen:!!_},f?i.default.createElement(k.ToolbarFlipButtons,{index:a,count:n,onClickPrevious:u,onClickNext:c}):null,i.default.createElement(T.ZoomOutButton,{className:"toolbar-button-entry",disabled:null!=Y&&null!=G&&Y<=G,intl:W.intl,onClick:this.onZoomOut,onKeyUp:function(t){t.keyCode===N.Key.Enter&&e.onZoomOut()}}),i.default.createElement(T.ZoomToFitButton,{className:"zoom-label toolbar-button-entry",intl:W.intl,onClick:this.onZoomOriginalOrFit,zoomPercent:Y}),i.default.createElement(T.ZoomInButton,{className:"toolbar-button-entry",disabled:null!=Y&&Y>=16,intl:W.intl,onClick:this.onZoomIn,onKeyUp:function(t){t.keyCode===N.Key.Enter&&e.onZoomIn()}}),i.default.createElement(T.FullScreenButton,{className:"toolbar-button-entry",intl:W.intl,onClick:function(){return g.toggleFullScreen(!!_,d.UserActionContext.Toolbar)}}),i.default.createElement(D.PreviewToolbarButton,{className:"print","data-test":"print",disabled:!x.canPrint(h),spriteGroup:"web",spriteName:"print",tooltip:x.getPrintTooltip(h),onClick:x.canPrint(h)?function(){return e.onPrint(d.UserActionContext.Toolbar)}:K}))),X=F.getConversionsForPreview(j,B,q,h);return i.default.createElement(i.default.Fragment,null,X,J)},o})(i.default.Component);t._PreviewImage=j;var q=E.requireCssWithComponent((function(e){return i.default.createElement(P.Dimensions,{className:"flex-preview-container"},(function(t){var r=t.width,o=t.height;return i.default.createElement(j,n.__assign({},e,{windowHeight:o,windowWidth:r}))}))}),["/static/css/preview_image-vfl-h4TzK.css"]),H=o.connect((function(e){return{isFlippingEnabled:m.getIsFlippingEnabled(e),annotationAllowed:m.getAnnotationAllowed(e),isEditMode:m.getIsEditMode(e),isWatermarkingMode:m.getIsWatermarkingMode(e),isMarkupMode:m.getIsMarkupMode(e)}}),{overflowZoomOn:f.overflowZoomOn,overflowZoomOff:f.overflowZoomOff})(q);t.PreviewImage=H})),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","classnames","lodash","react","modules/clean/image_size","ts-keycode-enum","modules/clean/loggers/file_preview_logger","modules/clean/loggers/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/components/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/components/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/react/previews/video/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/data/actions","react-redux","modules/clean/react/file_viewer/file_conversion/utils"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P,C,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideoBasic=t._PreviewVideoBasic=t.AsyncVideoPlayer=void 0,r=n.__importDefault(r),i=n.__importStar(i),o=n.__importDefault(o),w=n.__importStar(w),t.AsyncVideoPlayer=d.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/previews/video/video_player"],t,n)})).then(n.__importStar).then((function(e){return e.VideoPlayer}))}});var k=(function(e){function d(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastPlaybackRate=1,t.userActionLogger=null,t.startsPlayingEvent=b.VideoPreviewEvent.VideoStartsPlaying,t.onEmbed=function(){t.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportConfirmed),t.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadAttempted)},t.onLoadedMetadata=function(e){void 0===e&&(e=0),t.videoLogger.populateVideoDuration(e)},t.onReady=function(e){void 0===e&&(e=!1),t.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadSucceeded),t.props.filePreviewSession&&t.props.filePreviewSession.markPrimaryEvent(),w.mark_time_to_view(),w.mark_time_to_interactive(),t.markRenderSucceeded(),t.videoLogger.logEvent(b.VideoPreviewEvent.PlayerRendered)},t.logPlay=i.once((function(){t.videoLogger.logEvent(b.VideoPreviewEvent.FirstClickPlay)})),t.onPlay=function(){var e=t.props.setMediaPlaying;t.logPlay(),e&&e()},t.onPause=function(e){var n=t.props.setMediaPaused;n&&n(),t.videoLogger.logEvent(b.VideoPreviewEvent.VideoPaused,{video_timestamp:e.toString()})},t.onStartsPlaying=function(e){t.videoLogger.logEvent(t.startsPlayingEvent,{play_latency:e.latency.toString(),play_latency_since:e.trigger}),t.startsPlayingEvent=b.VideoPreviewEvent.VideoResumesPlaying},t.onUserInactive=function(e){e!==t.lastPlaybackRate&&(t.lastPlaybackRate=e,t.logUserAction(m.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},t.onScrubberThumbnailsLoaded=function(e){e?t.videoLogger.logEvent(b.VideoPreviewEvent.ScrubberThumbnailsLoaded):t.videoLogger.logEvent(b.VideoPreviewEvent.ScrubberThumbnailsFailed)},t.onAudioWaveformLoaded=function(){t.videoLogger.logEvent(b.VideoPreviewEvent.AudioWaveformLoaded)},t.onAudioWaveformFailed=function(){t.videoLogger.logEvent(b.VideoPreviewEvent.AudioWaveformFailed)},t.onError=function(e){if(e&&(t.videoLogger.logEvent(b.VideoPreviewEvent.MediaError,{errorCode:e.code?e.code.toString():"",errorMessage:e.message||""}),"needflash"===e.message))return t.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportDenied),void("function"==typeof t.props.onError&&t.props.onError(v.ErrorType.NeedFlashError));t.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadFailed),w.mark_time_to_view(),w.mark_time_to_interactive(),t.props.onError&&t.props.onError(v.ErrorType.LoadError)},t.onPlaybackRateChange=function(e,n){t.videoLogger.logEvent(b.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:n.toString()})},t.onSeek=function(e,n){t.videoLogger.logEvent(b.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),new_video_time:n.toString()})},t.onStalled=function(e,n){t.videoLogger.logEvent(b.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:n.toString()})},t.onTruncated=function(){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoTruncated),t.videoLogger.setVideoTruncated()},t.onClose=function(e){t.videoLogger.logEvent(b.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},t.onSelectQuality=function(e,n){t.videoLogger.logEvent(b.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:n})},t.handleKeyPress=function(e){return(null==e?void 0:e.keyCode)===s.Key.Space&&(t.togglePlayback(),_.isKeyboardEvent(e)&&e.preventDefault(),!0)},t.keyboardBindings=[{keyboardEventCriteria:_.generateUnmodifiedKeyboardEventCriteria(s.Key.Space),callback:t.handleKeyPress}],t.processGutterClick=function(e){var n=t.props.onGutterClick;n&&e.target===e.currentTarget&&n()},t}return n.__extends(d,e),d.prototype.setUpLoggers=function(){this.teardownLoggers(),this.userActionLogger=new l.FilePreviewUserActionLogger,this.userActionLogger.listenTo(f.filePreviewEventEmitter),this.videoLogger=new c.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)},d.prototype.teardownLoggers=function(){this.userActionLogger&&(this.userActionLogger.unlistenTo(f.filePreviewEventEmitter),this.userActionLogger=null)},d.prototype.logFilePreviewTimelineEvent=function(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)},d.prototype.logUserAction=function(e,t){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,m.UserActionContext.VideoPlayer,t)},d.prototype.markRenderSucceeded=function(){this.logFilePreviewTimelineEvent(m.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()},d.prototype.getPlaybackRates=function(){return[.5,1,1.25,1.5,2,4]},d.prototype.componentDidMount=function(){this.setUpLoggers()},d.prototype.componentWillUnmount=function(){this.teardownLoggers()},d.prototype.shouldComponentUpdate=function(e){return g.compareStateAndProps(e,{})},d.prototype.togglePlayback=function(){f.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoToggled)},d.prototype.render=function(){var e=this.props,i=e.title,s=e.previewUrl,l=e.separateResolutionUrls,c=e.sourceContext,d=e.thumbnailUrlTmpl,p=e.videoMetadataUrl,m=e.videoContainer,f=e.vttThumbnailsUrl,g=e.waveformUrl,_=e.user,b=e.file,w=e.shareToken,P=e.sharePermission,C=E.video_type(m),k=c!==v.PreviewSourceContext.EmbeddedSharedLinkFile,T=!1,A=!1,I=0;y.is_mobile_or_tablet()&&(T=!0,A=!0,I=1);var F={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:A,playsinline:I};null!=d&&(F.poster=u.tagCriticalPathContentRequest((function(e){return S.URI.parse(e).updateQuery({size:a.imageBestFitSize(window.innerWidth,window.innerHeight),size_mode:"2"}).toString()})(d),this.props.filePreviewSession));var O={videoProps:{src:s,separateResolutionSrcs:l,sourceContentType:C,metadataLink:p,title:i,vttThumbnailsUrl:f,waveformUrl:g},playerCallbacks:{onLoadedMetadata:this.onLoadedMetadata,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onPause:this.onPause,onStartsPlaying:this.onStartsPlaying,onUserInactive:this.onUserInactive,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onAudioWaveformLoaded:this.onAudioWaveformLoaded,onAudioWaveformFailed:this.onAudioWaveformFailed,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},playerOptions:F,seekPosition:this.props.seekPosition,shouldEnableControls:!this.props.hideControls,noDownload:T,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:k,isAudio:this.props.isAudio,bytes:this.props.bytes,showOnboarding:!!this.props.showOnboarding,framePreciseCommentsEnabled:this.props.framePreciseCommentsEnabled,frameRate:this.props.frameRate,playerIntegrationEnabled:!!this.props.playerIntegrationEnabled},x=o.default.createElement("div",{className:r.default({"flex-preview-container":!0,"touch-device":y.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:o.default.createElement(h.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),o.default.createElement("div",{className:"preview-content preview-video",onClick:this.processGutterClick},o.default.createElement("div",{className:"preview-video__wrapper"},o.default.createElement("div",{className:r.default({"preview-video__aspect-container":!0,"preview-audio-transcoded":this.props.isAudio})},o.default.createElement("div",{className:"preview-video__container"},o.default.createElement(t.AsyncVideoPlayer,n.__assign({},O))))))),D=M.getConversionsForPreview(b,_,w,P);return o.default.createElement(o.default.Fragment,null,D,x)},d})(o.default.Component);t._PreviewVideoBasic=k;var T=C.connect(void 0,{setMediaPlaying:P.setMediaPlaying,setMediaPaused:P.setMediaPaused})(k),A=p.requireCssWithComponent(T,["/static/css/preview_video-vflCsiyGF.css","/static/css/video-js-7-custom-v1-vflanqjiX.css"]);t.PreviewVideoBasic=A})),define("modules/clean/react/previews/error/view",["require","exports","tslib","classnames","react","modules/clean/react/previews/preview_toolbar","modules/clean/file_store/utils","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/previews/toolbar_flip_buttons"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorView=void 0,r=n.__importDefault(r),i=n.__importDefault(i),t.PreviewErrorView=function(e){var t=e.areActionablesEnabled,n=e.allowOpenInApp,m=e.count,_=e.errorType,h=e.extensionsEnabled,v=e.file,b=e.filename,w=e.index,y=e.message,S=e.onNext,E=e.onPrevious,P=e.preview,C=e.sharedLinkInfo,M=e.shareToken,k=e.sharePermission,T=e.shouldDisplayToolbar,A=e.sizeClass,I=e.user,F=e.encryptionOptions;return i.default.createElement("div",{className:r.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":T})},i.default.createElement("div",{className:"preview-error__wrapper"},i.default.createElement("div",{className:"preview-error__content"},i.default.createElement(d.PreviewErrorImage,{errorType:_}),i.default.createElement(p.PreviewErrorMessage,{file:v,preview:P,errorType:_,message:y}),i.default.createElement(u.PreviewErrorFileInfo,{filename:b,bytes:v.bytes}),t?i.default.createElement(s.Actionable,{allowOpenInApp:!!n,extensionsEnabled:h,file:v,variant:"primary",location:l.FileViewerPane.PreviewContent,sharedLinkInfo:C,shareToken:M,sharePermission:k,user:I,userActionContext:l.UserActionContext.PreviewContentMain,sizeClass:A,encryptionOptions:F}):null,_!==c.ErrorType.ExtensionError||a.isArchiveFile(v)?null:i.default.createElement(g,null)),T&&null!=w&&null!=m?i.default.createElement("div",{className:"preview-toolbar-container"},i.default.createElement(o.PreviewToolbar,{isFullscreen:!1},i.default.createElement(f.ToolbarFlipButtons,{index:w,count:m,onClickPrevious:E,onClickNext:S}))):null))};var g=function(){return i.default.createElement("div",{className:"preview-error__help-link"},i.default.createElement("a",{href:l.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},m.intl.formatMessage({id:"KlxqP+",defaultMessage:"Learn more."})))}})),define("modules/clean/react/previews/error/upsell",["require","exports","tslib","classnames","react","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/toolbar_flip_buttons"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewUpsellErrorView=void 0,r=n.__importDefault(r);var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClickCTA=function(){t.props.filePreviewSession&&d.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellClicked,t.props.filePreviewSession)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.filePreviewSession&&d.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellExposed,this.props.filePreviewSession)},t.prototype.render=function(){return i.default.createElement("div",{className:r.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":this.props.shouldDisplayToolbar})},i.default.createElement("div",{className:"preview-error__wrapper"},i.default.createElement("div",{className:"preview-error__content"},i.default.createElement(l.PreviewErrorImage,{errorType:this.props.errorType}),i.default.createElement(c.PreviewErrorMessage,{file:this.props.file,preview:this.props.preview,errorType:this.props.errorType}),i.default.createElement(s.PreviewErrorFileInfo,{filename:this.props.filename,bytes:this.props.file.bytes}),this.props.areActionablesEnabled?i.default.createElement("div",{className:"preview-error__upsell-cta"},i.default.createElement(o.Actionable,{allowOpenInApp:!!this.props.allowOpenInApp,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission,user:this.props.user,userActionContext:a.UserActionContext.PreviewContentMain,sizeClass:this.props.sizeClass,encryptionOptions:this.props.encryptionOptions})):null,i.default.createElement("div",{className:"preview-error__help-link"},i.default.createElement("a",{href:a.PreviewsUpsellUrl,onClick:this.onClickCTA},u.intl.formatMessage({id:"pvR+AO",defaultMessage:"Upgrade"}))),this.props.shouldDisplayToolbar&&null!=this.props.index&&null!=this.props.count?i.default.createElement("div",{className:"preview-toolbar-container"},i.default.createElement(p.PreviewToolbar,{isFullscreen:!1},i.default.createElement(m.ToolbarFlipButtons,{index:this.props.index,count:this.props.count,onClickPrevious:this.props.onPrevious,onClickNext:this.props.onNext}))):null)))},t})((i=n.__importDefault(i)).default.Component);t.PreviewUpsellErrorView=f})),define("modules/clean/react/previews/error/fullscreen_view",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/message","modules/clean/react/previews/preview_zoom_container"],(function(e,t,n,r,i,o,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorFullscreenView=void 0,r=n.__importDefault(r);var d=i.requireCssWithComponent((function(e){var t=e.allowOpenInApp,n=e.areActionablesEnabled,i=e.count,d=e.errorType,p=e.extensionsEnabled,m=e.file,f=e.filename,g=e.index,_=e.message,h=e.onNext,v=e.onPrevious,b=e.preview,w=e.sharedLinkInfo,y=e.shareToken,S=e.sharePermission,E=e.user,P=e.encryptionOptions;return r.default.createElement(u.PreviewZoomContainer,{fileCount:i,fileIndex:g,onClose:s.exitFullScreen,onFlipNext:h,onFlipPrevious:v,renderZoomControls:!1},r.default.createElement("div",{className:"preview-error--fullscreen fullscreen"},r.default.createElement(c.PreviewErrorMessage,{file:m,preview:b,errorType:d,message:_}),r.default.createElement(l.PreviewErrorFileInfo,{bytes:m.bytes,filename:f}),n?r.default.createElement(o.Actionable,{allowOpenInApp:!!t,extensionsEnabled:p,file:m,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:w,shareToken:y,sharePermission:S,user:E,userActionContext:a.UserActionContext.PreviewContentMain,encryptionOptions:P}):null))}),["/static/css/preview_image-vfl-h4TzK.css","/static/css/preview_error-vflujfmWk.css"]);t.PreviewErrorFullscreenView=d})),define("modules/clean/average_counter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AverageCounter=void 0;var n=(function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t=e.reduce((function(e,t){return e+t})),n=this.count+e.length;this.average=(this.average*this.count+t)/n,this.count=n},e})();t.AverageCounter=n})),define("modules/clean/callback_chain/callback_chain",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallbackChain=void 0;var n=(function(){function e(e){this.callbacks=e}return e.prototype.run=function(e){for(var t=(function(e){return void 0!==e.abortCallbackChain})(e)?e:(function(e){var t=e,n=!1;return t.abortCallbackChain=function(){n=!0},Object.defineProperty(t,"callbackChainAborted",{get:function(){return n}}),t})(e),n=0,r=this.callbacks;n<r.length;n++){var i=r[n];if(t.callbackChainAborted)break;i(t)}},e})();t.CallbackChain=n})),define("modules/clean/react/file_action_button_group",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileActionButtonGroup=void 0,(function(e){e.COMMENTS="COMMENTS",e.WATERMARKING="WATERMARKING"})(t.FileActionButtonGroup||(t.FileActionButtonGroup={}))})),define("modules/clean/react/file_action_button_type",["require","exports","modules/core/i18n"],(function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getFileActionButtonText=t.FileActionButtonType=void 0,t.FileActionButtonType={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",SUBSCRIBE_TO_NOTIFICATIONS:"SUBSCRIBE_TO_NOTIFICATIONS",UNSUBSCRIBE:"UNSUBSCRIBE",UNSUBSCRIBE_FROM_NOTIFICATIONS:"UNSUBSCRIBE_FROM_NOTIFICATIONS",ENABLE_WATERMARKING:"ENABLE_WATERMARKING",REMOVE_WATERMARKING:"REMOVE_WATERMARKING"};var i=((r={})[t.FileActionButtonType.COMMENT]=n.intl.formatMessage({id:"aM022A",defaultMessage:"Comment"}),r[t.FileActionButtonType.COPY]=n.intl.formatMessage({id:"P7oHCQ",defaultMessage:"Copy…"}),r[t.FileActionButtonType.DELETE]=n.intl.formatMessage({id:"OADU7S",defaultMessage:"Delete…"}),r[t.FileActionButtonType.DOWNLOAD]=n.intl.formatMessage({id:"n062nX",defaultMessage:"Download"}),r[t.FileActionButtonType.MOVE]=n.intl.formatMessage({id:"wz9EvW",defaultMessage:"Move…"}),r[t.FileActionButtonType.OPEN]=n.intl.formatMessage({id:"PHsPd8",defaultMessage:"Open"}),r[t.FileActionButtonType.PREVIOUS_VERSIONS]=n.intl.formatMessage({id:"QSlOA6",defaultMessage:"Version history"}),r[t.FileActionButtonType.REMOVE_LINK]=n.intl.formatMessage({id:"yypOy/",defaultMessage:"Remove link"}),r[t.FileActionButtonType.RENAME]=n.intl.formatMessage({id:"cBNivm",defaultMessage:"Rename"}),r[t.FileActionButtonType.SHARE]=n.intl.formatMessage({id:"V5WMXh",defaultMessage:"Share"}),r[t.FileActionButtonType.ENABLE_COMMENTS]=n.intl.formatMessage({id:"ouKfC+",defaultMessage:"Enable comments"}),r[t.FileActionButtonType.DISABLE_COMMENTS]=n.intl.formatMessage({id:"iVmeBf",defaultMessage:"Disable comments"}),r[t.FileActionButtonType.SHOW_RESOLVED_COMMENTS]=n.intl.formatMessage({id:"fKXJUR",defaultMessage:"Show resolved comments"}),r[t.FileActionButtonType.HIDE_RESOLVED_COMMENTS]=n.intl.formatMessage({id:"U75RtN",defaultMessage:"Hide resolved comments"}),r[t.FileActionButtonType.SUBSCRIBE]=n.intl.formatMessage({id:"5rfGLn",defaultMessage:"Subscribe"}),r[t.FileActionButtonType.SUBSCRIBE_TO_NOTIFICATIONS]=n.intl.formatMessage({id:"9Zx9uj",defaultMessage:"Subscribe to notifications"}),r[t.FileActionButtonType.UNSUBSCRIBE]=n.intl.formatMessage({id:"JFibpn",defaultMessage:"Unsubscribe"}),r[t.FileActionButtonType.UNSUBSCRIBE_FROM_NOTIFICATIONS]=n.intl.formatMessage({id:"1Y5o16",defaultMessage:"Unsubscribe from notifications"}),r[t.FileActionButtonType.ENABLE_WATERMARKING]=n.intl.formatMessage({id:"WnWL5z",defaultMessage:"Enable watermarking"}),r[t.FileActionButtonType.REMOVE_WATERMARKING]=n.intl.formatMessage({id:"qXY4zf",defaultMessage:"Remove watermarking"}),r);t.getFileActionButtonText=function(e){return e&&i[e]?i[e]:null}})),define("modules/clean/react/file_viewer/more_dropdown/models",["require","exports","tslib","lodash"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoreOptionGroup=t.MoreOption=void 0,r=n.__importStar(r);var i=(function(){function e(){}return e.prototype.equals=function(e){return r.isEqual(this,e)},e})(),o=(function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return n.className=t.className||null,n.fileActionButtonType=t.fileActionButtonType||null,n.handler=t.handler||r.noop,n.component=t.component||null,n.sortWeight=t.sortWeight||0,n}return n.__extends(t,e),t})(i);t.MoreOption=o;var a=(function(e){function t(t){var n=e.call(this)||this;return n.fileActionButtonGroup=t.fileActionButtonGroup,n.options=t.options||[],n.sortWeight=t.sortWeight||0,n}return n.__extends(t,e),t})(i);t.MoreOptionGroup=a})),define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["require","exports","tslib","lodash","modules/clean/react/file_viewer/more_dropdown/models"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.moreOptionRegistry=t.MoreOptionRegistry=void 0,r=n.__importStar(r);var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.options=[],t}return n.__extends(t,e),t.prototype.isValidMoreOption=function(e){return null!=e.fileActionButtonType},t.prototype.isValidMoreOptionGroup=function(e){var t=this,n=e.options;return n.length&&n.every((function(e){return t.isValidMoreOption(e)}))},t.prototype.isValidOption=function(e){return e instanceof i.MoreOption&&this.isValidMoreOption(e)||e instanceof i.MoreOptionGroup&&this.isValidMoreOptionGroup(e)},t.prototype.reset=function(){this.options=[],this.removeListeners()},t.prototype.getOptionItems=function(){return r.sortBy(this.options.slice(),(function(e){return e.sortWeight}))},t.prototype.addOption=function(e){if(!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");this.options=n.__spreadArrays(this.options,[e]),this.emitChange()},t.prototype.removeOption=function(e){if(null!=e&&!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");var t,n,r=this.options.length;this.options=(t=this.options,n=e,t.filter((function(e){return e!==n}))),this.options.length<r&&this.emitChange()},t.prototype.replaceOption=function(e,t){if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this.isValidOption(e)||!this.isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(!e.equals(t)){var n=!1;this.options=this.options.map((function(r){return r===e?(n=!0,t):r})),n&&this.emitChange()}},t})((function(){function e(){this.listeners=[]}return e.prototype.emitChange=function(){return this.listeners.forEach((function(e){return e()}))},e.prototype.addListener=function(e){var t=this;return this.listeners.push(e),function(){var n=t.listeners.indexOf(e);n>-1&&t.listeners.splice(n,1)}},e.prototype.removeListeners=function(){this.listeners=[]},e})());t.MoreOptionRegistry=o,t.moreOptionRegistry=new o})),define("modules/clean/react/file_viewer/actionable",["require","exports","tslib","react","modules/clean/file_store/utils","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/extensions/data/types","modules/clean/react/file_viewer/open_button/open_button"],(function(e,t,n,r,i,o,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actionable=void 0,r=n.__importDefault(r),t.Actionable=function(e){var t,n=e.allowOpenInApp,u=e.extensionsEnabled,d=e.variant,p=e.location,m=e.sizeClass,f=e.user,g=e.userActionContext,_=e.encryptionOptions;return i.isSharedFile(e.file)?(t=e.file,n&&t.open_in_app_data?r.default.createElement(o.OpenInAppButton,{urls:t.open_in_app_data,userActionContext:g}):r.default.createElement(a.ShareDownloadButton,{copyable:t,importance:d,location:p,sharedLinkInfo:e.sharedLinkInfo,shareToken:e.shareToken,sharePermission:e.sharePermission,user:f,encryptionOptions:_})):f?(t=e.file,u?r.default.createElement(s.ExtensionsMenu,{file:t,user:f,showAsButtonIfDownloadOnly:!0,triggerType:l.TriggerType.PrimaryButton,telemetryContext:{surface:"previews"},onPresentInZoom:function(){}}):r.default.createElement(c.OpenButton,{file:t,user:f,justifyRight:!1,location:p,buttonVariant:d,sizeClass:m})):null}})),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],(function(e,t,n,r,i,o,a,s,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewAppDownloadInterstitial=void 0;var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onContinue=function(){t.log(o.UserAction.AppDownloadInterstitialContinue),"function"==typeof t.props.onContinue&&t.props.onContinue()},t.onClose=function(){t.log(o.UserAction.AppDownloadInterstitialClose),"function"==typeof t.props.onClose&&t.props.onClose()},t.onAppDownload=function(){t.log(o.UserAction.AppDownloadInterstitialInstall)},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){c.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(o.UserAction.AppDownloadInterstitialView)},t.prototype.componentWillReceiveProps=function(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)},t.prototype.setupLogger=function(e){void 0===e&&(e=this.props);var t=this.props,n=t.file,r=t.fileViewerSession,i=t.previewType,o=t.previewSourceAction,a=void 0===o?l.PreviewSourceAction.Visit:o,c=t.previewSourceContext,u=void 0===c?l.PreviewSourceContext.SharedLinkFile:c;r&&(this.filePreviewSession=new s.FilePreviewSession({file:n,previewType:i,fileViewerSession:r,sourceAction:a,sourceContext:u}))},t.prototype.log=function(e){var t=this.props,n=t.fileViewerSession,r=t.file;this.filePreviewSession&&n&&r.ns_id&&r.sjid&&i.MobileFilePreviewLogger.log(e,n.id,this.filePreviewSession.id,r.ns_id,r.sjid,{context:o.UserActionContext.AppDownloadInterstitial})},t.prototype.render=function(){var e=this.props,t=e.file,i=e.sharedLinkInfo,o=n.__rest(e,["file","sharedLinkInfo"]);return r.default.createElement(u.AppDownloadInterstitial,n.__assign({fileOrFolderName:a.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:i.ownerName,ownerTeamName:i.ownerTeamName,onClose:this.onClose},o))},t})((r=n.__importDefault(r)).default.PureComponent);t.FilePreviewAppDownloadInterstitial=d})),define("modules/clean/react/file_viewer/cloud_doc_preview",["require","exports","tslib","react","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types","modules/clean/referrer_cleansing_redirect","modules/clean/file_store/utils","modules/clean/cloud_docs/constants"],(function(e,t,n,r,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloudDocPreview=void 0,r=n.__importDefault(r),a=n.__importStar(a);var c=(function(e){function t(t){var n=e.call(this,t)||this;return n.logPreviewAction=function(){if(n.props.file.file_id){var e={};n.props.user?i.logUserAction({actionEvent:o.UserActionEventType.PREVIEW,userId:n.props.user.id,docPathOrId:n.props.file.file_id,actionSource:o.UserActionSourceType.WEB}):(n.props.LoggedOutUXGoogleVariant&&(e[l.CLOUD_DOCS_STORMCROW_LOGGED_OUT_UX_GOOGLE]=n.props.LoggedOutUXGoogleVariant||""),i.logLoggedOutUserAction({actionEvent:o.UserActionEventType.PREVIEW,userId:0,docPathOrId:n.props.file.file_id,actionSource:o.UserActionSourceType.WEB,extra:e}))}},n.shouldRedirect=!t.showCloudDocPreview&&Boolean(t.cloudDoc.exit_url),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.logPreviewAction(),this.shouldRedirect&&a.redirect(this.props.cloudDoc.exit_url)},t.prototype.componentDidUpdate=function(e){this.props.file.file_id!==e.file.file_id&&this.logPreviewAction()},t.prototype.shouldComponentUpdate=function(e){return this.props.file.file_id!==e.file.file_id},t.prototype.render=function(){if(this.shouldRedirect)return null;var e=s.getExtension(this.props.file);return["gdoc","gslides","paper","papert","binder"].includes(e)?this.props.renderPdfPreview(this.props.cloudDoc):["gsheet"].includes(e)?this.props.renderExcelPreview():this.props.renderUnsupportedErrorPreview()},t})(r.default.Component);t.CloudDocPreview=c})),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","react","modules/clean/react/components/css","modules/constants/payments","modules/core/i18n"],(function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExpFileViewerUpsellBannerV2=void 0,r=n.__importDefault(r),o=n.__importStar(o);var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=o.OUT_OF_SPACE_URL+"?oqa=oq_fp";return r.default.createElement("div",{className:"fileviewer-upsell-banner"},a.intl.formatMessage({id:"XOn3VZ",defaultMessage:"Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"},{a:function(t){return r.default.createElement("a",{href:e},t)}}))},t})(r.default.Component);t.ExpFileViewerUpsellBannerV2=i.requireCssWithComponent(s,["/static/css/exp_file_preview_upsell-vfli2_OuA.css"])})),define("modules/clean/react/file_viewer/feedback_form/api",["require","exports","tslib","api_v2/user_client","modules/clean/react/file_viewer/feedback_form/types"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitFeedback=void 0,t.submitFeedback=function(e,t,o,a){return n.__awaiter(this,void 0,Promise,(function(){var s,l;return n.__generator(this,(function(n){switch(n.label){case 0:return a?(s=t===i.NOT_APPLICABLE_SATISFACTION_RATING_VALUE?void 0:t,l={product_name:e,satisfaction_rating:s,comment:o},[4,(new r.UserApiV2Client).ns("workflows").rpc("submit_feedback",l,{subjectUserId:a.id})]):[2];case 1:return[2,n.sent()]}}))}))}})),define("modules/clean/react/file_viewer/feedback_form/feedback_form_modal",["require","exports","tslib","react","modules/core/i18n","file-transfers/feedback-form/index","modules/clean/react/components/css","spectrum/modal/index","modules/clean/react/snackbar"],(function(e,t,n,r,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackFormModal=t.FeedbackFormModalComponent=void 0,r=n.__importDefault(r);var c="feedback-snackbar-id",u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={comment:"",rating:null},t.handlePrimaryAction=function(){var e=t.state,n=e.rating,r=e.comment,o=t.props.user;n?(t.props.submitFeedback(n,r,o),t.props.onRequestClose(),l.Snackbar.complete(i.intl.formatMessage({id:"w0RwUf",defaultMessage:"Feedback submitted!"}),c)):l.Snackbar.fail(i.intl.formatMessage({id:"HnlRF6",defaultMessage:"Please provide a rating"}),c)},t.handleRatingChange=function(e){t.setState({rating:e})},t.handleCommentsChange=function(e){t.setState({comment:e})},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.state,t=e.comment,n=e.rating;return r.default.createElement(s.UtilityModal,{ariaLabel:this.props.title,title:this.props.title,open:this.props.open,displayCloseButton:!0,overlayClickClose:!0,onReady:this.props.onReady,onRequestClose:this.props.onRequestClose,primaryAction:i.intl.formatMessage({id:"Laz2WV",defaultMessage:"Submit"}),onPrimaryAction:this.handlePrimaryAction,secondaryAction:i.intl.formatMessage({id:"5FcUkH",defaultMessage:"Not now"}),onSecondaryAction:this.props.onRequestClose,shouldRequestCloseOnActions:!1,overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},r.default.createElement(o.FeedbackForm,{comment:t,rating:n,commentPrompt:this.props.commentPrompt,onRatingChange:this.handleRatingChange,onCommentsChange:this.handleCommentsChange}))},t})(r.default.Component);t.FeedbackFormModalComponent=u,t.FeedbackFormModal=a.requireCssWithComponent(u,["/static/js/file-transfers/index.web-vflF26LyR.css"])})),define("modules/clean/react/file_viewer/feedback_form/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=t.SubmitFeedbackProductName=void 0,(function(e){e.DROPBOX_MARKUP="Dropbox Markup"})(t.SubmitFeedbackProductName||(t.SubmitFeedbackProductName={})),t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1})),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","classnames","react","lodash","file-viewer/core/index","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/previews/util","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/utils","modules/clean/cloud_docs/shared_components/routing","modules/clean/react/file_viewer/cloud_doc_preview","modules/clean/file_store/utils","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","file-viewer/core/index","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/error/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/preview_ppt_loadable","modules/clean/react/previews/archive/preview_archive_loadable","spectrum-sharing/utils/sharing_constants","modules/core/i18n","modules/core/browser","modules/clean/react/file_viewer/file_preview_logging_manager","modules/clean/redux/constants","modules/clean/previews/data/util","modules/clean/react/snackbar","modules/clean/react/file_viewer/logging"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x,D,R,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewWithLogging=t.FilePreview=void 0,r=n.__importDefault(r),i=n.__importDefault(i),o=n.__importStar(o),l=n.__importStar(l),c=n.__importStar(c),F=n.__importStar(F);var L=d.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/previews/preview_image_zoom"],t,n)})).then(n.__importStar).then((function(e){return e.PreviewImageZoom}))}}),U=d.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/previews/limited_preview_message"],t,n)})).then(n.__importStar).then((function(e){return e.LimitedPreviewMessage}))}}),B=F.get_uri().getQuery(),W=B.forceRivieraException,V=B.forceTestPdf,K=B.forceTestExcelHtml,j=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.triggerDynamicRoutingModalCheck()},t.prototype.componentDidUpdate=function(e){var t=e.user,n=e.file,r=this.props,i=r.user,a=r.file;o.isEqual(n,a)&&o.isEqual(t,i)||this.triggerDynamicRoutingModalCheck()},t.prototype.triggerDynamicRoutingModalCheck=function(){var e=this.props,t=e.user,n=e.file,r=e.file.file_id;t&&r&&!this.isViewOnly()&&f.maybeShowDynamicRoutingModal(t,n,_.getExtension(n))},t.prototype.isViewOnly=function(){var e=!1;return this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken&&(e=this.props.shareToken.linkType===A.SharedLinkType.Shmodel),e},t.prototype.render=function(){var e=this.props,t=e.doc,r=t.autoprint_url,o=t.image_url_tmpl,s=t.refresh_url,l=void 0===s?"":s,c=t.text_url_tmpl,d=e.file,p=e.filePreviewSession,m=e.invalidateFrameMessenger,f=e.isFullscreen,g=e.isSidebarOpen,h=e.location,v=e.mode,b=void 0===v?a.FileViewerMode.Default:v,w=e.renderUnsupportedErrorPreview,y=e.setRenderStatusSuccess,S=e.sharePermission,E=e.shareToken,P=e.sidebar,C=e.sizeClass,T=e.triggerError,A=e.user,I=e.count,F=e.index,O=e.onPrevious,x=e.onNext;if(!o||!c)return w();var R=_.getExtension(d),N={autoprintUrl:r,currentMode:{sidebar:P,mode:b},revisionId:D.buildRevisionId(d.ns_id,d.sjid),file:d,fileExtension:R,filePreviewSession:p,imageUrlTmpl:o,isArchiveFile:!1,isFullscreen:f,isSidebarOpen:g,onError:T,useCanned:!!V,refreshUrl:l,location:h,sharePermission:S,shareToken:E,sizeClass:C,textUrlTmpl:c,invalidateFrameMessenger:m,setRenderStatusSuccess:y,user:A,count:I,index:F,onPrevious:O,onNext:x};return u.isPptExtension(R)?i.default.createElement(k.PreviewPPTLoadable,n.__assign({},N)):i.default.createElement(M.PreviewPDFLoadable,n.__assign({},N))},t})(i.default.Component),q=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={hasError:!1},t.handlePrevious=N.wrapToolbarActionWithLogging((function(){var e,n;return null===(n=(e=t.props).onPrevious)||void 0===n?void 0:n.call(e)}),p.UserAction.FlipPrevious),t.handleNext=N.wrapToolbarActionWithLogging((function(){var e,n;return null===(n=(e=t.props).onNext)||void 0===n?void 0:n.call(e)}),p.UserAction.FlipNext),t.shouldDisableDownload=function(){return!!t.props.sharePermission&&!t.props.sharePermission.canViewContextMenuRoles.length},t.onContextMenu=function(e){t.shouldDisableDownload()&&e.preventDefault()},t.onCopy=function(e){t.props.sharePermission&&0===t.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},t.renderExcelPreview=function(){var e=t.props.previewApiData.data.preview_url;return e?i.default.createElement(S.PreviewHTML,n.__assign({src:e,isExcel:!0,forceRivieraException:Array.isArray(W)?W[0]:"",forceTestExcelHtml:!!K,usesFrameMessenger:!0},t.getCommonHtmlPreviewProps())):t.renderUnsupportedErrorPreview()},t.renderPdfPreview=function(e){return i.default.createElement(j,n.__assign({},t.props,{onPrevious:t.handlePrevious,onNext:t.handleNext,doc:e,renderUnsupportedErrorPreview:t.renderUnsupportedErrorPreview,triggerError:t.triggerError}))},t.renderUnsupportedErrorPreview=function(){return t.renderErrorPreview(v.ErrorType.SupportError)},t.showLoadingIndicator=function(){return i.default.createElement(w.LoadingIndicator,{className:"loading-indicator"})},t.getErrorMessage=function(e,t,n){if(n&&"sketch"===_.getExtension(n)&&e===v.ErrorType.LoadError&&t===b.RivieraStatus.UnsupportedFormat)return I.intl.formatMessage({id:"I5lVCX",defaultMessage:"This file can’t be previewed. Previews are only available for files created in Sketch v43 and up."})},t.triggerError=function(e,n){t.setState({hasError:!0,errorType:e,rivieraStatusCode:n})},t}return n.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){o.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})},t.prototype.componentDidMount=function(){if(s.PreviewType.Excel===l.getPreviewType(this.props.previewApiData.data)){var e=this.props.file,t=_.getExtension(e);this.props.user&&e.file_id&&!this.isViewOnly()&&f.maybeShowDynamicRoutingModal(this.props.user,e,t)}window.setTimeout(h.cleanupPrerenderPreview)},t.prototype.isViewOnly=function(){var e=!1;return this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken&&(e=this.props.shareToken.linkType===A.SharedLinkType.Shmodel),e},t.prototype.renderImagePreview=function(e){var t=this.props,r=t.file,o=t.mode,l=t.sidebar,u=_.getExtension(r),d={mode:o||a.FileViewerMode.Default,sidebar:l};if(this.props.isFullscreen)return i.default.createElement(L,{currentMode:d,thumbnailUrlTmpl:e.thumbnail_url_tmpl,fileCount:this.props.count,fileIndex:this.props.index,onError:this.triggerError,onFlipNext:this.handleNext,onFlipPrevious:this.handlePrevious,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),fileExtension:u,fileId:this.props.file.file_id||"",fileName:_.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess});var p={currentMode:d,"preview-url":e.thumbnail_url_tmpl,"file-extension":u,isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!c.isLimitedPreview(r,s.PreviewType.Image),index:this.props.index,count:this.props.count,onPrevious:this.handlePrevious,onError:this.triggerError,onNext:this.handleNext,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:_.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,user:this.props.user,file:this.props.file,shareToken:this.props.shareToken};return i.default.createElement(E.PreviewImage,n.__assign({},p))},Object.defineProperty(t.prototype,"shouldShowActionables",{get:function(){return this.props.areActionablesEnabled&&!_.isArchiveFile(this.props.file)},enumerable:!1,configurable:!0}),t.prototype.renderVideoPreview=function(e){var t=this.props,n=t.file,r=t.hidePageChrome;return i.default.createElement(C.PreviewVideo,{title:_.getFilenameWithoutExtension(n),fileExtension:_.getExtension(n),previewUrl:e.transcode_url,separateResolutionUrls:e.transcode_urls_separate_resolutions,thumbnailUrlTmpl:e.poster_url_tmpl,videoMetadataUrl:e.metadata_url,videoContainer:e.container,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess,user:this.props.user,file:n,shareToken:this.props.shareToken,hidePageChrome:r,sharePermission:this.props.sharePermission})},t.prototype.renderLinkfilePreview=function(e){var t=this.props.file,n={url:e.url,authenticated:!!e.authenticated};return i.default.createElement(P.PreviewLinkfile,{filename:_.getFilename(t),data:n,source:e.authenticated?"browse":"sharedLink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess,index:this.props.index,count:this.props.count,onPrevious:this.handlePrevious,onNext:this.handleNext})},t.prototype.getCommonHtmlPreviewProps=function(){var e=this.props.file,t=_.getExtension(e);return{count:this.props.count,fileExtension:t,filePreviewSession:this.props.filePreviewSession,filename:_.getFilename(e),index:this.props.index,isFullscreen:this.props.isFullscreen,onClickNext:this.handleNext,onClickPrevious:this.handlePrevious,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,sizeClass:this.props.sizeClass}},t.prototype.renderHtmlifiedPreview=function(e){var t=e.htmlified_link,r=e.uses_frame_messenger;return t?i.default.createElement(S.PreviewHTML,n.__assign({src:t,isExcel:!1,usesFrameMessenger:r},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderRawHtmlPreview=function(){var e=this.props.previewApiData.data.preview_url;return e?i.default.createElement(S.PreviewHTML,n.__assign({src:e,isExcel:!1,usesFrameMessenger:!1},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},t.prototype.renderAudioPreview=function(e){var t=this.props.file;return i.default.createElement(C.PreviewVideo,{title:_.getFilenameWithoutExtension(t),fileExtension:_.getExtension(t),previewUrl:e.transcode_url,videoContainer:e.container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,bytes:t.bytes,waveformUrl:e.waveform_url,user:this.props.user,file:t,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission})},t.prototype.renderArchivePreview=function(){return i.default.createElement(T.PreviewArchiveLoadable,{rootFile:this.props.file,previewUrl:this.props.previewApiData.data.preview_url,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user,encryptionOptions:this.props.encryptionOptions,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken})},t.prototype.renderCloudDocPreview=function(e){return i.default.createElement(g.CloudDocPreview,{file:this.props.file,user:this.props.user,cloudDoc:e,showCloudDocPreview:this.props.showCloudDocPreview,renderExcelPreview:this.renderExcelPreview,renderPdfPreview:this.renderPdfPreview,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant})},t.prototype.renderErrorPreview=function(e){var t=this.state.rivieraStatusCode,n=this.props,r=n.count,o=n.extensionsEnabled,s=n.file,l=n.previewApiData,c=n.filePreviewSession,u=n.index,d=n.isFullscreen,p=n.isMobileUserAgent,m=n.maxFilenameEmLength,f=n.mode,g=n.sharedLinkInfo,h=n.sharePermission,b=n.shareToken,w=n.user,S=n.encryptionOptions,E=this.props.shouldDisplayToolbar&&!_.isArchiveFile(s),P=e;return f===a.FileViewerMode.Watermarking&&(R.Snackbar.close(),P=v.ErrorType.WatermarkingError),i.default.createElement(y.PreviewError,{file:s,extensionsEnabled:o,preview:l.data,maxFilenameEmLength:m,filePreviewSession:c,errorType:P,user:w,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:g,shareToken:b,sharePermission:h,shouldDisplayToolbar:E,index:u,isFullscreen:d,isMobileUserAgent:p,count:r,onPrevious:this.handlePrevious,onNext:this.handleNext,message:this.getErrorMessage(e,t,s),sizeClass:this.props.sizeClass,encryptionOptions:S})},t.prototype.getPreviewTypeWhitelist=function(){return this.props.previewTypeWhitelist||c.VALID_PREVIEW_TYPES},t.prototype.choosePreview=function(){var e=this.props,t=e.file,r=e.previewApiData,o=this.getPreviewTypeWhitelist(),a=this.validateFile(t,r);if(a)return a;if(r.status===x.ApiClientStatus.Request)return this.showLoadingIndicator();if(r.status===x.ApiClientStatus.Error)return this.renderErrorPreview(v.ErrorType.ExtensionError);if(!r.data||!r.data.content)return _.isArchiveFile(t)?this.renderErrorPreview(v.ErrorType.ExtensionError):this.renderErrorPreview(v.ErrorType.UnknownError);var u=r.data.content,d=l.getPreviewType(r.data);if(c.isEmptyFile(t)&&d!==s.PreviewType.CloudDoc)return this.renderErrorPreview(v.ErrorType.EmptyFileError);if(!(null==o||o.includes(d)))return this.renderErrorPreview(v.ErrorType.ExtensionError);if(d===s.PreviewType.Restricted)return m.isUserOwnerOfFile(this.props.user,this.props.file)?this.renderErrorPreview(v.ErrorType.UpsellError):this.renderErrorPreview(v.ErrorType.ExtensionError);switch(d){case s.PreviewType.Video:return this.renderVideoPreview(u);case s.PreviewType.Audio:return this.renderAudioPreview(u);case s.PreviewType.Archive:return this.renderArchivePreview();case s.PreviewType.Image:return this.renderImagePreview(u);case s.PreviewType.SsrDoc:return i.default.createElement(j,n.__assign({},this.props,{onPrevious:this.handlePrevious,onNext:this.handleNext,doc:u,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,triggerError:this.triggerError}));case s.PreviewType.Linkfile:return this.renderLinkfilePreview(u);case s.PreviewType.CloudDoc:return this.renderCloudDocPreview(u);case s.PreviewType.Excel:return this.renderExcelPreview();case s.PreviewType.RawHTML:return this.renderRawHtmlPreview();case s.PreviewType.HTML:return this.renderHtmlifiedPreview(u)}},t.prototype.validateFile=function(e,t){return e.is_dir&&!c.isSupportedBundleFile(e)?this.renderErrorPreview(v.ErrorType.ExtensionError):null!=e.ns_id||_.isArchiveFile(e)?_.isSymLink(e)?this.renderErrorPreview(v.ErrorType.SymLinkError):t?c.filesizeSupported(e,l.getPreviewType(t.data))?void 0:this.renderErrorPreview(v.ErrorType.FileSizeError):this.renderErrorPreview(v.ErrorType.ExtensionError):this.renderErrorPreview(v.ErrorType.PendingUploadError)},t.prototype.render=function(){var e=this.props,t=e.file,n=e.previewApiData,o=e.sharedLinkInfo,a=e.shareToken,s=e.sharePermission,u=e.sizeClass,d=e.user,p=e.encryptionOptions,m=this.state,f=m.errorType;return m.hasError?this.renderErrorPreview(f):i.default.createElement("div",{className:r.default({"flex-preview-container":!0,"no-download":s&&0===s.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},_.isArchiveFile(t)?null:i.default.createElement(O.FilePreviewPaasLoggerManager,{file:t}),this.choosePreview(),n&&c.isLimitedPreview(t,l.getPreviewType(n.data))?i.default.createElement(U,{extension:_.getExtension(t),file:t,sharedLinkInfo:o,shareToken:a,sharePermission:s,shouldShowActionables:this.shouldShowActionables,sizeClass:u,user:d,encryptionOptions:p}):null)},t.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:o.noop,user:null},t})(i.default.Component);t.FilePreview=q,t.FilePreviewWithLogging=function(e){var t=e.file,r=e.isInbandExperiment,o=e.sourceAction,a=e.sourceContext,s=e.previewApiData,c=e.onPreviewSessionInitialized;return i.default.createElement(O.FilePreviewSessionManager,{file:t,previewType:l.getPreviewType(s.data),sourceAction:o,sourceContext:a,extra:{is_inband_experiment:(!!r).toString()},onPreviewSessionInitialized:c,render:function(t){return i.default.createElement(q,n.__assign({},e,{filePreviewSession:t}))}})}})),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","react","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","lodash"],(function(e,t,n,r,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewPaasLoggerManager=t.FilePreviewSessionManager=void 0,r=n.__importDefault(r),o=n.__importStar(o),d=n.__importStar(d);var p=(function(e){function t(t){var n=e.call(this,t)||this;n.setUpFilePreviewLogger=function(e){n.teardownFilePreviewLogger(),n.filePreviewTimelineLogger=new i.FilePreviewTimelineLogger(e),n.filePreviewTimelineLogger.listenTo(s.filePreviewEventEmitter),n.filePreviewUserActionLogger=new i.FilePreviewUserActionLogger,n.filePreviewUserActionLogger.listenTo(s.filePreviewEventEmitter),n.filePreviewModeLogger=new i.FilePreviewModeLogger,n.filePreviewModeLogger.listenTo(s.filePreviewEventEmitter),n.filePreviewSidebarLogger=new i.FilePreviewSidebarLogger,n.filePreviewSidebarLogger.listenTo(s.filePreviewEventEmitter),n.filePreviewUpsellLogger=new i.FilePreviewUpsellLogger,n.filePreviewUpsellLogger.listenTo(s.filePreviewEventEmitter),n.filePreviewConversionLogger=new i.FilePreviewConversionLogger,n.filePreviewConversionLogger.listenTo(s.filePreviewEventEmitter),n.fileConversionLogger=new i.FileConversionLogger,n.fileConversionLogger.listenTo(s.filePreviewEventEmitter)},n.teardownFilePreviewLogger=function(){null!=n.filePreviewTimelineLogger&&n.filePreviewTimelineLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.filePreviewUserActionLogger&&n.filePreviewUserActionLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.filePreviewModeLogger&&n.filePreviewModeLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.filePreviewSidebarLogger&&n.filePreviewSidebarLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.filePreviewUpsellLogger&&n.filePreviewUpsellLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.filePreviewConversionLogger&&n.filePreviewConversionLogger.unlistenTo(s.filePreviewEventEmitter),null!=n.fileConversionLogger&&n.fileConversionLogger.unlistenTo(s.filePreviewEventEmitter)},n.logPreviewSessionEnded=function(e){void 0===e&&(e=c.PreviewSessionEndReason.Unknown);var t={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e};n.state.filePreviewSession.recordEvent(a.EventType.FilePreviewSessionEnded,t)},n.getNewFilePreviewSession=function(e){var t=e.file,r=e.previewType,i=e.sourceAction,o=e.sourceContext,s=e.extra,c=new l.FilePreviewSession({file:t,previewType:r,fileViewerSession:l.FileViewerSession.currentSession,sourceAction:i,sourceContext:o,extra:s});return n.props.onPreviewSessionInitialized&&n.props.onPreviewSessionInitialized(c.id),l.FilePreviewSession.currentSession=c,n.setUpFilePreviewLogger(c.id),c.recordEvent(a.EventType.FilePreviewAttemptStarted,{window_width:""+window.innerWidth,window_height:""+window.innerHeight}),c},n.windowCloseHandler=function(){n.logPreviewSessionEnded(c.PreviewSessionEndReason.BeforeUnload)};var r=n.getNewFilePreviewSession(n.props);return n.state={filePreviewSession:r},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){window.addEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillUnmount=function(){this.logPreviewSessionEnded(c.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this.windowCloseHandler)},t.prototype.componentWillReceiveProps=function(e){if(!d.isEqual(e.file,this.props.file)){this.logPreviewSessionEnded(c.PreviewSessionEndReason.NewFile);var t=this.getNewFilePreviewSession(e);this.setState({filePreviewSession:t})}},t.prototype.render=function(){return this.props.render(this.state.filePreviewSession)},t})(r.default.Component);t.FilePreviewSessionManager=p;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFrameMessage=function(e){var n=t.props.file,r=e.action,i=e.parameters;"pagerendered"===r&&o.logPageRendered(n,i)},t.startLogger=function(){t.frameMessenger=new u.PreviewFrameMessengerHost,t.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",t.onFrameMessage,["pagerendered"]),t.frameMessenger.startListening()},t.stopLogger=function(){t.frameMessenger.stopListening()},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.startLogger()},t.prototype.componentWillUnmount=function(){this.stopLogger()},t.prototype.render=function(){return null},t})(r.default.Component);t.FilePreviewPaasLoggerManager=m})),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","classnames","keymaster","react","lodash","react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/utils","modules/clean/loggers/file_viewer_logger","modules/clean/loggers/workflows_logger","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","file-viewer/core/index","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/surface_existing_teams_header","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/ml_experiment","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer_sidebar/sidebar","modules/clean/react/watermarking/utils","modules/clean/pro_analytics/data/util","modules/clean/previews/data/preview_type_util","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/location/with_location","modules/clean/react/components/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/previews/fidelity_survey/fidelity_survey","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/core/browser","modules/core/browser_detection","modules/core/dom","modules/core/i18n","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/data/selectors","modules/clean/integrations/data/selectors","modules/clean/react/components/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager","modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager","modules/clean/react/file_viewer_sidebar/data_managers/async_pro_analytics_data_manager","modules/clean/react/workflows/i18n/with_translations","pro-ui/components/trial/banner/index","modules/clean/abuse/async_report_flag","modules/clean/react/file_viewer_titlebar/titlebar","file-viewer/core/data/modes/types","modules/clean/react/file_viewer/prompt/loadable_prompt","modules/clean/react/file_viewer/mode_manager","modules/clean/react/file_viewer_sidebar/buttons/more_dropdown","modules/clean/react/file_viewer_titlebar/edit_mode_titlebar","modules/clean/bug_reporting/routing","modules/clean/react/teams/team_discovery/data/logger","modules/clean/react/extensions/data/action_creators","dig-components/layer","modules/core/browser_detection","modules/constants/file_viewer","modules/clean/react/branding/branding_modal_controller","modules/clean/user_survey/user_survey"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x,D,R,N,L,U,B,W,V,K,j,q,H,z,G,Y,J,X,Z,Q,$,ee,te,ne,re,ie,oe,ae,se,le,ce,ue,de,pe,me,fe,ge,_e,he,ve,be,we,ye,Se,Ee,Pe,Ce){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileViewer=t._FileViewer=void 0,r=n.__importDefault(r),i=n.__importDefault(i),o=n.__importDefault(o),a=n.__importStar(a),p=n.__importStar(p),g=n.__importStar(g),z=n.__importStar(z),G=n.__importStar(G),Y=n.__importStar(Y),X=n.__importStar(X),Se=n.__importStar(Se);var Me="",ke="",Te=(function(t){function s(){var r=null!==t&&t.apply(this,arguments)||this;return r.state={modeClassnames:"",dismissedSETHeader:!1},r.previewSourceAction=r.props.initialPreviewSourceAction,r.previewSourceContext=r.props.initialPreviewSourceContext,r.fetchActiveUserBrandingInfo=function(){var e=r.props,t=e.user,n=e.sharedLinkInfo;e.brandingInfo||n||!t||r.props.fetchActiveUserBrandingInfoAction(t)},r.fetchControllerMode=function(){var e=r.props,t=e.file,n=e.sharedLinkInfo,i=e.user,o=e.sizeClass;r.props.fetchControllerModeAction({path:t.fq_path,shared_link_url:n&&n.url},i,o)},r.handleHelloSignDeepIntegrationLaunch=function(){if(r.hellosignDeepIntegrationLauncher)return r.hellosignDeepIntegrationLauncher.then((function(e){return e.launch(),e}));var t=r.props,i=t.file,o=t.openInHelloSignSrc,a=t.user;return i&&ie.isBrowseFile(i)&&a?r.hellosignDeepIntegrationLauncher=new Promise((function(t,n){e(["modules/clean/integrations/hellosign_deep_integration/launcher"],t,n)})).then(n.__importStar).then((function(e){var t=(0,e.getLauncher)();return t.init({entryPoint:"file_preview_side_bar",file:i,user:a,source:o}),t})).then((function(e){return e.launch(),e})):Promise.resolve()},r.handleHelloSignAppActionLaunch=function(){var t=r.props,i=t.file,o=t.updateLinkState,a=t.user;i&&ie.isBrowseFile(i)&&a&&new Promise((function(t,n){e(["modules/clean/react/app_actions/redirect"],t,n)})).then(n.__importStar).then((function(t){var s=t.redirectToActionOrShowAuth,l=r.props.hellosignAppAction;l&&(s(a,i,l,{},void 0,(function(e,t){o({actionId:e,linkState:t})})),new Promise((function(t,n){e(["modules/clean/integrations/hellosign_deep_integration/logging"],t,n)})).then(n.__importStar).then((function(e){(0,e.logAppActionLaunch)(i,l)})))}))},r.resetControllerMode=function(){r.props.changeMode(_.FileViewerMode.Default)},r.setupKeymaster=function(){Me=i.default.getScope(),i.default.setScope("fileviewer")},r.cleanupKeymaster=function(){i.default.clearScope("fileviewer"),i.default.setScope(Me)},r.shouldShowOpenInAppBanner=function(){var e=r.props,t=e.hidePageChrome,n=e.isMobileUserAgent;return!t&&((n||J.is_mobile_or_tablet())&&(Se.iOS||Se.is_android())&&void 0!==r.getOpenInAppUrls())},r.openInAppBannerOnClick=function(){b.logUserAction(ne.UserAction.OpenInApp,ne.UserActionContext.OpenInAppBanner)},r.renderOverflowMenuFnFactory=function(e){return function(){var t=r.props,n=t.file,i=t.sharedLinkInfo,a=t.isVersionHistoryMode,s=t.shareToken,l=t.sharePermission,c=t.encryptionOptions;if(i){if(n&&s&&l)return o.default.createElement(_e.AsyncSharedFileMoreDropdown,{user:r.props.user,file:n,sizeClass:r.props.sizeClass,sharedLinkInfo:i,shouldDisplayActionButtons:!r.isViewingFileSubpath,shareToken:s,sharePermission:l,direction:e,encryptionOptions:c})}else{if(a)return null;if(r.props.user&&n)return o.default.createElement(_e.AsyncMountedFileMoreDropdown,{user:r.props.user,file:n,sizeClass:r.props.sizeClass,direction:e})}return null}},r.renderManagers=function(){var e=r.props,t=e.file,n=e.isVersionHistoryMode,i=void 0!==n&&n,a=e.sharedLinkInfo,s=e.user,l=null!=(null==t?void 0:t.ns_id),c=t;return o.default.createElement(o.default.Fragment,null,o.default.createElement(ge.ModeManager,{isViewingFileSubpath:r.isViewingFileSubpath}),o.default.createElement(se.AsyncCommentingDataManager,{currentFile:c,isVersionHistoryMode:i,sharedLinkInfo:a,user:s}),l&&o.default.createElement(ae.AsyncActivityDataManager,{file:c,isVersionHistoryMode:i,user:r.props.user}),l&&!a&&O.isProAnalyticsEnabled(s)&&o.default.createElement(le.AsyncProAnalyticsDataManager,{fileId:c.file_id,user:s}))},r.onTrialBannerClicked=function(){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkUpsellHeaderButtonClicked,F.getWatermarkMilestone(r.props.user)),Y.redirect("/buy?_tk=watermarking_header_upsell")},r.onInterstitialClose=function(){r.props.onAppDownloadInterstitialDismissed()},r.onInterstitialContinue=function(){r.props.onAppDownloadInterstitialDismissed()},r.getKeyboardBindings=a.memoize((function(e){var t=e.isFullscreen,n=e.isWatermarkingMode;return t?[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.Escape},callback:function(){return P.exitFullScreen(ne.UserActionContext.Keyboard)}})]:n?[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.Escape},callback:function(){return r.props.changeMode(_.FileViewerMode.Documentation)}})]:[N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.F},callback:function(){return P.enterFullScreen({logContext:ne.UserActionContext.Keyboard})}}),N.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.Escape},callback:function(e){N.isKeyboardEvent(e)&&r.shouldIgnoreEscape(e)||null==r.props.onCloseViewer||r.props.onCloseViewer()}})]})),r}return n.__extends(s,t),s.prototype.componentWillMount=function(){this.setUpLogging()},s.prototype.componentDidMount=function(){var e=this.props,t=e.fetchShowOverQuotaUpsell,n=e.file,r=e.hasJoinableTeam,i=e.onComponentDidMount,o=e.openInHelloSign,a=e.user,s=e.docClassificationVariant,l=e.fetchDocClassificationAction;if(null!=i&&i(),this.setDocumentTitle(ie.getFilename(n),!0),X.scroll_lock_document(),this.logView(),Ce.UserSurvey.trackEvent("preview_viewed","previews"),r){var c=this.props.suggestTeamInfo,u="1"===Y.get_uri().getQuery().new_user;if(a)(new be.Logger).logExposedToSETOnPreviewEvent(a.id,a.is_cdm_member,a.user_root_permissions,!!c,c?c.joinableTeam.id:void 0,c?c.joinableTeam.membersCount:void 0,u)}t(a),a&&this.previewType&&!this.props.hidePageChrome&&this.props.fetchBestCampaignsAction(a,this.previewType),a&&n&&s&&S.ML_ENDPOINT_FETCH_TYPES.includes(s)&&l(a.id,n.file_id),this.fetchControllerMode(),this.fetchActiveUserBrandingInfo(),o&&this.handleHelloSignDeepIntegrationLaunch()},s.prototype.componentWillUpdate=function(e){var t=e.file;if(t&&t!==this.props.file){this.setDocumentTitle(ie.getFilename(t)),this.previewSourceAction=V.PreviewSourceAction.Click,this.previewSourceContext=V.PreviewSourceContext.FileViewer;var n=e.user,r=e.docClassificationVariant,o=e.fetchDocClassificationAction;n&&r&&S.ML_ENDPOINT_FETCH_TYPES.includes(r)&&o(n.id,t.file_id)}i.default.setScope("fileviewer"),e.mode!==this.props.mode&&this.setState({modeClassnames:"state-"+this.props.mode+"-out state-"+e.mode+"-in"})},s.prototype.componentDidUpdate=function(e){ie.areFilesEqual(e.file,this.props.file)||this.logView(),e.previewApiData&&x.isImage(e.previewApiData.data)&&this.props.previewApiData&&!x.isImage(this.props.previewApiData.data)&&P.exitFullScreen(),this.props.onFullscreenChange&&e.isFullscreen!==this.props.isFullscreen&&this.props.onFullscreenChange(this.props.isFullscreen)},s.prototype.componentWillUnmount=function(){this.unsetDocumentTitle(),X.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),B.Modal.close(),this.resetControllerMode()},Object.defineProperty(s.prototype,"fileSubpath",{get:function(){return this.props.location&&T.getFileSubpath(this.props.location)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"previewType",{get:function(){return this.props.previewApiData&&g.getPreviewType(this.props.previewApiData.data)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"isViewingFileSubpath",{get:function(){return g.isArchive(this.props.previewApiData.data)&&!!this.fileSubpath},enumerable:!1,configurable:!0}),s.prototype.shouldSuppressPassInfo=function(){return null==this.props.file.ns_id},s.prototype.setUpLogging=function(){if(A.FileViewerSession.currentSession=new A.FileViewerSession,this.props.fileViewTarget===G.FileViewTargetType.SHARED_CONTENT_LINK){var e=z.start_time(),t=(new Date).getTime(),n=oe.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE;this.props.user&&c.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER",n,{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid})}},s.prototype.isDownloadDisabled=function(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length},s.prototype.shouldShowAppDownloadInterstitial=function(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data},s.prototype.shouldIgnoreEscape=function(e){var t=document.querySelector(".vjs-fullscreen");return X.focus_in_input()||X.is_input(e.target)||document.querySelector(".annotation-bubble")||this.props.isFullscreen||this.fileSubpath||t||this.props.isEditMode},s.prototype.setDocumentTitle=function(e,t){void 0===t&&(t=!1),this.props.doNotUpdateDocumentTitle||(t&&(ke=document.title),document.title=e)},s.prototype.unsetDocumentTitle=function(){this.props.doNotUpdateDocumentTitle||""!==ke&&(document.title=ke)},s.prototype.logView=function(){var e=this;if(null!==this.props.file.ns_id&&re.getSourceContext()!==V.PreviewSourceContext.SharedLinkCollection&&!this.props.hidePageChrome){var t=function(){p.logView(e.props.file,e.props.user,e.props.fileViewTarget,e.props.fileViewOrigin,e.props.fileViewAction,null!=e.props.sharedLinkInfo?e.props.sharedLinkInfo.url:void 0,e.isDownloadDisabled(),H.Viewer.get_viewer().is_assume_user_session)},n=d.getFileExt(this.props.file);u.isCloudDocByExtension(n)?setTimeout((function(){return t()}),u.CLOUD_DOCS_PASS_LOG_DELAY_MS):t()}},s.prototype.isImagePreviewAnnotationEnabled=function(){return!(this.props.sizeClass===j.SizeClass.Small)&&!this.props.hidePageChrome},s.prototype.renderFlippableControls=function(){if(!(this.props.forceDisplayToolbar||this.props.isFullscreen||this.isImagePreviewAnnotationEnabled()||null==this.props.fileIndex||[f.PreviewType.Video,f.PreviewType.Audio].includes(this.previewType)||this.props.isEditMode))return o.default.createElement(k.FlippableControls,{index:""+(this.props.fileIndex+1),numFlippableFiles:this.props.fileCount,onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious})},s.prototype.getOpenInAppUrls=function(){var e=this.props,t=e.file,n=e.shareToken,r=e.sharePermission,i=e.user;if(t&&n&&r)return t.open_in_app_data;if(Se.iOS&&i){var o=encodeURIComponent(t.fq_path),a=encodeURIComponent(i.id);return{platform:Ee.OpenInMobileAppPlatform.IPHONE,iOSAppUrl:"dbapi-5://1/viewPath?path="+o+"&userId="+a,iOSAppStoreUrl:"https://itunes.apple.com/us/app/dropbox/id327630330?mt=8e"}}if(Se.is_android()){return{platform:Ee.OpenInMobileAppPlatform.ANDROID_MARKET,androidAppUrl:"/dl/home/mobile?mobile_app_fallback"}}},s.prototype.renderFilePreview=function(){var e=this.props,t=e.isEditMode,n=e.isInbandExperiment,i=e.file,a=e.shareToken,s=e.sharePermission;return o.default.createElement("div",{className:r.default("react-file-viewer__preview","react-file-preview",{"react-file-viewer__preview--edit-mode":t})},o.default.createElement("div",{className:"flex-preview-container"},this.maybeRenderFidelitySurvey(),this.renderReportFlag(),this.shouldShowOpenInAppBanner()&&o.default.createElement(W.OpenInAppBanner,{urls:this.getOpenInAppUrls(),onClick:this.openInAppBannerOnClick,isMountedFile:!(i&&a&&s)}),o.default.createElement(M.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,previewApiData:this.props.previewApiData,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isInbandExperiment:n,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,location:this.props.location,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!1,sidebar:this.props.sidebar,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled()||this.props.forceDisplayToolbar,sizeClass:this.props.sizeClass,user:this.props.user,mode:this.props.mode,showCloudDocPreview:this.props.showCloudDocPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant,encryptionOptions:this.props.encryptionOptions,onPreviewSessionInitialized:this.props.onPreviewSessionInitialized}),this.renderFlippableControls()))},s.prototype.shouldRenderSidebar=function(){return this.props.sizeClass!==j.SizeClass.Small&&!this.props.isFullscreen&&!this.props.hidePageChrome&&null!=this.props.file.ns_id},s.prototype.renderSidebar=function(){if(!this.shouldRenderSidebar())return null;var e=this.props,t=e.sizeClass,n=e.file,i=e.user,a=e.brandingInfo,s=e.activeUserBrandingInfo,l=e.sharedLinkInfo,c=e.hellosignAppAction,u=e.isVersionHistoryMode,d=e.shareToken,p=e.sharePermission,m=e.canRestoreRevision,f=e.onRestoreRevision,g=e.sidebar,_=e.encryptionOptions,h=e.expGrowthActSmbWorkflowsBaton,v=e.isCapture;return o.default.createElement("div",{className:r.default("react-file-viewer__sidebar",{"react-file-viewer__sidebar--closed":g.visibility===me.SidebarVisibility.Closed}),"data-preview-type":this.previewType,"data-theme":"web"},o.default.createElement(I.Sidebar,{sizeClass:t,file:n,user:i,brandingInfo:null!=a?a:s,sharedLinkInfo:l,hellosignAppAction:c,isVersionHistoryMode:u,isViewingFileSubpath:!!this.isViewingFileSubpath,sharePermission:p,shareToken:d,previewType:this.previewType,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isCapture:v,onHelloSignAppActionLaunch:this.handleHelloSignAppActionLaunch,onHelloSignDeepIntegrationLaunch:this.handleHelloSignDeepIntegrationLaunch,canRestoreRevision:m,onRestoreRevision:f,renderSidebarOverflowMenuFn:this.renderOverflowMenuFnFactory(ne.OverflowMenuDirection.BELOW),encryptionOptions:_,expGrowthActSmbWorkflowsBaton:h}))},s.prototype.shouldRenderMobileWebComments=function(){return this.props.sizeClass===j.SizeClass.Small},s.prototype.renderMobileComments=function(){var e=this.props,t=e.file,n=e.sharedLinkInfo,r=e.sizeClass,i=e.user,a=e.isFullscreen;return!this.shouldRenderMobileWebComments()||a||this.isViewingFileSubpath||this.props.hidePageChrome||null==t.ns_id?null:o.default.createElement(l.MobileWebComments,{currentFile:t,previewType:this.previewType,sharedLinkInfo:n,user:i,sizeClass:r,encryptionOptions:this.props.encryptionOptions})},s.prototype.renderBanner=function(){return o.default.createElement("div",{className:"react-file-viewer__banner"},this.renderUpsellBanner(),this.renderTrialBanner())},s.prototype.renderBrandingModalController=function(){var e=this.props,t=e.brandingInfo,n=e.isFullscreen,r=e.hidePageChrome,i=e.file,a=e.sharedLinkInfo;return n||r||!i||null===i.ns_id?null:o.default.createElement(Pe.BrandingModalController,{brandingInfo:t,closeButtonText:Z.intl.formatMessage({id:"D/tUrq",defaultMessage:"View file"}),sharedLinkInfo:a})},s.prototype.renderTitleBar=function(){return this.props.isFullscreen||this.props.hidePageChrome&&!g.isArchive(this.props.previewApiData.data)?null:this.props.mode===_.FileViewerMode.Watermarking?o.default.createElement(he.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],title:Z.intl.formatMessage({id:"TJfgIg",defaultMessage:"Watermarking"}),mode:_.FileViewerMode.Watermarking,sizeClass:this.props.sizeClass}):this.props.mode===_.FileViewerMode.Markup?o.default.createElement(he.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],title:Z.intl.formatMessage({id:"PSIegi",defaultMessage:"Markup"}),beta:!0,mode:_.FileViewerMode.Markup,sizeClass:this.props.sizeClass}):o.default.createElement(pe.FileTitleBar,{file:this.props.file,maxFilenameEmLength:ne.SizeClassFilenameLengthMap[this.props.sizeClass],isViewingFileSubpath:this.isViewingFileSubpath,user:this.props.user||null,isSidebarOpen:this.props.sidebar.visibility===me.SidebarVisibility.Open,closeUrl:this.props.titleBarCloseUrl,onClose:this.props.onCloseViewer,canClose:this.props.canClose,hidePageChrome:this.props.hidePageChrome,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,isVersionHistoryMode:this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,fileSubpath:this.fileSubpath,previewType:this.previewType,renderTitlebarOverflowMenuFn:this.renderOverflowMenuFnFactory(ne.OverflowMenuDirection.BELOW)})},s.prototype.shouldAllowFileDonation=function(){return null==this.props.sharedLinkInfo&&(null==this.props.user||this.props.user.home_ns_id===this.props.file.ns_id)},s.prototype.maybeRenderFidelitySurvey=function(){var e=this.props,t=e.file,n=e.hidePageChrome,r=e.isEditMode,i=e.renderStatus,a=e.sizeClass;return re.canShowFidelitySurvey({file:t,sizeClass:a,hidePageChrome:n,renderStatus:i,isEditMode:r})?o.default.createElement(K.FidelitySurvey,{allowFileDonation:this.shouldAllowFileDonation(),file:t}):null},s.prototype.renderReportFlag=function(){return this.props.sharedLinkInfo&&!1!==this.props.sharedLinkInfo.hasPublicAudienceOrVisibility&&!this.props.hidePageChrome?o.default.createElement(de.AsyncReportFlag,{sharedLink:this.props.sharedLinkInfo.url,previewType:this.previewType}):null},s.prototype.renderUpsellBanner=function(){return this.props.showOverQuotaUpsell?o.default.createElement(C.ExpFileViewerUpsellBannerV2,null):null},s.prototype.renderTrialBanner=function(){var e=this.props,t=e.mode;return e.isTrialMode?o.default.createElement(ue.Banner,{mode:t,onClick:this.onTrialBannerClicked}):null},s.prototype.shouldRenderSETHeader=function(){return!(this.state.dismissedSETHeader||!this.props.suggestTeamInfo||!this.props.user||this.props.hidePageChrome||this.props.sizeClass===j.SizeClass.Small)},s.prototype.renderSETHeader=function(){var e=this;if(this.shouldRenderSETHeader()){var t=this.props,n=t.suggestTeamInfo,r=t.user;if(n&&r)return o.default.createElement(v.SurfaceExistingTeamsHeader,{suggestTeamInfo:n,user:r,dismissHeader:function(){return e.setState({dismissedSETHeader:!0})}})}return null},s.prototype.renderExperimentHeader=function(){return this.renderSETHeader()},s.prototype.render=function(){var e=this.props,t=e.className,n=e.file,i=e.hidePageChrome,a=e.isFullscreen,s=e.sharedLinkInfo,l=e.transparentBackground,c=e.user,u=e.isEditMode,d=void 0!==u&&u,p=e.isWatermarkingMode,m=void 0!==p&&p,g=e.campaign,_=ie.getFilename(n),h=this.previewType;return this.shouldShowAppDownloadInterstitial()?o.default.createElement(ve.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},o.default.createElement("div",{"aria-label":_},o.default.createElement(w.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:s,file:n,previewType:h,fileViewerSession:A.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue}))):o.default.createElement(ye.LayerContext.Provider,{value:500},o.default.createElement(ve.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},o.default.createElement(D.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},o.default.createElement(Ae,{ns_id:n.ns_id},o.default.createElement("div",{"aria-label":_,className:r.default("react-file-viewer","preview-type-"+(this.previewType?this.previewType.toLowerCase():"unknown"),t,this.state.modeClassnames,{"no-background":l&&!a,"react-file-viewer--edit-mode":d}),style:{top:this.props.hidePageChrome&&!this.props.isFullscreen?this.props.headerHeight:"0"},role:"dialog"},this.renderExperimentHeader(),o.default.createElement(R.KeyboardBindingConnector,{keyboardBindings:this.getKeyboardBindings({isFullscreen:a,isWatermarkingMode:m})}),this.renderBanner(),o.default.createElement("div",{className:"react-file-viewer__main"},g&&c&&!i?o.default.createElement(fe.FileViewerPrompt,{user:c,campaign:g}):null,o.default.createElement("div",{className:r.default("react-file-viewer__content","comments2",{"comments2-mobile-web":this.shouldRenderMobileWebComments(),"comments2-annotation-enabled":!0,"video-audio":this.previewType===f.PreviewType.Video||this.previewType===f.PreviewType.Audio,"react-file-viewer__content--edit-mode":d}),"data-preview-type":h,"data-theme":"web"},this.renderTitleBar(),this.renderFilePreview(),this.renderMobileComments(),this.renderManagers(),this.renderBrandingModalController()),this.renderSidebar()))))))},s.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:G.OREF_CONSTANTS.BROWSE_UNKNOWN,sizeClass:j.SizeClass.Large,fileCount:0,showCloudDocPreview:!1},s})(o.default.Component);t._FileViewer=Te;var Ae=function(e){var t=e.children;return null==e.ns_id?o.default.createElement(o.default.Fragment,null,t):o.default.createElement(h.FileSidebarProvider,null,t)},Ie=U.withLocation((function(e){return null!=e.file?o.default.createElement(Te,n.__assign({},e)):o.default.createElement("div",null)})),Fe=q.withSizeClass(Ie,{isResponsiveEnabled:re.isResponsiveEnabled,responsiveClassName:ne.ResponsiveClassName}),Oe=ce.withTranslations(Fe),xe={onAppDownloadInterstitialDismissed:y.dismissAppDownloadInterstitial,fetchShowOverQuotaUpsell:y.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:y.setRenderStatusSuccessForCurrentFile,fetchControllerModeAction:y.fetchControllerModeAction,fetchActiveUserBrandingInfoAction:y.fetchActiveUserBrandingInfoAction,fetchBestCampaignsAction:y.fetchBestCampaignsAction,fetchDocClassificationAction:y.fetchDocClassificationAction,changeMode:y.changeMode,updateLinkState:we.updateLinkState},De=s.connect((function(e,t){var n=Q.getAppDownloadInterstitial(e);void 0===n&&t&&(n=t.appDownloadInterstitialDismissed);var r=Q.getActiveFile(e);return{appDownloadInterstitialDismissed:n,file:r,hellosignAppAction:(function(){if(r)return Q.getHelloSignAppActionForFile(e,r)})(),mode:Q.getMode(e),isFullscreen:Q.getIsFullScreen(e),isSidebarOpen:Q.getIsSidebarOpen(e),renderStatus:Q.getRenderStatusForCurrentFile(e),showOverQuotaUpsell:Q.getShowOverQuotaUpsell(e),sidebar:Q.getSidebar(e),isEditMode:Q.getIsEditMode(e),isWatermarkingMode:Q.getIsWatermarkingMode(e),isTrialMode:Q.getIsTrialMode(e),campaign:Q.getSelectedPromptCampaign(e),activeUserBrandingInfo:Q.getActiveUserBrandingInfo(e),previewApiData:$.getApiDataForFile(e,r),extensionsEnabled:Q.getExtensionsEnabled(e),docClassificationVariant:(function(){if(!r)return null;var t=ie.getExtension(r);return t&&!1!==S.ML_EXPERIMENT_EXTENSIONS.includes(t)&&(ee.isHelloSignAppActionInFileViewerSidebarEnabled(e)||ee.isHelloSignDeepIntegrationInFileViewerSidebarEnabled(e))&&ee.isHelloSignMLClassificationEnabled(e)?ee.getHelloSignMLClassificationVariant(e):null})()}}),xe)(Oe),Re=E.getStoreForFileViewer(),Ne=te.requireCssWithComponent((function(e){return o.default.createElement(s.Provider,{store:Re},o.default.createElement(De,n.__assign({},e)))}),["/static/css/preview_flexbox_layout-vflNFyVwu.css","/static/css/react_file_viewer-vfldZQLtI.css","/static/css/react_title_bar-vflSGo9Xd.css","/static/css/spectrum/index.web-vflmHVRF-.css","/static/js/file-viewer/index.web-vfl2yOvim.css","/static/js/pro-ui/index.web-vfliiqu7T.css"]);t.FileViewer=Ne})),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","react","modules/clean/react/sprite","modules/core/i18n"],(function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlippableControls=void 0;var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePreviousClick=function(){t.props.onPrevious&&t.props.onPrevious()},t.handleNextClick=function(){t.props.onNext&&t.props.onNext()},t}return n.__extends(t,e),t.prototype.getNavText=function(){return o.intl.formatMessage({id:"CQTi9x",defaultMessage:"{cur_file_num} of {num_total_files}"},{cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})},t.prototype.render=function(){if(this.props.numFlippableFiles<=1)return null;var e=o.intl.formatMessage({id:"J7UPY9",defaultMessage:"Flip left"}),t=o.intl.formatMessage({id:"vVU6YH",defaultMessage:"Flip right"});return r.default.createElement("div",{className:"react-file-viewer__controls"},r.default.createElement("button",{className:"nav-control",onClick:this.handlePreviousClick},r.default.createElement(i.Sprite,{group:"web",name:"s_flip_left",alt:e})),r.default.createElement("div",{className:"nav-text"},this.getNavText()),r.default.createElement("button",{className:"nav-control",onClick:this.handleNextClick},r.default.createElement(i.Sprite,{group:"web",name:"s_flip_right",alt:t})))},t})((r=n.__importDefault(r)).default.Component);t.FlippableControls=a})),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],(function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toggleFullScreen=t.isBrowserFullScreen=t.browserSupportFullScreen=t.exitFullScreen=t.enterFullScreen=void 0;var a=n.getStoreForFileViewer(),s=function(){return a.dispatch(r.closeFullScreen())};var l=s;function c(){g()||f(o.UserActionContext.Browser)}function u(){f(o.UserActionContext.Browser)}function d(){var e;e=c,document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e),(function(e){window.addEventListener("popstate",e)})(u)}function p(){var e;e=c,document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e),(function(e){window.removeEventListener("popstate",e)})(u)}function m(e){var t,n=e.dispatchFunction,c=e.logContext,u=e.shouldDispatchReduxAction,p=void 0===u||u;(function(e){void 0===e&&(e=s),l=e})(n),p&&a.dispatch(r.openFullScreen()),null!=(t=document.body).requestFullscreen?t.requestFullscreen():null!=t.msRequestFullscreen?t.msRequestFullscreen():null!=t.mozRequestFullScreen?t.mozRequestFullScreen():null!=t.webkitRequestFullscreen&&t.webkitRequestFullscreen(),d(),c&&i.logUserAction(o.UserAction.ToggleFullscreenOn,c)}function f(e){var t;p(),l(),(t=document).exitFullscreen?t.exitFullscreen():t.msExitFullscreen?t.msExitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen(),e&&i.logUserAction(o.UserAction.ToggleFullscreenOff,e)}function g(){var e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}t.enterFullScreen=m,t.exitFullScreen=f,t.browserSupportFullScreen=function(){var e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen},t.isBrowserFullScreen=g,t.toggleFullScreen=function(e,t){return e||g()?f(t):m({logContext:t})}})),define("modules/clean/react/file_viewer/mode_manager",["require","exports","tslib","react","react-redux","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","file-viewer/core/index"],(function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModeManager=t.UnconnectedModeManager=void 0;var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentDidUpdate=function(){this.unavailableModes()[this.props.mode]&&this.props.mode!==s.FileViewerMode.Default&&this.props.changeMode(s.FileViewerMode.Default)},t.prototype.unavailableModes=function(){var e=n.__assign({},this.props.disabledModes);return this.props.isViewingFileSubpath&&(e[s.FileViewerMode.Commenting]=!0),e},t.prototype.render=function(){return null},t})((r=n.__importDefault(r)).default.PureComponent);t.UnconnectedModeManager=l,t.ModeManager=i.connect((function(e){return{mode:o.getMode(e),disabledModes:o.getDisabledModes(e)}}),{changeMode:a.changeMode})(l)}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButton=void 0,t.OpenButton=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer/open_button/open_button_component"],t,n)})).then(__importStar).then((function(e){return e.OpenButton}))}})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer/prompt/loadable_prompt",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileViewerPrompt=void 0,t.FileViewerPrompt=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer/prompt/prompt"],t,n)})).then(__importStar).then((function(e){return e.SyncFileViewerPrompt}))}})})),define("modules/clean/react/file_viewer/utils",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/core/browser","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/previews/data/preview_type_util","modules/core/uri","modules/clean/react/previews/constants","modules/clean/react/previews/image_helpers","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/constants","modules/clean/previews/api"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f){"use strict";function g(){return new c.URI({path:"/login",query:{cont:i.get_href()}}).toString()}function _(e){return!e}function h(){var e=i.get_uri().path;return/^\/(home|work|personal|search)/.test(e)?u.PreviewSourceContext.Browse:/^\/h$/.test(e)?u.PreviewSourceContext.Home:/^\/(s|scl\/fi)\//.test(e)?u.PreviewSourceContext.SharedLinkFile:/^\/(sh|scl\/fo)\//.test(e)?u.PreviewSourceContext.SharedLinkFolder:/^\/sc\//.test(e)?u.PreviewSourceContext.SharedLinkCollection:/^\/history/.test(e)?u.PreviewSourceContext.VersionHistory:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.isResponsiveEnabled=t.fetchRivieraStatusCode=t.preloadImages=t.getSourceAction=t.getSourceContext=t.canShowFidelitySurvey=t.canUserUsePaper=t.canDownloadFile=t.isFileEditable=t.isMountedFile=t.getFileViewerInterfaceTypeForSharedLink=t.sharedLinkLoginUrl=t.getSharedLinkLoginUrl=t.cleanupPrerenderPreview=t.modalIsUp=t.getSplitButtonUserActionContext=t.TooltipHelpers=void 0,r=n.__importStar(r),i=n.__importStar(i),d=n.__importStar(d),t.TooltipHelpers={fetchTooltipInfo:function(e,t){r.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return t(e)},subject_user:e})},getVendorAndApplication:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];for(var i in r){if(r.hasOwnProperty(i))if(r[i].extensions.indexOf(t)>-1)return{vendor:n,application:i}}}return null},logImpression:function(e,t,n){"acrobat_or_reader"===n?r.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:n,extension:e},subject_user:t}):r.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:n,extension:e},subject_user:t})}},t.getSplitButtonUserActionContext=function(e,t){if(e===a.SplitButtonActionLocation.Main){if(t===a.FileViewerPane.TitleBar)return a.UserActionContext.TitleBarMain;if(t===a.FileViewerPane.PreviewContent)return a.UserActionContext.PreviewContentMain}else if(e===a.SplitButtonActionLocation.Split){if(t===a.FileViewerPane.TitleBar)return a.UserActionContext.TitleBarSplitButton;if(t===a.FileViewerPane.PreviewContent)return a.UserActionContext.PreviewContentSplitButton}return a.UserActionContext.Unknown},t.modalIsUp=function(){for(var e=!1,t=document.getElementsByClassName("db-modal-wrapper"),n=0;!e&&n<t.length;n++){e="none"!==window.getComputedStyle(t[n]).display}return e},t.cleanupPrerenderPreview=function(){var e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,(function(e){e.style.display="none"}))},t.getSharedLinkLoginUrl=g,t.sharedLinkLoginUrl=g(),t.getFileViewerInterfaceTypeForSharedLink=function(e){switch(e){case o.PreviewType.Image:return a.FileViewerInterfaceType.Window;case o.PreviewType.SsrDoc:return a.FileViewerInterfaceType.Frame;default:return}},t.isMountedFile=_,t.isFileEditable=function(e){return!!e&&(s.isBrowseFile(e)&&!e.read_only)},t.canDownloadFile=function(e,t){return _(e)||t&&t.canDownloadRoles.length>0},t.canUserUsePaper=function(e){return null!=e&&!e.is_paper_disabled},t.canShowFidelitySurvey=function(e){var t=e.file,n=e.renderStatus,r=e.hidePageChrome,i=e.sizeClass,o=e.isEditMode;return!!t&&(n===p.PreviewRenderStatus.Succeeded&&(!r&&(i!==m.SizeClass.Small&&!o)))},t.getSourceContext=h,t.getSourceAction=function(){switch(h()){case u.PreviewSourceContext.SharedLinkFile:case u.PreviewSourceContext.SharedLinkFolder:return u.PreviewSourceAction.Visit;default:return u.PreviewSourceAction.Click}},t.preloadImages=function(e,t){if(0!==e.length){var n=[];[0,1,2,3,4,5,6,-1,-2].forEach((function(r){var i=(t+r+e.length)%e.length;-1===n.indexOf(i)&&n.push(i)})),n.forEach((function(t){if(e.length>t&&l.isImage(e[t])){var n=e[t];if(n){var r=n.content.thumbnail_url_tmpl||n.preview_url;r&&d.preloadResponsiveImage(r)}}}))}},t.fetchRivieraStatusCode=function(e,t,n){void 0===n&&(n=function(){});var r=new XMLHttpRequest;return r.open("GET",e),r.withCredentials=!0,r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE){var e=f.getParsedDropboxMetadataHeader(r);e.rivieraStatusCode?t(e.rivieraStatusCode):n()}},r.send(),r},t.isResponsiveEnabled=function(){return h()!==u.PreviewSourceContext.VersionHistory}})),define("modules/clean/react/file_viewer_sidebar/buttons/icon",["require","exports","tslib","react","spectrum/icon_action/index","spectrum/colorized_icon/index"],(function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonIcon=void 0,r=n.__importDefault(r);t.ButtonIcon=function(e){var t=e.isPrimary,a=n.__rest(e,["isPrimary"]);return r.default.createElement(o.ColorizedIcon,{color:t?"white":"#717781"},r.default.createElement(i.IconAction,n.__assign({},a)))}}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/buttons/more_dropdown",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncMountedFileMoreDropdown=t.AsyncSharedFileMoreDropdown=void 0,t.AsyncSharedFileMoreDropdown=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer/shared_file_actions"],t,n)})).then(__importStar).then((function(e){return e.SharedFileMoreDropdown}))}}),t.AsyncMountedFileMoreDropdown=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer/mounted_file_actions"],t,n)})).then(__importStar).then((function(e){return e.MountedFileMoreDropdown}))}})})),define("modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/file_viewer/open_button/open_button"],(function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncExtensionsButton=t.AsyncOpenButton=t.AsyncSpacesDropdown=t.AsyncShareButton=void 0,r=n.__importDefault(r),t.AsyncShareButton=i.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer/share_button"],t,n)})).then(n.__importStar).then((function(e){return e.ShareButton}))}}),t.AsyncSpacesDropdown=i.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer/spaces_dropdown"],t,n)})).then(n.__importStar).then((function(e){return e.SpacesDropdown}))}}),Object.defineProperty(t,"AsyncOpenButton",{enumerable:!0,get:function(){return a.OpenButton}}),t.AsyncExtensionsButton=function(e){return r.default.createElement("div",{className:"control__button"},r.default.createElement(o.ExtensionsMenu,n.__assign({},e)))}}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions",["require","exports","modules/clean/react/async/loadable","modules/clean/react/share_download/button"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncShareDownloadButton=t.AsyncOpenInAppButton=t.AsyncExtensionsMenuNoUnity=t.AsyncSignInButton=t.AsyncEditNowButton=void 0,t.AsyncEditNowButton=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/cloud_docs/edit_now_button"],t,n)})).then(__importStar).then((function(e){return e.EditNowButton}))}}),t.AsyncSignInButton=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/sign_in/button"],t,n)})).then(__importStar).then((function(e){return e.SignInButton}))}}),t.AsyncExtensionsMenuNoUnity=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/extensions/extensions_menu_component_v2"],t,n)})).then(__importStar).then((function(e){return e.ExtensionsMenuV2NoUnity}))}}),t.AsyncOpenInAppButton=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/open_in_app/button"],t,n)})).then(__importStar).then((function(e){return e.OpenInAppButton}))}}),Object.defineProperty(t,"AsyncShareDownloadButton",{enumerable:!0,get:function(){return r.ShareDownloadButton}})})),define("modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions",["require","exports","tslib","react","classnames","spectrum/button/index","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/core/i18n"],(function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RestoreButton=void 0,r=n.__importDefault(r),i=n.__importDefault(i),t.RestoreButton=function(e){var t=s.intl.formatMessage({id:"PL5ta5",defaultMessage:"Restore"});return r.default.createElement(o.Button,{variant:"primary",className:i.default("control__button","restore-button",{"control__button--collapsed":e.isCollapsed}),onClick:e.onClick},e.isCollapsed?r.default.createElement(a.ButtonIcon,{isPrimary:!0,name:"restore-file","aria-label":t}):t)}}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncActivityDataManager=void 0,t.AsyncActivityDataManager=n.Loadable({loader:function(){return r.waitForTTI().then((function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/data_managers/activity_data_manager"],t,n)})).then(__importStar)})).then((function(e){return e.ActivityDataManager}))}})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCommentingDataManager=void 0,t.AsyncCommentingDataManager=n.Loadable({loader:function(){return r.waitForTTI().then((function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/data_managers/commenting_data_manager"],t,n)})).then(__importStar)})).then((function(e){return e.CommentingDataManager}))}})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_pro_analytics_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncProAnalyticsDataManager=void 0,t.AsyncProAnalyticsDataManager=n.Loadable({loader:function(){return r.waitForTTI().then((function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/data_managers/pro_analytics_data_manager"],t,n)})).then(__importStar)})).then((function(e){return e.ProAnalayticsDataManager}))}})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/esign_upsell/async_esign_upsell",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncEsignUpsell=void 0,t.AsyncEsignUpsell=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell"],t,n)})).then(__importStar).then((function(e){return e.EsignUpsell}))}})})),define("modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell",["require","exports","tslib","react","dig-components/typography","dig-components/buttons","modules/core/i18n","modules/clean/react/components/css","react","modules/clean/react/file_viewer_sidebar/esign_upsell/use_show_esign_upsell"],(function(e,t,n,r,i,o,a,s,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EsignUpsell=void 0,r=n.__importStar(r);t.EsignUpsell=s.requireCssWithComponent((function(t){var s=t.isCollapsed,u=t.userId,d=t.file,p=t.launchHelloSignDeepIntegration,m=l.useState(!1),f=m[0],g=m[1],_=l.useRef(!0);r.useEffect((function(){return _.current=!0,function(){_.current=!1}}));var h=c.useShowEsignUpsell(u,d),v=h.showEsignUpsell,b=h.stormcrowVariant,w=h.productPlanType;return s||f||!v?null:r.createElement("div",{className:"esign-upsell-dialog"},r.createElement(i.Title,{size:"standard",isBold:!0},a.intl.formatMessage({id:"14Lkt7",defaultMessage:"Collect signatures on your documents right from Dropbox"})),r.createElement(i.Text,{className:"esign-upsell-subtext",tagName:"p",isBold:!0},"PLUS"===w?a.intl.formatMessage({id:"Chr0Rd",defaultMessage:"Add e-sign to your plan and upgrade to Professional"}):a.intl.formatMessage({id:"jA1VlD",defaultMessage:"Add eSign to your plan"})),r.createElement(i.Text,{className:"esign-upsell-subtext",tagName:"p"},r.createElement("li",null,a.intl.formatMessage({id:"tIBR0E",defaultMessage:"Unlimited documents for signature"})),r.createElement("li",null,a.intl.formatMessage({id:"8oG+3m",defaultMessage:"5 templates for commonly signed documents"})),r.createElement("li",null,a.intl.formatMessage({id:"nnCgRS",defaultMessage:"Tamper-proofing and audit trail included"}))),r.createElement("div",{className:"esign-upsell-footer"},r.createElement(o.Button,{variant:"primary",onClick:function(t){t&&t.preventDefault(),Promise.all([new Promise((function(t,n){e(["modules/clean/account_page/widgets/plan/views/change_plan_modal"],t,n)})).then(n.__importStar),new Promise((function(t,n){e(["modules/clean/payments/skus/constants"],t,n)})).then(n.__importStar)]).then((function(e){var t=e[0],n=t.ChangePlanModalView,r=t.ChangePlanOrigin,i=e[1].ProductPlanType;_.current&&n.showInstance({origin:"V1"===b?r.ESIGN_UPSELL_V1:r.ESIGN_UPSELL_V2,admissiblePlans:[i.HS_DBX_PRO_BUNDLE],hideDetailsCurrentPlan:!0,defaultSelectedPlan:i.HS_DBX_PRO_BUNDLE,hideUpdateBillingInfo:!0,launchHelloSignDeepIntegration:p})})),g(!0)},"data-uxa-log":"preview-esign-upsell-continue"},a.intl.formatMessage({id:"BVa7ab",defaultMessage:"Continue"})),r.createElement("div",{className:"esign-upsell-secondary-button"},r.createElement(o.Button,{variant:"transparent",onClick:function(){g(!0),c.trackClickAction(u)},"data-uxa-log":"preview-esign-upsell-dismiss"},a.intl.formatMessage({id:"zBnSR/",defaultMessage:"Not now"})))))}),["/static/css/file_viewer_sidebar/esign_upsell-vfl4W6PKM.css"])})),define("modules/clean/react/file_viewer_sidebar/esign_upsell/use_show_esign_upsell",["require","exports","react","api_v2/user_client","modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell_user_actions_tracker"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackClickAction=t.useShowEsignUpsell=void 0,t.useShowEsignUpsell=function(e,t){var o=n.useState(!1),a=o[0],s=o[1],l=n.useState("OFF"),c=l[0],u=l[1],d=n.useState("UNKNOWN"),p=d[0],m=d[1];return n.useEffect((function(){void 0!==e&&void 0!==t&&(new r.UserApiV2Client).ns("growth_bundling").rpc("show_pro_esign_upsell",{sjid:t.sjid,ns_id:t.ns_id,file_ext:t.ext.slice(1)},{subjectUserId:e}).then((function(t){t.show_campaign&&(s(!0),u(t.variant||""),m(t.product_plan_type||""),new i.EsignUpsellUserActionTracker(e).track(i.EsignUpsellUserAction.SHOW))}))}),[e,t]),{showEsignUpsell:a,stormcrowVariant:c,productPlanType:p}},t.trackClickAction=function(e){void 0!==e&&new i.EsignUpsellUserActionTracker(e).track(i.EsignUpsellUserAction.CLICK,{})}})),define("modules/clean/react/file_viewer_sidebar/panes/commenting_pane",["require","exports","tslib","react","file-viewer/modes/index","modules/clean/react/async/loadable","file-viewer/core/index"],(function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentingPane=void 0,r=n.__importDefault(r);var s=o.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/panes/commenting_pane_contents"],t,n)})).then(n.__importStar).then((function(e){return e.CommentingPaneContents}))}});t.CommentingPane=function(e){var t=e.coreFVUiProps,o=e.encryptionOptions,l=e.user;return r.default.createElement(i.Pane,n.__assign({paneId:a.SidebarPaneId.Comments},t),r.default.createElement(s,{encryptionOptions:o,user:l}))}})),define("modules/clean/react/file_viewer_sidebar/panes/documentation_pane",["require","exports","tslib","react","file-viewer/modes/index","file-viewer/core/index","modules/clean/em_string","modules/clean/file_store/utils","dig-components/typography","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","react-redux","modules/clean/react/file_viewer_sidebar/panes/file_activity_section","modules/clean/react/file_viewer_sidebar/panes/loadable_details_section","modules/clean/react/file_viewer_sidebar/panes/loadable_tasks_section","modules/clean/react/branding/optional_branding_block","modules/clean/filepath/filepath"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentationPane=t.ConnectedDocumentationPaneComponent=t.UnconnectedDocumentationPaneComponent=void 0,r=n.__importDefault(r),h=n.__importStar(h),t.UnconnectedDocumentationPaneComponent=function(e){var t=e.file,c=e.user,d=e.maxFilenameEmLength,p=e.brandingInfo,v=e.sharedLinkInfo,b=e.isVersionHistoryMode,w=e.coreFVUiProps,y=e.expGrowthActSmbWorkflowsBaton,S=a.Emstring.em_snippet(s.getFilename(t),d),E=t.fq_path,P=E&&c&&!h.inSubDirectory(c.cdm_tmf_path,E);return r.default.createElement(i.Pane,n.__assign({paneId:o.SidebarPaneId.Documentation},w),r.default.createElement("div",{className:"documentation-pane"},r.default.createElement(_.OptionalBrandingBlock,{className:"documentation-pane__branding-block",brandingInfo:p,sharedLinkInfo:v}),r.default.createElement(l.Title,{className:"documentation-pane__title"},S),r.default.createElement(f.LoadableDetailsSection,{title:u.DocumentationPaneStrings.details,file:t,user:c,sharedLinkInfo:v,pushMetadataPaneHandler:function(){return e.pushSidebarPane(o.SidebarPaneId.Metadata)}}),y&&P&&r.default.createElement(g.LoadableTasksSection,{title:u.DocumentationPaneStrings.tasks,file:t}),r.default.createElement(m.ConnectedFileActivitySection,{file:t,user:c,isVersionHistoryMode:b,title:u.DocumentationPaneStrings.activity,pushActivityPaneHandler:function(){return e.pushSidebarPane(o.SidebarPaneId.Activity)}})))};var v={pushSidebarPane:d.pushSidebarPane};t.ConnectedDocumentationPaneComponent=p.connect(null,v)(t.UnconnectedDocumentationPaneComponent),t.DocumentationPane=c.requireCssWithComponent(t.ConnectedDocumentationPaneComponent,["/static/css/file_viewer_sidebar/documentation_pane-vflVp3XEa.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/editing_pane",["require","exports","tslib","react","classnames","file-viewer/modes/index","modules/clean/react/components/css"],(function(e,t,n,r,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditingPane=t.EditingPaneComponent=void 0,r=n.__importDefault(r),i=n.__importDefault(i);var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){var e=this.props.paneId,t=document.querySelector('[data-control-id="'+e+'"]');t&&t.focus()},t.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,a=e.paneId,s=e.children,l=e.classname;return r.default.createElement(o.Pane,n.__assign({paneId:a,className:"editing-pane-wrapper"},t),r.default.createElement("div",{"aria-labelledby":"react-file-viewer__title-bar","aria-modal":"true",className:i.default("editing-pane",l),role:"dialog"},s))},t})(r.default.PureComponent);t.EditingPaneComponent=s,t.EditingPane=a.requireCssWithComponent(s,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/file_activity_section",["require","exports","tslib","react","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary","dig-components/icons","dig-components/icons/src","dig-components/typography","modules/clean/react/file_viewer_sidebar/panes/strings"],(function(e,t,n,r,i,o,a,s,l,c,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedFileActivitySection=t.UnconnectedFileActivitySection=void 0,r=n.__importDefault(r),o=n.__importStar(o);var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.activities,n=e.user,i=e.isVersionHistoryMode,o=e.isFileActivityEnabled,a=e.title,p=e.pushActivityPaneHandler,m=e.file;if(!n||i||!o)return null;var f=t&&!t.loading&&0!==t.value.length;return r.default.createElement("div",{className:"documentation-pane__section"},r.default.createElement(u.Title,{className:"documentation-pane__section-title",size:"small"},a),r.default.createElement(s.LoadableFileActivityStreamSummary,{file:m,user:n,maxVisibleActivityCards:2}),f&&r.default.createElement("div",{className:"documentation-pane__push-pane-button-wrapper"},r.default.createElement(u.Link,{href:"#",onClick:p},d.ActivitySectionStrings.viewAllActivities,r.default.createElement("span",{className:"documentation-pane__arrow-right-icon"},r.default.createElement(l.UIIcon,{size:"small",src:c.ChevronRightLine})))))},t})(r.default.Component);t.UnconnectedFileActivitySection=p,t.ConnectedFileActivitySection=i.fileSidebarConnect((function(e){return{isFileActivityEnabled:o.isActivityEnabled(e),activities:o.getActivitiesMetadata(e)}}))(a.requireCssWithComponent(p,["/static/css/file_activity_stream-vflVllHcH.css"]))})),define("modules/clean/react/file_viewer_sidebar/panes/image_chooser_section",["require","exports","tslib","react","dropins_sdk_refactor/src/v2_entry","modules/clean/filepath/filepath","modules/clean/loggers/workflows_logger","spectrum/popover/index","modules/core/i18n","modules/clean/react/snackbar","modules/clean/react/components/css","classnames","spectrum/colorized_icon/index","spectrum/icon_action/index","spectrum/tooltip/index","modules/clean/react/watermarking/utils"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageChooserSection=t.ImageChooserSectionWithoutCSS=t.ImageSource=void 0,r=n.__importDefault(r),d=n.__importDefault(d);var _,h=["image/png","image/jpeg","image/jpg","image/gif","image/bmp"];(function(e){e.FROM_DROPBOX="dropbox",e.FROM_COMPUTER="computer",e.FROM_DRAGDROP="dragdrop"})(_=t.ImageSource||(t.ImageSource={}));var v=function(e){return r.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},r.default.createElement("path",{d:"M16.9849536,10.3304435 L21.935986,13.4846597 L16.9501078,16.6610755 L11.9679572,13.4870801 L6.98587822,16.6610755 L2,13.4846597 L6.950961,10.330489 L2,7.17634414 L6.9859499,4 L11.9679214,7.17394657 L16.9501795,4 L21.9359143,7.17634414 L16.9849536,10.3304435 Z M16.9151901,10.330489 L11.9679213,7.17874171 L7.020724,10.3304435 L11.9679572,13.4822392 L16.9151901,10.330489 Z M7.01792123,17.713692 L12.0037994,14.5376346 L16.9897493,17.713692 L12.0037994,20.8901078 L7.01792123,17.713692 Z",fill:e.fill?e.fill:"#ffffff"})))};v.displayName="DropboxIcon";var b=function(e){return r.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},r.default.createElement("path",{d:"M14,10 L24,10 L24,14 L14,14 L14,24 L10,24 L10,14 L0,14 L0,10 L10,10 L10,0 L14,0 L14,10 Z",fill:e.fill?e.fill:"#ffffff"})))};b.displayName="PlusIcon";var w=(function(e){function t(t){var s=e.call(this,t)||this;return s.handleDragOver=function(){s.setState({isDraggedOver:!0})},s.onChooseFromDropbox=function(e){return n.__awaiter(s,void 0,void 0,(function(){var t,r,i;return n.__generator(this,(function(n){switch(n.label){case 0:if(!(t=e.pop())||e.length)throw new Error("Dropbox chooser should only return one item");return r=t.link,[4,g.getImageFromURL(r)];case 1:return i=n.sent(),this.onImageSelected(i,r,t.name,_.FROM_DROPBOX),[2]}}))}))},s.onChooseFromComputer=function(e){return n.__awaiter(s,void 0,void 0,(function(){var t,r,i;return n.__generator(this,(function(n){switch(n.label){case 0:return e.currentTarget.files?(t=Array.from(e.currentTarget.files).pop())?(r=URL.createObjectURL(t),[4,g.getImageFromURL(r)]):[2]:[3,2];case 1:i=n.sent(),this.onImageSelected(i,r,t.name,_.FROM_COMPUTER),n.label=2;case 2:return[2]}}))}))},s.onDropFile=function(e){return n.__awaiter(s,void 0,void 0,(function(){var t,i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return e.preventDefault(),this.setState({isDraggedOver:!1}),(t=e.dataTransfer.files[0])?h.includes(t.type)?(i=URL.createObjectURL(t),[4,g.getImageFromURL(i)]):(c.Snackbar.show(r.default.createElement(c.ControlledSnackbarComponent,{id:"image-watermarking-drag-drop-error",title:l.intl.formatMessage({id:"tRlSi7",defaultMessage:"Can’t add. Choose an image file, like JPEG, GIF or PNG."}),variant:"fail",closeButtonText:l.intl.formatMessage({id:"2Cbv/y",defaultMessage:"Try again"})})),[2]):[2];case 1:return o=n.sent(),this.onImageSelected(o,i,t.name,_.FROM_DRAGDROP),[2]}}))}))},s.onDragOver=function(e){e.preventDefault(),s.setState({isDraggedOver:!0})},s.onDragLeave=function(e){e.preventDefault(),s.setState({isDraggedOver:!1})},s.onImageSelected=function(e,t,n,r){if(s.setState({imageURL:t},(function(){var e=t&&s.props.focusOnSelect?s.props.focusOnSelect:document.querySelector(".image-chooser__popover-trigger");e&&e.focus()})),e){var i=o.file_extension_for_logging(n||"");a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageUploaded,g.getWatermarkMilestone(s.props.user),{source:r,image_ext:i})}s.props.onImageSelected(e)},s.onDeleteButtonClicked=function(e){a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageDeleted,g.getWatermarkMilestone(s.props.user)),s.onImageSelected(void 0,void 0)},s.onSourceSelection=function(e){if(a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageUploadClicked,g.getWatermarkMilestone(s.props.user),{source:e}),e===_.FROM_DROPBOX)try{i.Dropbox.choose({multiselect:!1,success:s.onChooseFromDropbox,linkType:"direct",extensions:["images"]})}catch(e){c.Snackbar.fail(l.intl.formatMessage({id:"muNFvG",defaultMessage:"Couldn’t add image from Dropbox. Please reload the page and try again."}))}else s.imageUploadRef&&s.imageUploadRef.click()},s.state={isDraggedOver:!1,imageURL:t.defaultImageURL},i.Dropbox.init({appKey:"dropbox",productKey:"file_viewer_image_chooser"}),s}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.isImageWatermarkingMode&&window.addEventListener("dragover",this.handleDragOver)},t.prototype.componentDidUpdate=function(e){this.props.isImageWatermarkingMode!==e.isImageWatermarkingMode&&(this.props.isImageWatermarkingMode?window.addEventListener("dragover",this.handleDragOver):window.removeEventListener("dragover",this.handleDragOver))},t.prototype.componentWillUnmount=function(){this.props.isImageWatermarkingMode&&window.removeEventListener("dragover",this.handleDragOver)},t.prototype.render=function(){var e=this;return r.default.createElement(r.default.Fragment,null,this.props.isImageWatermarkingMode&&r.default.createElement("div",{className:d.default("watermarking-drop-zone",{"watermarking-drop-zone--dragged-over":this.state.isDraggedOver}),onDrop:this.onDropFile,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},this.state.isDraggedOver?r.default.createElement("p",{className:"watermarking-drop-zone__text"},l.intl.formatMessage({id:"+j0wlP",defaultMessage:"Drop image here"})):null),r.default.createElement("div",{className:"image-chooser-section"},this.state.imageURL?r.default.createElement(r.default.Fragment,null,r.default.createElement(f.Tooltip,{positioning:"left",positionOffset:8,tooltipContent:l.intl.formatMessage({id:"9v2+SN",defaultMessage:"Delete"})},r.default.createElement("button",{"aria-label":l.intl.formatMessage({id:"EpYmFq",defaultMessage:"Delete selected watermark image"}),className:"image-chooser-section__delete-button",onClick:this.onDeleteButtonClicked},r.default.createElement(p.ColorizedIcon,{color:"white"},r.default.createElement(m.IconAction,{name:"delete"})))),r.default.createElement("img",{className:"image-chooser-section__selected-image",src:this.state.imageURL,alt:l.intl.formatMessage({id:"ZeTVlG",defaultMessage:"Selected watermark image"})})):r.default.createElement(r.default.Fragment,null,r.default.createElement(s.Popover,{onSelection:this.onSourceSelection},r.default.createElement(s.PopoverTrigger,{"aria-label":l.intl.formatMessage({id:"Fb32+S",defaultMessage:"Open image source selection menu"}),className:"image-chooser__popover-trigger"},r.default.createElement("span",{className:"image-chooser-section__popover-button"},r.default.createElement(b,{className:"image-chooser-section__plus-svg"}))),r.default.createElement(s.PopoverContent,null,r.default.createElement(s.PopoverContentItem,{className:"image-chooser-section__add-from-dropbox",value:_.FROM_DROPBOX},r.default.createElement(v,{className:"image-chooser-section__logo-svg"}),l.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),r.default.createElement("span",{className:"ax-visually-hidden"}," "+l.intl.formatMessage({id:"dRhmBa",defaultMessage:"(opens a new window)"}))),r.default.createElement(s.PopoverContentItem,{className:"image-chooser-section__add-from-computer",value:_.FROM_COMPUTER},r.default.createElement(p.ColorizedIcon,{color:"white"},r.default.createElement(m.IconAction,{name:"upload"})),l.intl.formatMessage({id:"CVumiI",defaultMessage:"My computer"})))),r.default.createElement("p",{className:"image-chooser-section__drop-text","aria-hidden":"true"},l.intl.formatMessage({id:"+j0wlP",defaultMessage:"Drop image here"}))),r.default.createElement("input",{className:"image-chooser-section__image-upload",type:"file",accept:h.join(", "),onClick:function(e){return e.target.value=""},onChange:this.onChooseFromComputer,ref:function(t){return e.imageUploadRef=t}})))},t})(r.default.PureComponent);t.ImageChooserSectionWithoutCSS=w,t.ImageChooserSection=u.requireCssWithComponent(w,["/static/css/file_viewer_sidebar/image_chooser_section-vflr9AIyr.css"])}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableActivityPane=void 0,t.LoadableActivityPane=n.Loadable({loader:function(){return r.waitForTTI().then((function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/panes/activity_pane"],t,n)})).then(__importStar).then((function(e){return e.ActivityPane}))}))}})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_details_section",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableDetailsSection=void 0,t.LoadableDetailsSection=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/panes/details_section"],t,n)})).then(__importStar).then((function(e){return e.DetailsSection}))}})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_tasks_section",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableTasksSection=void 0,t.LoadableTasksSection=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/panes/tasks_section"],t,n)})).then(__importStar).then((function(e){return e.TasksSection}))}})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableFileActivityStreamSummary=void 0,t.LoadableFileActivityStreamSummary=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/panes/file_activity_stream_summary"],t,n)})).then(__importStar).then((function(e){return e.FileActivityStreamSummary}))}})})),define("modules/clean/react/file_viewer_sidebar/panes/markup_pane",["require","exports","tslib","react","classnames","lodash","react-redux","file-viewer/core/index","modules/core/browser","modules/core/i18n","ts-keycode-enum","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/components/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/previews/constants","modules/clean/react/snackbar","spectrum/button/index","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/utils","pro-ui/components/base/apply_button/index","modules/clean/react/workflows/markup_icons","spectrum/popover/index","spectrum/tooltip/index","spectrum/modal/index"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x){"use strict";var D,R;Object.defineProperty(t,"__esModule",{value:!0}),t.MarkupPane=t.ConnectedMarkupPaneComponent=t.MarkupPaneComponent=void 0,r=n.__importDefault(r),i=n.__importDefault(i),l=n.__importStar(l);var N=function(e,t){return void 0===t&&(t=!0),e===k.MarkupColor.TRANSPARENT?I.transparentFillIcon:I.circleIcon({stroke:e,fill:t?e:void 0})},L=[k.MarkupColor.TRANSPARENT,k.MarkupColor.RED_CHERRY,k.MarkupColor.ORANGE_TANGERINE,k.MarkupColor.GREEN,k.MarkupColor.DARK_BLUE,k.MarkupColor.ULTRAVIOLET,k.MarkupColor.WHITE,k.MarkupColor.BLACK].map((function(e){return{color:e,icon:N(e)}})),U=((D={})[k.MarkupColor.TRANSPARENT]=c.intl.formatMessage({id:"cnToDS",defaultMessage:"No fill color"}),D[k.MarkupColor.RED_CHERRY]=c.intl.formatMessage({id:"rZnlRM",defaultMessage:"Red"}),D[k.MarkupColor.ORANGE_TANGERINE]=c.intl.formatMessage({id:"6YT7wY",defaultMessage:"Orange"}),D[k.MarkupColor.GREEN]=c.intl.formatMessage({id:"TfeWUu",defaultMessage:"Green"}),D[k.MarkupColor.DARK_BLUE]=c.intl.formatMessage({id:"Opr8C4",defaultMessage:"Blue"}),D[k.MarkupColor.ULTRAVIOLET]=c.intl.formatMessage({id:"IZk7A9",defaultMessage:"Purple"}),D[k.MarkupColor.WHITE]=c.intl.formatMessage({id:"NupPFJ",defaultMessage:"White"}),D[k.MarkupColor.BLACK]=c.intl.formatMessage({id:"ukyV/6",defaultMessage:"Black"}),D),B=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isSubmenuOpen:!1},t.toggleSubMenu=function(e){var n=e.isOpen;t.setState({isSubmenuOpen:n})},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.icon,n=e.onChange,o=e.label,a=this.state.isSubmenuOpen;return r.default.createElement(F.Popover,{onSelection:n,onMenuToggle:this.toggleSubMenu,closeOnSelection:!1},r.default.createElement(F.PopoverTrigger,null,r.default.createElement("div",{className:"markup-pane__tool-buttons"},r.default.createElement(O.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:o},r.default.createElement(P.Button,{variant:"secondary",size:"large",className:i.default("markup-pane__tool-button",{"markup-pane__tool-button--selected":a}),tagName:"span"},t)))),r.default.createElement(F.PopoverContent,null,L.map((function(e){var t=e.icon,n=e.color;return r.default.createElement(O.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:U[n],key:U[n]},r.default.createElement(F.PopoverContentItem,{value:n},t))}))))},t})(r.default.Component),W=((R={})[k.MarkupType.TEXT]=m.WorkflowsEvent.MarkupTextboxClicked,R[k.MarkupType.FREEFORM]=m.WorkflowsEvent.MarkupDrawClicked,R[k.MarkupType.ARROW]=m.WorkflowsEvent.MarkupArrowClicked,R[k.MarkupType.RECT]=m.WorkflowsEvent.MarkupRectangleClicked,R[k.MarkupType.CIRCLE]=m.WorkflowsEvent.MarkupCircleClicked,R),V=(function(e){function t(t){var i=e.call(this,t)||this;return i.onStrokeChange=function(e){var t=i.props,n=t.markupState,r=t.currentPageIndex;(0,t.setMarkupStroke)(e);var o=n[r].fabric;C.setOptionsForActiveObjects(o,{stroke:e})},i.onFillChange=function(e){var t=i.props,n=t.markupState,r=t.currentPageIndex;(0,t.setMarkupFill)(e);var o=n[r].fabric;C.setOptionsForActiveObjects(o,{fill:e})},i.addMarkupObject=function(e){var t=i.props,n=t.currentPageIndex,r=t.markupState,o=t.markupState,a=o.strokeColor,s=o.fillColor,l=r[n].fabric;l&&(C.addMarkupObject(l,e,{stroke:a,fill:s,left:i.left,top:i.top}),i.props.setMarkupDrawingMode(!1),i.left+=T.OFFSET,i.top+=T.OFFSET,i.left>=l.getWidth()&&(i.left=T.DEFAULT_LEFT),i.top>=l.getHeight()&&(i.top=T.DEFAULT_TOP))},i.onClickDraw=function(){var e=i.props,t=e.markupState.isDrawingMode,n=e.setMarkupDrawingMode,r=e.setMarkupFormatSubmenu;t||r([k.FormatSubmenuEntry.STROKE]),n(!t),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupDrawClicked)},i.onClickTool=function(e,t){return function(){(0,i.props.setMarkupFormatSubmenu)(t),i.addMarkupObject(e),m.logWorkflowsEvent(W[e])}},i.exitWithConfirmation=function(){i.props.markupState[i.props.currentPageIndex].fabric.isEmpty()?i.props.changeMode(s.FileViewerMode.Documentation):i.setState({isConfirmationModalOpen:!0})},i.handleCancel=function(e){e.preventDefault(),i.exitWithConfirmation()},i.handleApply=function(e){return n.__awaiter(i,void 0,void 0,(function(){var t,i,o,a,s,u,f;return n.__generator(this,(function(n){switch(n.label){case 0:E.Snackbar.sync(c.intl.formatMessage({id:"Dn6iyj",defaultMessage:"Marking up file..."}),!1,"markup-notification"),m.logWorkflowsEvent(e?m.WorkflowsEvent.MarkupApplyOverwrite:m.WorkflowsEvent.MarkupApplySaveAsCopy),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,C.saveMarkup(this.props.user.id,this.props.file.file_id,e,this.props.markupState,this.props.previewType)];case 2:return t=n.sent(),[3,4];case 3:return i=n.sent(),o=T.getMarkupErrorMessage(i.error),a="over_quota_error"===i.error[".tag"],s=a?c.intl.formatMessage({id:"nvlC/2",defaultMessage:"Upgrade"}):c.intl.formatMessage({id:"o+sT31",defaultMessage:"Close"}),u=a?function(){return l.open_tab("/plans")}:function(){},[2,E.Snackbar.show(r.default.createElement(E.Snackbar,{id:"markup-notification",closeButtonText:s,timeoutDelayMs:5e3,title:o,variant:"fail",onCloseClick:u}))];case 4:return(f=t.fq_path||p.isBrowseFile(this.props.file)&&this.props.file.fq_path)?l.replace_location(d.preview_uri_for_fq_path(this.props.user,f,{context:S.PreviewSourceContext.Workflow})):l.reload(),[2]}}))}))},i.onDelete=function(e){e&&e instanceof KeyboardEvent&&e.preventDefault(),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupDelete);var t=i.props.markupState[i.props.currentPageIndex].fabric;t&&(t.remove.apply(t,t.getActiveObjects()),t.discardActiveObject().requestRenderAll())},i.onEscape=function(){var e=i.props.markupState[i.props.currentPageIndex].fabric;if(i.props.markupState.isDrawingMode){i.props.setMarkupDrawingMode(!1);var t=o.last(e.getObjects());t&&e.setActiveObject(t).requestRenderAll()}else e.getActiveObject()?e.discardActiveObject().requestRenderAll():i.exitWithConfirmation()},i.onCopy=function(){i.props.markupState[i.props.currentPageIndex].fabric.getActiveObject().clone((function(e){i.clipboard=e}))},i.onPaste=function(){if(i.clipboard){var e=i.props.markupState[i.props.currentPageIndex].fabric;i.clipboard.top=(i.clipboard.top||T.DEFAULT_TOP)+T.OFFSET,i.clipboard.left=(i.clipboard.left||T.DEFAULT_LEFT)+T.OFFSET,i.clipboard.left>=e.getWidth()&&(i.clipboard.left=T.DEFAULT_LEFT),i.clipboard.top>=e.getHeight()&&(i.clipboard.top=T.DEFAULT_TOP),i.clipboard.clone((function(t){if(e.discardActiveObject(),t.set({evented:!0,strokeUniform:!0}),"activeSelection"===t.type){var n=t;n.canvas=e,n.forEachObject((function(t){e.add(t)})),n.setCoords()}else e.add(t);e.setActiveObject(t).requestRenderAll()}))}},i.onLeftArrowPressed=function(){i.moveActiveObject(-T.MOVE_DISTANCE_X,0)},i.onRightArrowPressed=function(){i.moveActiveObject(T.MOVE_DISTANCE_X,0)},i.onUpArrowPressed=function(){i.moveActiveObject(0,-T.MOVE_DISTANCE_Y)},i.onDownArrowPressed=function(){i.moveActiveObject(0,T.MOVE_DISTANCE_Y)},i.moveActiveObject=function(e,t){var n=i.props.markupState[i.props.currentPageIndex].fabric,r=n.getActiveObject();r&&(r.left=r.left+e,r.top=r.top+t,n.trigger("object:moving",{target:r}),n.requestRenderAll())},i.renderConfirmationModal=function(){var e=c.intl.formatMessage({id:"c7pOMh",defaultMessage:"Exit without saving?"});return r.default.createElement(x.UtilityModal,{title:e,ariaLabel:e,open:i.state.isConfirmationModalOpen,primaryAction:c.intl.formatMessage({id:"U5fgWD",defaultMessage:"Yes"}),onPrimaryAction:function(){return i.props.changeMode(s.FileViewerMode.Documentation)},secondaryAction:c.intl.formatMessage({id:"gWxS/S",defaultMessage:"No"}),onSecondaryAction:function(){return i.setState({isConfirmationModalOpen:!1})},overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},c.intl.formatMessage({id:"rvkufC",defaultMessage:"Your markup will be lost if you exit before saving this file."}))},i.state={isConfirmationModalOpen:!1},i.left=T.DEFAULT_LEFT,i.top=T.DEFAULT_TOP,i}return n.__extends(t,e),t.prototype.componentDidMount=function(){m.logWorkflowsEvent(m.WorkflowsEvent.MarkupEnabled)},t.prototype.componentWillUnmount=function(){this.props.resetMarkupState(),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupCancel)},t.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,n=e.markupState,o=n.isDrawingMode,a=n.formatSubmenu,l=n.fillColor,d=n.strokeColor,p=[{icon:I.rectIcon,onClick:this.onClickTool(k.MarkupType.RECT,[k.FormatSubmenuEntry.FILL,k.FormatSubmenuEntry.STROKE]),label:c.intl.formatMessage({id:"JZlohh",defaultMessage:"Add square"})},{icon:I.circleIcon({stroke:"white",fill:"none"}),onClick:this.onClickTool(k.MarkupType.CIRCLE,[k.FormatSubmenuEntry.FILL,k.FormatSubmenuEntry.STROKE]),label:c.intl.formatMessage({id:"vOLK2M",defaultMessage:"Add circle"})},{icon:I.textIcon,onClick:this.onClickTool(k.MarkupType.TEXT,[k.FormatSubmenuEntry.STROKE]),label:c.intl.formatMessage({id:"3uYwiW",defaultMessage:"Add text"})},{icon:I.arrowIcon,onClick:this.onClickTool(k.MarkupType.ARROW,[k.FormatSubmenuEntry.STROKE]),label:c.intl.formatMessage({id:"pL0M9g",defaultMessage:"Add arrow"})},{icon:I.drawIcon,onClick:this.onClickDraw,label:c.intl.formatMessage({id:"WwXu7L",defaultMessage:"Draw"}),className:i.default({"markup-pane__tool-button--selected":o})}];return r.default.createElement(b.EditingPane,{paneId:s.SidebarPaneId.Markup,coreFVUiProps:t},r.default.createElement("div",{className:"markup-pane__actions"},r.default.createElement(A.ApplyButton,{onApply:this.handleApply,onClick:function(){},disabled:!1}),r.default.createElement(P.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},c.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))),r.default.createElement("div",{className:"markup-pane__control"},r.default.createElement("div",{className:i.default("markup-pane__main-tool-buttons",{"markup-pane__main-tool-buttons--submenu-open":a.length>0})},p.map((function(e,t){var n=e.icon,o=e.onClick,a=e.label,s=e.className;return r.default.createElement(O.Tooltip,{tooltipContent:a,className:"markup-pane__tooltip",positioning:"below",key:a},r.default.createElement(P.Button,{variant:"secondary",size:"large",onClick:o,className:i.default("markup-pane__tool-button",s)},n))})))),a.length>0&&r.default.createElement(K,{onFillChange:this.onFillChange,onStrokeChange:this.onStrokeChange,fillColor:l,strokeColor:d,menuEntries:a}),r.default.createElement(w.KeyboardBindingConnector,{keyboardBindings:[y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.Backspace},callback:this.onDelete}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.Delete},callback:this.onDelete}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.Escape},callback:this.onEscape}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.C,ctrlKey:!0},callback:this.onCopy}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.C,metaKey:!0},callback:this.onCopy}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.V,ctrlKey:!0},callback:this.onPaste}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.V,metaKey:!0},callback:this.onPaste}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.LeftArrow},callback:this.onLeftArrowPressed}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.UpArrow},callback:this.onUpArrowPressed}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.RightArrow},callback:this.onRightArrowPressed}),y.hydrateKeyboardBinding({keyboardEventCriteria:{which:u.Key.DownArrow},callback:this.onDownArrowPressed})]}),this.renderConfirmationModal())},t})(r.default.Component);t.MarkupPaneComponent=V;var K=function(e){var t=e.menuEntries,n=e.onFillChange,i=e.onStrokeChange,o=e.fillColor,a=e.strokeColor;return r.default.createElement("div",{className:"markup-pane__control markup-pane__control-colors"},t.map((function(e){switch(e){case k.FormatSubmenuEntry.FILL:return r.default.createElement(B,{icon:N(o),onChange:n,key:"fill-menu",label:c.intl.formatMessage({id:"H/EWDP",defaultMessage:"Change fill color"})});case k.FormatSubmenuEntry.STROKE:return r.default.createElement(B,{icon:N(a,!1),onChange:i,key:"stroke-menu",label:c.intl.formatMessage({id:"m+pG8Y",defaultMessage:"Change line color"})});default:return null}})))},j={changeMode:h.changeMode,setMarkupDrawingMode:h.setMarkupDrawingMode,resetMarkupState:h.resetMarkupState,setMarkupFill:h.setMarkupFill,setMarkupStroke:h.setMarkupStroke,setMarkupFormatSubmenu:h.setMarkupFormatSubmenu},q=a.connect((function(e,t){return{markupState:M.getMarkupState(e),currentPageIndex:v.getCurrentPageIndex(e)||0,previewType:g.getPreviewType(f.getApiDataForFile(e,t.file).data)}}),j);t.ConnectedMarkupPaneComponent=q(V),t.MarkupPane=_.requireCssWithComponent(t.ConnectedMarkupPaneComponent,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css","/static/css/file_viewer_sidebar/markup_pane-vfl6W9OHv.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/metadata_pane",["require","exports","tslib","react","file-viewer/modes/index","file-viewer/core/index","modules/clean/react/file_metadata/component/loadable_metadata_details","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer_sidebar/utils","react-redux","modules/clean/react/file_viewer/data/selectors","file-viewer/modes/sidebar/pane_title"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataPane=t.ConnectedMetadataPaneComponent=t.UnconnectedMetadataPaneComponent=void 0,r=n.__importDefault(r),t.UnconnectedMetadataPaneComponent=function(e){var t=u.isSidebarOpen(e.sidebar)&&u.isSidebarPaneIdAtTopOfStack(o.SidebarPaneId.Metadata,e.sidebar),s=u.getSecondFromTopSidebarPaneId(e.sidebar);return r.default.createElement(i.Pane,n.__assign({paneId:o.SidebarPaneId.Metadata},e.coreFVUiProps),r.default.createElement("div",{className:"metadata-pane"},r.default.createElement(m.PaneTitleComponent,{title:l.MetadataPaneStrings.details,backButton:s?{previousPaneId:s,onClick:e.popSidebarPane}:void 0,intl:e.coreFVUiProps.intl}),r.default.createElement(a.LoadableMetadataDetails,{file:e.file,user:e.user,sharedLinkInfo:e.sharedLinkInfo,isActiveTab:t,previewType:e.previewType})))};var f={popSidebarPane:c.popSidebarPane};t.ConnectedMetadataPaneComponent=d.connect((function(e){return{sidebar:p.getSidebar(e)}}),f)(t.UnconnectedMetadataPaneComponent),t.MetadataPane=s.requireCssWithComponent(t.ConnectedMetadataPaneComponent,["/static/css/file_viewer_sidebar/metadata_pane-vflJOp4bF.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/rotation_control",["require","exports","tslib","react","classnames","modules/core/i18n","spectrum/button/index","modules/clean/mouse_button_code","ts-keycode-enum"],(function(e,t,n,r,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RotationControl=void 0,r=n.__importDefault(r),i=n.__importDefault(i);var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rotateTimeoutId=null,t.state={isRotating:!1},t.startRotatingAC=function(e){e.button!==s.MouseButtonCode.LEFT&&e.keyCode!==l.Key.Enter||t.startRotating(1)},t.startRotatingCW=function(e){e.button!==s.MouseButtonCode.LEFT&&e.keyCode!==l.Key.Enter||t.startRotating(-1)},t.startRotating=function(e){t.setState({isRotating:!0},(function(){return t.rotate(e)}))},t.stopRotating=function(){t.setState({isRotating:!1})},t.rotate=function(e){var n=t.props,r=n.onChange,i=n.step,o=void 0===i?15:i,a=n.value,s=void 0===a?0:a;if(r&&t.state.isRotating){var l=s+e*o;l>359&&(l-=360),l<0&&(l+=360),r(l),t.rotateTimeoutId&&clearTimeout(t.rotateTimeoutId);var c=setTimeout((function(){t.rotateTimeoutId=null,t.rotate(e)}),200);t.rotateTimeoutId=c}},t}return n.__extends(t,e),t.prototype.componentWillUnmount=function(){this.rotateTimeoutId&&clearTimeout(this.rotateTimeoutId)},t.prototype.render=function(){var e=this.props,t=e.className,n=e.disabled,s=e.value;return r.default.createElement("div",{className:i.default("rotation-control",t)},r.default.createElement("div",{className:"rotation-control--current-value ax-visually-hidden","aria-live":"polite"},o.intl.formatMessage({id:"TSbTsY",defaultMessage:"{value} degrees"},{value:s})),r.default.createElement(a.Button,{disabled:n,onKeyDown:this.startRotatingAC,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingAC,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},r.default.createElement("span",{className:"ax-visually-hidden"},o.intl.formatMessage({id:"ZhlNXH",defaultMessage:"Rotate Anticlockwise"})),r.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.default.createElement("path",{d:"M9.87193 19.7329C10.5328 19.9073 11.227 20.0002 11.943 20.0002C16.3929 20.0002 20.0002 16.4106 20.0002 11.9825C20.0002 7.55449 16.3929 3.96484 11.943 3.96484C8.793 3.96484 6.06518 5.76364 4.74032 8.38529",stroke:"white",strokeWidth:"2"}),r.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.92141 7.72819L10.0233 7.21687L10.1704 8.66739L3.61077 9.3248L2.94905 2.79745L4.40675 2.65136L4.92141 7.72819Z",fill:"white"}))),r.default.createElement(a.Button,{disabled:n,onKeyDown:this.startRotatingCW,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingCW,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},r.default.createElement("span",{className:"ax-visually-hidden"},o.intl.formatMessage({id:"yDs6IE",defaultMessage:"Rotate Clockwise"})),r.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.default.createElement("path",{d:"M14.1283 19.7329C13.4674 19.9073 12.7732 20.0002 12.0572 20.0002C7.60734 20.0002 4 16.4106 4 11.9825C4 7.55449 7.60734 3.96484 12.0572 3.96484C15.2072 3.96484 17.9351 5.76364 19.2599 8.38529",stroke:"white",strokeWidth:"2"}),r.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.0788 7.72819L13.9769 7.21687L13.8299 8.66739L20.3895 9.3248L21.0512 2.79745L19.5935 2.65136L19.0788 7.72819Z",fill:"white"}))))},t})(r.default.Component);t.RotationControl=c})),define("modules/clean/react/file_viewer_sidebar/panes/strings",["require","exports","modules/core/i18n"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivitySectionStrings=t.DetailsSectionStrings=t.ActivityPaneStrings=t.MetadataPaneStrings=t.DocumentationPaneStrings=void 0,t.DocumentationPaneStrings={details:n.intl.formatMessage({id:"ghld2g",defaultMessage:"Details"}),activity:n.intl.formatMessage({id:"wVS5Gq",defaultMessage:"Activity"}),tasks:n.intl.formatMessage({id:"kA8gdS",defaultMessage:"Tasks"})},t.MetadataPaneStrings={details:n.intl.formatMessage({id:"mBshLe",defaultMessage:"Details"})},t.ActivityPaneStrings={details:n.intl.formatMessage({id:"Zduv89",defaultMessage:"Activity"})},t.DetailsSectionStrings={viewPreviousVersions:n.intl.formatMessage({id:"cGuWuL",defaultMessage:"View previous versions"}),viewAllDetails:n.intl.formatMessage({id:"cdTbAt",defaultMessage:"View all details"})},t.ActivitySectionStrings={viewAllActivities:n.intl.formatMessage({id:"dkJoht",defaultMessage:"View all activity"})}})),define("modules/clean/react/file_viewer_sidebar/panes/watermarking_pane",["require","exports","tslib","react","react-dom","classnames","lodash","react-aria-tabpanel","file-viewer/core/index","react-redux","file-viewer/core/index","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/react/components/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/snackbar","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/api","modules/core/i18n","spectrum/button/index","spectrum/dropdown_menu/index","spectrum/input/index","ts-keycode-enum","modules/clean/react/file_viewer_sidebar/panes/rotation_control","modules/clean/react/watermarking/utils","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/previews/constants","modules/clean/react/watermarking/types","modules/core/browser","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer_sidebar/panes/image_chooser_section","modules/clean/react/watermarking/apply_watermark_button","modules/clean/react/watermarking/utils","pro-ui/components/base/slider/index","spectrum/tabbed_header/index"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x,D,R,N,L,U){"use strict";var B;Object.defineProperty(t,"__esModule",{value:!0}),t.WatermarkingPane=t.ConnectedWatermarkingPaneComponent=t.WatermarkingPaneComponent=t.WATERMARKING_PANE_POSITION_BUTTON_CLASSNAME=void 0,r=n.__importDefault(r),i=n.__importStar(i),o=n.__importDefault(o),O=n.__importStar(O),t.WATERMARKING_PANE_POSITION_BUTTON_CLASSNAME="watermarking-pane__position-button",(function(e){e.TEXT="watermark_pane_text_tab",e.IMAGE="watermark_pane_image_tab"})(B||(B={}));var W=4*Math.pow(10,6),V=function(){return r.default.createElement("svg",{width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.default.createElement("circle",{className:"northwest",cx:"7",cy:"7",r:"2"}),r.default.createElement("circle",{className:"northeast",cx:"17",cy:"7",r:"2"}),r.default.createElement("circle",{className:"southeast",cx:"17",cy:"17",r:"2"}),r.default.createElement("circle",{className:"southwest",cx:"7",cy:"17",r:"2"}),r.default.createElement("circle",{className:"center",cx:"12",cy:"12",r:"2"}))},K=[{key:F.WatermarkPosition.CENTER,description:y.intl.formatMessage({id:"2FTkI8",defaultMessage:"Center"})},{key:F.WatermarkPosition.NORTHWEST,description:y.intl.formatMessage({id:"0A9340",defaultMessage:"Upper left"})},{key:F.WatermarkPosition.NORTHEAST,description:y.intl.formatMessage({id:"DeXDpY",defaultMessage:"Upper right"})},{key:F.WatermarkPosition.SOUTHWEST,description:y.intl.formatMessage({id:"ON2oaH",defaultMessage:"Lower left"})},{key:F.WatermarkPosition.SOUTHEAST,description:y.intl.formatMessage({id:"JHqw26",defaultMessage:"Lower right"})},{key:F.WatermarkPosition.REPEAT,description:y.intl.formatMessage({id:"v5qde2",defaultMessage:"Repeat"})}],j=[{key:"black",description:y.intl.formatMessage({id:"GDUcy7",defaultMessage:"Dark"})},{key:"white",description:y.intl.formatMessage({id:"9QTLF+",defaultMessage:"Light"})}],q=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultText="",t.getTiledImageWatermark=function(){var e=t.props,r=e.watermarkState,i=(0,e.tilingRenderer)(F.getWatermarkingOptions(r).scale),o=i.canvas.toDataURL().split(",",2).pop();if(o)return n.__assign(n.__assign({},i),{image:o})},t.getImageWatermark=function(){var e,n,r=t.props.watermarkState;if(r.mode===F.WatermarkingMode.TEXT){if(!(n=r.textWatermarkingOptions).text)return;e=b.drawTextTile(n.text,n.size*n.scale,n.fontFamily,n.color,n.opacity/100,n.angle/180*Math.PI).canvas}else{if(!(n=r.imageWatermarkingOptions).image)return;e=b.drawImageTile(n.image,n.size*n.scale,n.opacity/100,n.angle/180*Math.PI).canvas}if(e)return{image:e.toDataURL().split(",",2).pop(),position:n.position,marginX:n.position===F.WatermarkPosition.CENTER?0:n.marginX,marginY:n.position===F.WatermarkPosition.CENTER?0:n.marginY}},t.commitAndRedirect=function(e){return n.__awaiter(t,void 0,void 0,(function(){var t,r,i,o,a,s,l;return n.__generator(this,(function(n){switch(n.label){case 0:if(t=this.props.watermarkState,r=F.getWatermarkingOptions(t),!(i=r.position===F.WatermarkPosition.REPEAT?this.getTiledImageWatermark():this.getImageWatermark()))return[2];if(i.image.length>W)return[2,v.Snackbar.fail(y.intl.formatMessage({id:"g1Qc/Z",defaultMessage:"That’s too big to save. Try making your watermark smaller."}),"watermarking-notification")];v.Snackbar.sync(y.intl.formatMessage({id:"sN5g4y",defaultMessage:"Watermarking file..."}),!1,"watermarking-notification"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,w.sendWatermarkRequest(this.props.user.id,this.props.file.file_id,e,i)];case 2:return o=n.sent(),[3,4];case 3:return a=n.sent(),s=void 0,s=k.isOverQuotaError(a.error)?y.intl.formatMessage({id:"ztdrtc",defaultMessage:"The watermark could not be saved because your account is over quota."}):k.isFilesystemError(a.error)?y.intl.formatMessage({id:"pHFNKD",defaultMessage:"The watermark could not be saved because the file was moved or deleted."}):k.isUnsupportedFileError(a.error)?y.intl.formatMessage({id:"1GlT+b",defaultMessage:"Watermarking is not available for this file type."}):k.isUnauthorizedAccessError(a.error)?y.intl.formatMessage({id:"sCMFzX",defaultMessage:"The watermark could not be saved because you do not have permission to save to this folder."}):y.intl.formatMessage({id:"PUQ8kA",defaultMessage:"Couldn’t save watermark. Refresh the page to try again."}),[2,v.Snackbar.fail(s,"watermarking-notification")];case 4:return(l=o.fq_path||p.isBrowseFile(this.props.file)&&this.props.file.fq_path)?O.replace_location(d.preview_uri_for_fq_path(this.props.user,l,{context:I.PreviewSourceContext.Workflow})):O.reload(),[2]}}))}))},t.updateCommonWatermarkingOptions=function(e){t.props.watermarkState.mode===F.WatermarkingMode.TEXT?t.updateTextWatermarkingOptions(e):t.updateImageWatermarkingOptions(e)},t.updateTextWatermarkingOptions=function(e){t.props.updateWatermarkOptions({textWatermarkingOptions:e})},t.updateImageWatermarkingOptions=function(e){t.props.updateWatermarkOptions({imageWatermarkingOptions:e})},t.debouncedLogOpacityChange=a.debounce((function(e){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTransparencyChanged,N.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode,start_transparency:String(t.startingOpacity),end_transparency:String(e)}),t.startingOpacity=void 0}),200),t.handleOpacityChange=function(e){var n=t.props.watermarkState,r=F.getWatermarkingOptions(n).opacity;e!==r&&(t.startingOpacity=t.startingOpacity||r,t.debouncedLogOpacityChange(e),t.updateCommonWatermarkingOptions({opacity:e}))},t.debouncedLogSizeChange=a.debounce((function(e){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkSizeChanged,N.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode,start_size:String(t.startingSize),end_size:String(e)}),t.startingSize=void 0}),200),t.handleSizeChange=function(e){var n=t.props.watermarkState,r=F.getWatermarkingOptions(n).size;e!==r&&(t.startingSize=t.startingSize||r,t.debouncedLogSizeChange(e),t.updateCommonWatermarkingOptions({size:e}))},t.handleTextChange=function(e){t.textInput&&t.updateTextWatermarkingOptions({text:t.textInput.value})},t.logTextInputFocus=function(){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextInputEnterFocus,N.getWatermarkMilestone(t.props.user),{num_characters:t.textInput&&String(t.textInput.value.length)})},t.logTextInputBlur=function(){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextInputExitFocus,N.getWatermarkMilestone(t.props.user),{num_characters:t.textInput&&String(t.textInput.value.length)})},t.handleImageChange=function(e){t.updateImageWatermarkingOptions(n.__assign({image:e,imageAsDataURL:void 0},N.getImageDefaultSizes(e,t.props.pageDimensions)))},t.handlePositionChange=function(e){var n=t.props.watermarkState,r=F.getWatermarkingOptions(n).position,i={position:e};if(r===F.WatermarkPosition.REPEAT&&i.position!==F.WatermarkPosition.REPEAT&&(i.angle=0),r!==F.WatermarkPosition.REPEAT&&i.position===F.WatermarkPosition.REPEAT){var o=F.getWatermarkingOptions(k.DEFAULT_WATERMARKING_STATE);i.angle=o.angle}m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkPositionMenuSelectionMade,N.getWatermarkMilestone(t.props.user),{watermark_type:n.mode,start_position:r,end_position:e}),t.updateCommonWatermarkingOptions(i)},t.handleColorChange=function(e){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkColorClicked,N.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode,color:e}),t.updateTextWatermarkingOptions({color:e})},t.handleRotationChange=function(e){var n=t.props.watermarkState,r=F.getWatermarkingOptions(n).angle;m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkRotationClicked,N.getWatermarkMilestone(t.props.user),{watermark_type:n.mode,start_rotation:String(r),end_rotation:String(e)}),t.updateCommonWatermarkingOptions({angle:e})},t.handleCancel=function(e){e.preventDefault(),t.props.changeMode(u.FileViewerMode.Documentation)},t.onTabClicked=function(e){e.currentTarget.id===B.TEXT?(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextTabClicked,N.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(F.WatermarkingMode.TEXT)):(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkImageTabClicked,N.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(F.WatermarkingMode.IMAGE))},t.onTabKeyUp=function(e){[C.Key.Enter,C.Key.Space].includes(e.keyCode)&&(e.currentTarget.id===B.TEXT?(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkTextTabClicked,N.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(F.WatermarkingMode.TEXT)):(m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkImageTabClicked,N.getWatermarkMilestone(t.props.user)),t.props.switchWatermarkingMode(F.WatermarkingMode.IMAGE)))},t.onInputRef=function(e){t.textInput=e},t.onTabWrapperRef=function(e){t.tabWrapperRef=e?i.findDOMNode(e):null;var n=t.tabWrapperRef&&t.tabWrapperRef.querySelector('[role="tab"][aria-selected="true"]');n&&n.focus()},t.onPositionRef=function(e){t.positionRef=e},t.handleApply=function(e){return n.__awaiter(t,void 0,void 0,(function(){var t,r,i,o;return n.__generator(this,(function(n){return t=this.props,r=t.isTrialMode,i=t.user,o=t.watermarkState,r?[2]:(m.logWorkflowsEvent(e?m.WorkflowsEvent.WatermarkApplyOverwrite:m.WorkflowsEvent.WatermarkApplySaveAsCopy,N.getWatermarkMilestone(i),{watermark_type:o.mode,num_characters:this.textInput&&String(this.textInput.value.length),end_position:String(F.getWatermarkingOptions(o).position),end_rotation:String(F.getWatermarkingOptions(o).angle),end_size:String(F.getWatermarkingOptions(o).size),end_transparency:String(F.getWatermarkingOptions(o).opacity)}),k.setUserMetadataTextWatermarkingState(i,o),this.commitAndRedirect(e),[2])}))}))},t.logApplyButtonClick=function(){m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkOpenApplyMenu,N.getWatermarkMilestone(t.props.user),{watermark_type:t.props.watermarkState.mode})},t.getDropdownDescription=function(e,t){var n=t.find((function(t){return t.key===e}));return n?n.description:void 0},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props.watermarkState;this.updateScale(),m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkEnable,N.getWatermarkMilestone(this.props.user),{num_characters:this.textInput&&String(this.textInput.value.length),start_position:String(F.getWatermarkingOptions(e).position),start_rotation:String(F.getWatermarkingOptions(e).angle),start_size:String(F.getWatermarkingOptions(e).size),start_transparency:String(F.getWatermarkingOptions(e).opacity)})},t.prototype.componentWillUnmount=function(){k.setUserMetadataTextWatermarkingState(this.props.user,this.props.watermarkState),m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkCancel,N.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode})},t.prototype.updateScale=function(){var e=this.props,t=e.updateWatermarkOptions,n=e.previewType,r=k.getWatermarkScale(n);t({imageWatermarkingOptions:{scale:r},textWatermarkingOptions:{scale:r}})},t.prototype.render=function(){var e=this.props,t=e.coreFVUiProps,n=e.file,i=e.watermarkState,a=e.user,c=F.getWatermarkingOptions(i),u=i.textWatermarkingOptions,d=i.imageWatermarkingOptions,p=c.position||F.WatermarkPosition.REPEAT,m=u.color,f=i.mode===F.WatermarkingMode.TEXT&&!!u.text||i.mode===F.WatermarkingMode.IMAGE&&!!d.image;return r.default.createElement(h.EditingPane,{paneId:l.SidebarPaneId.Watermarking,coreFVUiProps:t,classname:"watermarking-pane"},r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__actions"},r.default.createElement(R.ApplyWatermarkButton,{onApply:this.handleApply,onClick:this.logApplyButtonClick,allowWatermark:N.allowWatermark(n,a),hasInput:i.mode===F.WatermarkingMode.TEXT?!!u.text:!!d.image,trialVariant:N.getWatermarkTrialVariant(a),milestone:N.getWatermarkMilestone(a),isPlusUser:a.paid}),r.default.createElement(S.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},N.allowWatermarkTrial(a)?y.intl.formatMessage({id:"+Dtv46",defaultMessage:"Exit"}):y.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))),r.default.createElement(s.Wrapper,{ref:this.onTabWrapperRef},r.default.createElement(U.TabbedHeader,null,r.default.createElement(U.Tab,{id:B.TEXT,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===F.WatermarkingMode.TEXT},y.intl.formatMessage({id:"wzKMOb",defaultMessage:"Text"})),r.default.createElement(U.Tab,{id:B.IMAGE,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===F.WatermarkingMode.IMAGE},y.intl.formatMessage({id:"UOGf2g",defaultMessage:"Image"}))),r.default.createElement("div",{className:"watermarking-pane__tab-panels"},r.default.createElement(s.TabPanel,{active:i.mode===F.WatermarkingMode.TEXT,tabId:B.TEXT},r.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__text"},r.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"1n+LVR",defaultMessage:"Watermark"})),r.default.createElement(P.Input,{"aria-label":y.intl.formatMessage({id:"W853K9",defaultMessage:"Text of Watermark"}),autoComplete:"off",placeholder:y.intl.formatMessage({id:"YZ+Jsk",defaultMessage:"Add watermark text"}),forwardedRef:this.onInputRef,fullWidth:!0,name:"text",value:u.text,onChange:this.handleTextChange,onFocus:this.logTextInputFocus,onBlur:this.logTextInputBlur,maxLength:100}))),r.default.createElement(s.TabPanel,{active:i.mode===F.WatermarkingMode.IMAGE,tabId:B.IMAGE},r.default.createElement("p",{className:"watermarking-pane__label","aria-hidden":!0},y.intl.formatMessage({id:"1n+LVR",defaultMessage:"Watermark"})),r.default.createElement(D.ImageChooserSection,{coreFVUiProps:t,file:n,user:this.props.user,defaultImageURL:d.image?d.image.src:void 0,onImageSelected:this.handleImageChange,focusOnSelect:this.positionRef&&this.positionRef.querySelector("button"),isImageWatermarkingMode:i.mode===F.WatermarkingMode.IMAGE})))),r.default.createElement("div",{className:o.default({"watermarking-pane__controls--disabled":!f})},r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__position watermarking-pane__dropdown",ref:this.onPositionRef},r.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"zxyFrb",defaultMessage:"Position"})),r.default.createElement(E.DropdownMenu,{disabled:!f,onSelection:this.handlePositionChange},r.default.createElement(E.DropdownMenuButton,null,r.default.createElement("span",{"aria-label":y.intl.formatMessage({id:"zxyFrb",defaultMessage:"Position"}),className:"icon icon-"+p.toLowerCase()},r.default.createElement(V,null)),this.getDropdownDescription(p,K)),r.default.createElement(E.Menu,null,K.map((function(e){return r.default.createElement(E.MenuItem,{key:e.key,value:e.key,selected:e.key===p},r.default.createElement("span",{className:"icon icon-"+e.key.toLowerCase()},r.default.createElement(V,null)),e.description)}))))),i.mode===F.WatermarkingMode.TEXT?r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__dropdown watermarking-pane__color"},r.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"HQyDBL",defaultMessage:"Color"})),r.default.createElement(E.DropdownMenu,{disabled:!f,onSelection:this.handleColorChange},r.default.createElement(E.DropdownMenuButton,null,r.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:m}}),this.getDropdownDescription(m,j)),r.default.createElement(E.Menu,null,j.map((function(e){return r.default.createElement(E.MenuItem,{key:e.key,value:e.key,selected:e.key===m},r.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:e.key}}),e.description)}))))):null,r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__rotation"},r.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"kG/lBo",defaultMessage:"Rotation"})),r.default.createElement(M.RotationControl,{disabled:!f,value:c.angle,onChange:this.handleRotationChange})),r.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__opacity"},r.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"8Ppp84",defaultMessage:"Opacity"})),r.default.createElement(L.Slider,{className:"watermarking-pane__opacity-slider",disabled:!f,min:0,max:100,darkMode:!0,fullWidth:!0,value:c.opacity,name:"opacity",onChange:this.handleOpacityChange})),r.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__font_size"},r.default.createElement("p",{className:"watermarking-pane__label"},y.intl.formatMessage({id:"txUjQq",defaultMessage:"Size"})),r.default.createElement(L.Slider,{className:"watermarking-pane__fontsize-slider",disabled:!f,min:c.minSize,max:c.maxSize,darkMode:!0,fullWidth:!0,value:c.size,name:"fontsize",onChange:this.handleSizeChange,step:"any"}))))},t})(r.default.Component);t.WatermarkingPaneComponent=q;var H=c.connect((function(e,t){return{mode:_.getMode(e),isTrialMode:_.getIsTrialMode(e),watermarkState:x.getWatermarkState(e),tilingRenderer:x.getWatermarkTilingFunc(e),previewType:A.getPreviewType(T.getApiDataForFile(e,t.file).data),pageDimensions:_.getPageDimensions(e)}}),{changeMode:g.changeMode,updateWatermarkOptions:g.updateWatermarkOptions,switchWatermarkingMode:g.switchWatermarkingMode});t.ConnectedWatermarkingPaneComponent=H(q),t.WatermarkingPane=f.requireCssWithComponent(t.ConnectedWatermarkingPaneComponent,["/static/css/file_viewer_sidebar/watermarking_pane-vflgy-27E.css"])})),define("modules/clean/react/file_viewer_sidebar/render_utils/call_to_action",["require","exports","tslib","react","modules/clean/auth/login_or_register/types","modules/clean/react/components/modal","modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/constants","modules/clean/react/extensions/data/types","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions","modules/clean/previews/util","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions","modules/clean/react/file_viewer/conversions/conversion_utils","modules/core/browser","modules/core/i18n","dig-components/buttons"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderVersionHistoryActions=t.renderSharedFileActions=t.renderMountedFileActions=void 0,r=n.__importDefault(r),h=n.__importStar(h),t.renderMountedFileActions=function(e,t,n,i,o,s,u){if(void 0===s&&(s=!1),void 0===u&&(u=!1),!i)return[];var d=[r.default.createElement(a.AsyncShareButton,{key:"share",file:e,user:t,isCollapsed:s&&u}),r.default.createElement(a.AsyncSpacesDropdown,{key:"spaces",file:e,user:t,isCollapsed:s&&u})];return o?d.push(r.default.createElement(a.AsyncExtensionsButton,{key:"extension",user:t,file:e,showAsButtonIfDownloadOnly:!0,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:function(){},triggerType:u&&s?c.TriggerType.CollapsedButton:void 0,isInFVSidebar:s})):d.push(r.default.createElement(a.AsyncOpenButton,{file:e,location:s?l.FileViewerPane.Sidebar:l.FileViewerPane.TitleBar,user:t,key:"open",sizeClass:n,isCollapsed:s})),d},t.renderSharedFileActions=function(t,a,g,w,y,S,E,P,C,M,k){void 0===P&&(P=!1),void 0===C&&(C=!1),void 0===k&&(k=!1);var T=!(!t.open_in_app_data||!t.preview_type),A=[];k&&!C&&A.push(r.default.createElement(b.Button,{variant:"primary",size:"standard",href:"https://dropbox.com/capture"},v.intl.formatMessage({id:"Z1jqLM",defaultMessage:"Try Capture for Free"})));var I=P?s.UserActionContext.Sidebar:s.UserActionContext.TitleBarMain;if(T&&E&&A.push(r.default.createElement(d.AsyncOpenInAppButton,{urls:t.open_in_app_data,userActionContext:I})),!a)if(p.isCloudDocPreview(t))A.push(r.default.createElement(d.AsyncEditNowButton,{isPrimaryButton:!T,onClick:function(){return m.logUserAction(s.UserAction.SignIn,I)},hideCallOut:!1,isCollapsed:P&&C}));else{var F=!T,O=C||P&&!F,x=_.shouldOpenModalFromSidebar()?{href:void 0,onClick:function(){m.logUserAction(s.UserAction.SignIn,I),new Promise((function(t,n){e(["modules/clean/auth/login_or_register/modal"],t,n)})).then(n.__importStar).then((function(e){var t=e.LoginOrRegisterModal;o.Modal.showInstance(r.default.createElement(t,{downloadAction:null,onCancel:function(){},id:"file-viewer-sidebar-modal",initialMode:i.Mode.LOGIN,kind:i.LoginOrRegisterKind.SIDEBAR,signup_tag:"file-viewer-sidebar-modal",onAuthenticateSuccess:function(){return h.reload()},encryptionOptions:M}))}))}}:{onClick:function(){return m.logUserAction(s.UserAction.SignIn,I)}};A.push(r.default.createElement(d.AsyncSignInButton,n.__assign({isPrimaryButton:F},x,{icon:O?r.default.createElement(f.ButtonIcon,{name:"sign-in",isPrimary:!T}):void 0}))),C||!_.shouldShowSignupButton()||k||A.push(r.default.createElement(d.AsyncSignInButton,{isPrimaryButton:!1,title:v.intl.formatMessage({id:"C4FJfI",defaultMessage:"Sign up"}),href:void 0,onClick:function(){m.logUserAction(s.UserAction.SignUp,I),new Promise((function(t,n){e(["modules/clean/auth/login_or_register/modal"],t,n)})).then(n.__importStar).then((function(e){var t=e.LoginOrRegisterModal;o.Modal.showInstance(r.default.createElement(t,{downloadAction:null,onCancel:function(){},id:"file-viewer-sidebar-modal",initialMode:i.Mode.REGISTER,kind:i.LoginOrRegisterKind.SIDEBAR,signup_tag:"file-viewer-sidebar-modal",encryptionOptions:M}))}))}}))}return a&&E&&(function(e){return e.linkType===u.SharedLinkType.Content})(y)&&A.push(r.default.createElement("div",{className:"control__button"},r.default.createElement(d.AsyncExtensionsMenuNoUnity,{file:t,user:a,triggerType:P&&(C||0!==A.length)?c.TriggerType.CollapsedButton:void 0,isInFVSidebar:P}))),y&&S&&E&&!p.isCloudDocPreview(t)&&A.push(r.default.createElement(d.AsyncShareDownloadButton,{copyable:t,location:P?l.FileViewerPane.Sidebar:l.FileViewerPane.TitleBar,sharedLinkInfo:w,sharePermission:S,shareToken:y,user:a,isCollapsed:P&&(C||0!==A.length),encryptionOptions:M})),A},t.renderVersionHistoryActions=function(e,t,n,i,o,s,c){if(void 0===s&&(s=!1),void 0===c&&(c=!1),!n)return[];var u=[];return i&&u.push(r.default.createElement(g.RestoreButton,{key:"restore",onClick:o,isCollapsed:c})),u.push(r.default.createElement(a.AsyncOpenButton,{key:"open",file:e,user:t,isUnityDisabled:!0,isOpenWithDisabled:!0,isCloudEditorDisabled:!0,location:s?l.FileViewerPane.Sidebar:l.FileViewerPane.TitleBar,isCollapsed:s})),u}}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/replay_prompt/async_replay_prompt",["require","exports","modules/clean/react/async/loadable"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncReplayPrompt=void 0,t.AsyncReplayPrompt=n.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer_sidebar/replay_prompt/replay_prompt"],t,n)})).then(__importStar).then((function(e){return e.ReplayPrompt}))}})})),define("modules/clean/react/file_viewer_sidebar/sidebar",["require","exports","tslib","react","react-redux","file-viewer/modes/index","file-viewer/core/index","modules/clean/integrations/data/selectors","modules/clean/pro_analytics/data/util","modules/clean/react/file_viewer_sidebar/utils","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","lodash","modules/clean/react/workflows/markup/utils","modules/clean/react/watermarking/utils","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer_sidebar/panes/documentation_pane","modules/clean/react/file_viewer_sidebar/panes/metadata_pane","modules/clean/react/file_viewer_sidebar/panes/commenting_pane","modules/clean/react/file_viewer_sidebar/panes/pro_analytics_pane","modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane","modules/clean/react/file_viewer_sidebar/panes/markup_pane","modules/clean/react/file_viewer_sidebar/panes/watermarking_pane","modules/clean/react/user_notifications/dropdown","modules/clean/react/extensions/file","file-viewer/modes/index","modules/clean/cloud_docs/constants","file-viewer/core/index","modules/clean/react/file_viewer/constants","modules/clean/viewer","modules/clean/react/file_viewer/logging","modules/clean/integrations/data/selectors","modules/clean/react/size_class/size_class","modules/clean/previews/constants","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/render_utils/call_to_action","modules/clean/react/file_viewer_sidebar/widgets/seen_states","classnames","modules/clean/react/file_viewer/ml_experiment","modules/clean/file_store/utils","modules/core/i18n","modules/clean/react/file_viewer_sidebar/esign_upsell/async_esign_upsell","modules/clean/react/file_viewer_sidebar/replay_prompt/async_replay_prompt","modules/clean/reel/lib/utils"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_,h,v,b,w,y,S,E,P,C,M,k,T,A,I,F,O,x,D,R,N,L,U,B,W,V,K,j){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sidebar=t.UnconnectedSidebar=void 0,r=n.__importDefault(r),l=n.__importStar(l),p=n.__importStar(p),L=n.__importDefault(L);var q;(function(e){e[e.MOUNTED_FILE=0]="MOUNTED_FILE",e[e.SHARED_FILE=1]="SHARED_FILE",e[e.VERSION_HISTORY=2]="VERSION_HISTORY"})(q||(q={}));var H=(function(e){function t(t){var i=e.call(this,t)||this;return i.callToActionType=function(e){return e.sharedLinkInfo?q.SHARED_FILE:e.isVersionHistoryMode?q.VERSION_HISTORY:q.MOUNTED_FILE},i.renderSidebarNotificationsFn=function(){var e=i.props,t=e.sharedLinkInfo,n=e.user;return t||!n||n.is_guest_admin?null:r.default.createElement(E.UserNotificationsDropdown,{onClick:function(){return I.logUserAction(T.UserAction.ClickNotifications,T.UserActionContext.Sidebar)}})},i.registerSidebarPanesFn=function(e){var t,n=i.props,o=n.brandingInfo,a=n.encryptionOptions,s=n.file,l=n.isViewingFileSubpath,c=n.isVersionHistoryMode,u=void 0!==c&&c,d=n.previewType,p=n.sharedLinkInfo,E=n.sizeClass,P=n.user,C=n.expGrowthActSmbWorkflowsBaton,M=s,I=((t={})[k.SidebarPaneId.Documentation]=r.default.createElement(_.DocumentationPane,{key:"documentation-pane",coreFVUiProps:e,file:M,user:P,brandingInfo:o,sharedLinkInfo:p,maxFilenameEmLength:T.SizeClassFilenameLengthMap[E],isVersionHistoryMode:u,encryptionOptions:a,expGrowthActSmbWorkflowsBaton:C}),t[k.SidebarPaneId.Metadata]=r.default.createElement(h.MetadataPane,{key:"metadata-pane",coreFVUiProps:e,file:M,user:P,sharedLinkInfo:p,previewType:d}),t[k.SidebarPaneId.Activity]=r.default.createElement(w.LoadableActivityPane,{key:"activity-pane",coreFVUiProps:e,file:M,user:P,isVersionHistoryMode:u}),t);if(l||(I[k.SidebarPaneId.Comments]=r.default.createElement(v.CommentingPane,{coreFVUiProps:e,encryptionOptions:a,user:P,key:"commenting-pane"})),P&&s){if(i.isProAnalyticsPaneEnabled){var F=P.is_team?A.Viewer.get_viewer().team_name:void 0;I[k.SidebarPaneId.ProAnalytics]=r.default.createElement(b.ProAnalyticsPane,{coreFVUiProps:e,user:P,fileId:s.file_id,isCollapsed:E===O.SizeClass.Medium,teamName:F})}f.allowWatermarkOrTrial(s,P)&&g.isFileEditable(s)&&(I[k.SidebarPaneId.Watermarking]=r.default.createElement(S.WatermarkingPane,{key:"watermarking-pane",coreFVUiProps:e,file:s,user:P})),m.allowMarkup(s)&&(I[k.SidebarPaneId.Markup]=r.default.createElement(y.MarkupPane,{key:"markup-pane",coreFVUiProps:e,file:s,user:P}))}return I},i.handleWatermarkControlClick=function(){i.setState({watermarkControlHasBeenClicked:!0})},i.createRenderSidebarControlsFn=p.memoize((function(e){return function(t){var o=[r.default.createElement(C.DocumentationControl,n.__assign({key:"documentation-control"},t))],a=i.props,s=a.docClassification,l=a.docClassificationVariant,c=a.file,u=a.hellosignAppAction,d=a.isHelloSignAppActionInSidebarEnabled,p=a.isHelloSignDeepIntegrationInSidebarEnabled,_=a.isSendForSignatureEnabled,h=a.isVersionHistoryMode,v=a.isViewingFileSubpath,b=a.onHelloSignAppActionLaunch,w=a.onHelloSignDeepIntegrationLaunch,y=a.previewType,S=a.user;if(v||o.push(r.default.createElement(C.CommentControl,n.__assign({disabled:e[k.FileViewerMode.Commenting],key:"comment-control"},t))),i.isProAnalyticsPaneEnabled){var E=(null==S?void 0:S.is_team)?C.ProAnalyticsTeamUserControl:C.ProAnalyticsIndividualUserControl;o.push(r.default.createElement(E,n.__assign({disabled:e[k.FileViewerMode.ProAnalytics],key:"pro-analytics-control"},t)))}if(g.isFileEditable(c)&&(f.isWatermarkingEnabled(S)||f.allowWatermarkTrial(S))&&!h){var T=!f.fileIsWatermarkable(c);o.push(r.default.createElement(C.WatermarkControl,n.__assign({key:"watermarking-control",disabled:T,labelText:f.getWatermarkingLabelText(T,y),onClick:i.handleWatermarkControlClick},t)))}if(m.userCanMarkup()&&g.isFileEditable(c)&&!h){T=!m.fileIsMarkupable(c);o.push(r.default.createElement(C.MarkupControl,n.__assign({key:"markup-control",disabled:T,labelText:m.getMarkupLabelText(T,y)},t)))}var A,I=void 0!==c&&U.ML_EXPERIMENT_EXTENSIONS.includes(B.getExtension(c));if(l&&U.ML_ENDPOINT_FETCH_TYPES.includes(l)&&s&&s.predicted_types&&s.predicted_types.length>0)A=L.default({"hs-classification-esign":s.predicted_types.includes(U.ML_EXPERIMENT_TYPES.esign)&&l===U.ML_EXPERIMENT_TYPES.esign,"hs-classification-contract":s.predicted_types.includes(U.ML_EXPERIMENT_TYPES.contract)&&l===U.ML_EXPERIMENT_TYPES.contract});else if(l===U.ML_EXPERIMENT_TYPES.file&&c&&I){["contract","agreement","nda","proposal","offer","form","application","terms"].forEach((function(e){-1!==B.getFilename(c).toLowerCase().indexOf(e)&&(A=L.default({"hs-classification-file":!0}))}))}else l===U.ML_EXPERIMENT_TYPES.control&&I&&(A=L.default({"hs-classification-control":!0}));return p&&_&&c&&M.isHellosignFileByExtension(P.getFileExt(n.__assign(n.__assign({},c),{bytes:0})))?o.push(r.default.createElement(C.HelloSignControl,n.__assign({key:"hellosign-control",onClick:w,className:A},t))):S&&u&&d&&b&&o.push(r.default.createElement(C.HelloSignControl,n.__assign({key:"hellosign-control",className:A,onClick:b},t))),o}})),i.renderSidebarCallToActionsFn=function(e){var t=e.fileViewerUiData.sidebar.visibility,n=i.callToActionType(i.props),r=t===a.SidebarVisibility.Closed||i.props.sizeClass===O.SizeClass.Medium;switch(n){case q.SHARED_FILE:var o=i.props,s=o.sharedLinkInfo,l=o.shareToken,c=o.sharePermission;return R.renderSharedFileActions(i.props.file,i.props.user,i.props.sizeClass,s,l,c,!0,!0,r,i.props.encryptionOptions,i.props.isCapture);case q.MOUNTED_FILE:return R.renderMountedFileActions(i.props.file,i.props.user,i.props.sizeClass,!0,i.props.extensionsEnabled,!0,r);case q.VERSION_HISTORY:return R.renderVersionHistoryActions(i.props.file,i.props.user,!0,!!i.props.canRestoreRevision,i.props.onRestoreRevision||function(){},!0,r)}return[]},i.renderSidebarPASSFn=function(e){var t=e.fileViewerUiData.sidebar.visibility;return r.default.createElement(N.AsyncSeenStateFacepileConsumer,{isCollapsed:t===a.SidebarVisibility.Closed})},i.renderSidebarUpsellFn=function(e){var t,n=e.fileViewerUiData.sidebar.visibility;return i.props.user?i.props.previewType===x.PreviewType.Video&&j.reelBetaEnabled()&&n!==a.SidebarVisibility.Closed&&i.props.sizeClass!==O.SizeClass.Medium?r.default.createElement(K.AsyncReplayPrompt,null):r.default.createElement(V.AsyncEsignUpsell,{isCollapsed:n===a.SidebarVisibility.Closed||i.props.sizeClass===O.SizeClass.Medium,file:i.props.file,userId:null===(t=i.props.user)||void 0===t?void 0:t.id,launchHelloSignDeepIntegration:i.props.onHelloSignDeepIntegrationLaunch}):null},i.getPASSProviderProps=function(){var e=i.props,t=e.user,n=void 0===t?null:t,r=e.file,o=e.isVersionHistoryMode,a=e.sizeClass,s=e.sharePermission,l=e.isSeenStatesEnabled,c=e.isViewingFileSubpath,u=e.sharedLinkInfo;return r?{user:n,file:r,isVersionHistoryMode:o,sizeClass:a,isViewMetadataDisabled:void 0!==s&&0===s.canViewMetadataRoles.length,isSeenStatesEnabled:l,isViewingFileSubpath:c,sharedLinkInfo:u}:null},i.state={watermarkControlHasBeenClicked:!1},i}return n.__extends(t,e),t.prototype.sidebarWidth=function(){switch(this.props.sizeClass){case O.SizeClass.ExtraLarge:return 490;case O.SizeClass.Large:return 440;case O.SizeClass.Medium:return 320;case O.SizeClass.Small:return 0}},t.prototype.componentWillUnmount=function(){this.props.resetSidebarPaneStack()},t.prototype.render=function(){var e,t=this.props,i=t.handleSidebarDispatch,s=t.fileViewerUiData,l={renderSidebarNotificationsFn:this.renderSidebarNotificationsFn,renderSidebarCallToActionsFn:this.renderSidebarCallToActionsFn,renderSidebarOverflowMenuFn:this.props.renderSidebarOverflowMenuFn,renderSidebarPASSFn:this.renderSidebarPASSFn,renderSidebarUpsellFn:this.renderSidebarUpsellFn},c=r.default.createElement(o.Sidebar,n.__assign({fileViewerUiData:s,fileId:"",intl:W.intl,dispatch:i,fileViewerId:"dummy",registerSidebarPanesFn:this.registerSidebarPanesFn,renderSidebarControlsFn:this.createRenderSidebarControlsFn(this.props.disabledModes),width:s.sidebar.visibility===a.SidebarVisibility.Open?this.sidebarWidth():void 0,pluginMode:{type:"default"}},l));return(e=this.getPASSProviderProps())?r.default.createElement(N.AsyncSeenStatesProviderWrapper,n.__assign({},e),c):c},Object.defineProperty(t.prototype,"isProAnalyticsPaneEnabled",{get:function(){var e=this.props,t=e.file,n=e.isViewingFileSubpath,r=e.sharedLinkInfo,i=e.user;return void 0!==t&&!n&&!r&&l.isProAnalyticsEnabled(i)},enumerable:!1,configurable:!0}),t})(r.default.PureComponent);t.UnconnectedSidebar=H,t.Sidebar=i.connect((function(e,t){var n=t.file,r=void 0!==n&&B.isBrowseFile(n);return{docClassification:n&&d.getDocClassificationForFile(e,n.file_id),docClassificationVariant:s.getHelloSignMLClassificationVariant(e),disabledModes:d.getDisabledModes(e),extensionsEnabled:D.getExtensionsEnabled(e),fileViewerUiData:{currentMode:d.getMode(e),sidebar:d.getSidebar(e)},isSendForSignatureEnabled:s.isSendForSignatureEnabled(e),hellosignAppAction:n&&d.getHelloSignAppActionForFile(e,n),isHelloSignAppActionInSidebarEnabled:r&&F.isHelloSignAppActionInFileViewerSidebarEnabled(e),isHelloSignDeepIntegrationInSidebarEnabled:r&&F.isHelloSignDeepIntegrationInFileViewerSidebarEnabled(e)}}),(function(e){return{handleSidebarDispatch:c.createSidebarDispatchHandler(e),changeMode:function(t){return e(u.changeMode(t))},resetSidebarPaneStack:function(){return e(u.resetSidebarPaneStack())}}}))(H)})),define("modules/clean/react/file_viewer_sidebar/utils",["require","exports","modules/clean/react/file_viewer/data/actions","file-viewer/core/index"],(function(e,t,n,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.getSecondFromTopSidebarPaneId=t.isSidebarPaneIdAtTopOfStack=t.isSidebarOpen=t.createSidebarDispatchHandler=void 0;var o=((i={})[r.SidebarControlId.Documentation]=function(e){e(n.changeMode(r.FileViewerMode.Documentation))},i[r.SidebarControlId.Comments]=function(e){e(n.changeMode(r.FileViewerMode.Commenting))},i[r.SidebarControlId.Watermarking]=function(e){e(n.changeMode(r.FileViewerMode.Watermarking))},i[r.SidebarControlId.Zoom]=function(e){e(n.changeMode(r.FileViewerMode.Zoom))},i[r.SidebarControlId.Slack]=function(e){e(n.changeMode(r.FileViewerMode.Slack))},i[r.SidebarControlId.Markup]=function(e){e(n.changeMode(r.FileViewerMode.Markup))},i[r.SidebarControlId.HelloSign]=function(e){e(n.changeMode(r.FileViewerMode.HelloSign))},i[r.SidebarControlId.ProAnalytics]=function(e){e(n.changeMode(r.FileViewerMode.ProAnalytics))},i);t.createSidebarDispatchHandler=function(e){return function(t){if((function(e){return e.type===r.Action.SidebarControlClick})(t)){var i=t.payload.controlId;return(0,o[i])(e,t)}return t.type===r.Action.CloseSidebar?e(n.setSidebarVisibility(r.SidebarVisibility.Closed)):t.type===r.Action.OpenSidebar?e(n.setSidebarVisibility(r.SidebarVisibility.Open)):void 0}},t.isSidebarOpen=function(e){return e.visibility===r.SidebarVisibility.Open},t.isSidebarPaneIdAtTopOfStack=function(e,t){var n=t.paneStack;return n.length>0&&n[n.length-1]===e},t.getSecondFromTopSidebarPaneId=function(e){var t=e.paneStack;return t.length<2?null:t[t.length-2]}})),define("modules/clean/react/file_viewer_sidebar/widgets/seen_states",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/previews/util"],(function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncSeenStatesProviderWrapper=t.AsyncSeenStateFacepileConsumer=t.AsyncSeenStateFacepileProvider=void 0,r=n.__importDefault(r),t.AsyncSeenStateFacepileProvider=i.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/pass/seen_state_facepile_controller"],t,n)})).then(n.__importStar).then((function(e){return e.SeenStateFacepileProvider}))}}),t.AsyncSeenStateFacepileConsumer=i.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/pass/seen_state_facepile_consumer"],t,n)})).then(n.__importStar).then((function(e){return e.SeenStateFacepileConsumer}))}}),t.AsyncSeenStatesProviderWrapper=function(e){var n=e.children,i=e.file,a=e.isSeenStatesEnabled,s=e.isVersionHistoryMode,l=e.isViewingFileSubpath,c=e.isViewMetadataDisabled,u=e.sharedLinkInfo,d=e.sizeClass,p=e.user;return!a||s||null===i.ns_id||o.isCloudDocPreview(i)?r.default.createElement(r.default.Fragment,null,n):r.default.createElement(t.AsyncSeenStateFacepileProvider,{file:i,isViewMetadataDisabled:c,isViewingFileSubpath:!!l,sharedLinkInfo:u,sizeClass:d,user:p},n)}})),define("modules/clean/react/file_viewer_titlebar/edit_mode_titlebar",["require","exports","tslib","react","classnames","file-viewer/titlebar/index","modules/clean/file_store/utils","modules/clean/em_string","modules/clean/react/file_viewer/feedback_form/feedback_form_modal","spectrum/button/index","modules/core/i18n","modules/clean/react/workflows/markup/api","file-viewer/core/index","modules/clean/react/size_class/constants","modules/constants/file_viewer"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditModeTitlebar=void 0,r=n.__importDefault(r),i=n.__importDefault(i);var g=(function(e){function t(t){var n=e.call(this,t)||this;return n.openFeedbackModal=function(){n.setState({isFeedbackModalOpen:!0})},n.closeFeedbackModal=function(){n.setState({isFeedbackModalOpen:!1})},n.renderFeedbackFormModal=function(){if(n.props.mode===p.FileViewerMode.Markup){var e=u.intl.formatMessage({id:"eWxZ5f",defaultMessage:"How satisfied are you with Dropbox Markup?"}),t=u.intl.formatMessage({id:"Oi1tCv",defaultMessage:"Tell us what you liked and didn’t like about Dropbox Markup."});return r.default.createElement(l.FeedbackFormModal,{user:n.props.user,title:e,commentPrompt:t,open:n.state.isFeedbackModalOpen,onRequestClose:n.closeFeedbackModal,submitFeedback:d.submitMarkupFeedback})}return null},n.state={isFeedbackModalOpen:!1},n}return n.__extends(t,e),t.prototype.render=function(){var e=f.FILE_MARKUP_FEEDBACK_FORM&&this.props.mode===p.FileViewerMode.Markup&&this.props.sizeClass!==m.SizeClass.Small;return r.default.createElement("div",{className:"files2-title-bar"},r.default.createElement(o.LargeTitlebar,{className:i.default("title"),title:r.default.createElement(r.default.Fragment,null,e&&r.default.createElement(c.Button,{className:"files2-title-bar__feedback-button",size:"large",variant:"primary",onClick:this.openFeedbackModal},u.intl.formatMessage({id:"yNdnfh",defaultMessage:"Feedback"})),r.default.createElement("h1",{className:i.default("filename")},r.default.createElement("div",{className:"filename--text"},r.default.createElement("span",{className:"filename--prefix"},this.props.title+": "),s.Emstring.em_snippet(a.getFilename(this.props.file),this.props.maxFilenameEmLength),this.props.beta?r.default.createElement("span",{className:"filename--beta-tag"},"beta"):null),this.renderFeedbackFormModal()))}))},t})(r.default.PureComponent);t.EditModeTitlebar=g})),define("modules/clean/react/file_viewer_titlebar/loadable_icon",["require","exports","tslib","react","modules/clean/react/async/loadable"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableTitleIcon=void 0,r=n.__importDefault(r),t.LoadableTitleIcon=i.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/title_bar/title_bar_title"],t,n)})).then(n.__importStar).then((function(e){return e.TitleBarTitle}))},loading:r.default.createElement("div",{className:"react-title-icon"})}),t.LoadableTitleIcon.displayName="LoadableTitleIcon"})),define("modules/clean/react/file_viewer_titlebar/loadable_title",["require","exports","tslib","react","modules/clean/react/async/loadable"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableTitle=void 0,r=n.__importDefault(r),t.LoadableTitle=i.Loadable({loader:function(){return new Promise((function(t,n){e(["modules/clean/react/file_viewer/title_name"],t,n)})).then(n.__importStar).then((function(e){return e.TitleName}))},loading:r.default.createElement("div",{className:"react-title-name"})})})),define("modules/clean/react/file_viewer_titlebar/titlebar",["require","exports","tslib","file-viewer/titlebar/index","modules/clean/file_store/utils","modules/clean/react/file_viewer/title_utils","modules/clean/react/file_viewer_titlebar/loadable_icon","modules/clean/react/file_viewer_titlebar/loadable_title","modules/clean/react/size_class/constants","react","spectrum/file_icon/index","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/size_class","classnames"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileTitleBar=t.Titlebar=void 0,c=n.__importDefault(c),f=n.__importDefault(f);var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.overrideIcon=t.props.hidePageChrome?c.default.createElement("div",{className:"file-icon"},c.default.createElement(u.FileIcon,{path:i.getFilename(t.props.file)})):null,t}return n.__extends(t,e),t.prototype.render=function(){return c.default.createElement("div",{className:"files2-title-bar"},c.default.createElement(r.LargeTitlebar,n.__assign({className:f.default("title",{isSidebarOpen:this.props.isSidebarOpen}),title:c.default.createElement(s.LoadableTitle,{file:this.props.file,fileSubpath:this.props.fileSubpath,hidePageChrome:this.props.hidePageChrome,isViewingFileSubpath:this.props.isViewingFileSubpath,maxFilenameEmLength:this.props.maxFilenameEmLength,sharedLinkInfo:this.props.sharedLinkInfo,sizeClass:this.props.sizeClass,user:this.props.user}),icon:this.props.hideIcon?null:c.default.createElement(a.LoadableTitleIcon,{closeTitle:o.closeButtonTitle({file:this.props.file,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,sharedLinkInfo:this.props.sharedLinkInfo,isVersionHistoryMode:this.props.isVersionHistoryMode}),canClose:this.props.canClose,closeUrl:this.props.closeUrl,file:this.props.file,isSendForSignatureMode:!1,isSigningMode:!1,onClose:this.props.onClose,shouldShowIcon:!this.props.isViewingFileSubpath,sizeClass:this.props.sizeClass,overrideIcon:this.overrideIcon})},{renderTitleOverflowMenuFn:this.props.sizeClass===l.SizeClass.Small?this.props.renderTitlebarOverflowMenuFn:void 0})))},t})(c.default.PureComponent);t.Titlebar=g,t.FileTitleBar=m.withSizeClass(g,{isResponsiveEnabled:d.isResponsiveEnabled,responsiveClassName:p.ResponsiveClassName})})),define("modules/clean/react/file_viewer_sidebar/panes/pro_analytics_pane",["require","exports","tslib","react","file-viewer/modes/index","file-viewer/core/index","pro-ui/components/sidebar_pane/analytics_pane/index","pro-ui/data/amp-logger","react-redux","modules/clean/pro_analytics/data/store","modules/core/i18n","react-intl","modules/clean/metrics/index","modules/core/user_i18n","modules/clean/pro_analytics/data/util","modules/clean/react/pass/utils","modules/core/browser"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProAnalyticsPane=void 0,r=n.__importDefault(r),m=n.__importStar(m),t.ProAnalyticsPane=function(e){var t=e.coreFVUiProps,h=e.user,v=e.fileId,b=e.isCollapsed,w=e.teamName,y={fileId:v,getUserInitials:function(e,t){return g.AnonymousViewerUtils.isAnonymousUserId(e)?g.AnonymousViewerUtils.getAnonymousViewerInitials(t):m.getInitials(t)},collapsed:b,displayStreamItemLocations:f.isProAnalyticsExperimentalEnabled(h),openTab:_.open_tab,teamName:w};return s.AmpLogger.conditionallySetSingleton((function(){return p.getMetricsReporter()})),r.default.createElement(l.Provider,{store:c.getProAnalyticsStore(h)},r.default.createElement(d.RawIntlProvider,{value:u.intl},r.default.createElement(i.Pane,n.__assign({paneId:o.SidebarPaneId.ProAnalytics},t),r.default.createElement(a.AnalyticsComponentPicker,n.__assign({},y)))))}})),define("modules/clean/react/pass/store",["require","exports","tslib","lodash","modules/clean/flux/base_store","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/core/exception"],(function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passStore=t.PassStore=void 0,r=n.__importStar(r),s=n.__importStar(s);var l=(function(){function e(){this.userIdToUniqueIds={}}return e.prototype.addUniqueUser=function(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0},e.prototype.removeUniqueUser=function(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])},e.prototype.getOnlineUserIds=function(){return Object.keys(this.userIdToUniqueIds)},e})(),c=(function(e){function t(t){var n=e.call(this,t)||this;return n.seenStateInfos={},n.seenStateCursors={},n.presenceInfos={},n.passFetchingStatusMap={},n.userIdsWithoutSeenStateInfoMap={},n.userIdsWithoutTeamInteractionInfoMap={},n.userTeamInteractionInfoMap={},n.passPermissions={},n}return n.__extends(t,e),t.prototype.presence=function(e){return e in this.presenceInfos?this.presenceInfos[e].getOnlineUserIds():null},t.prototype.seenStateInfo=function(e){return this.seenStateInfos[e]||null},t.prototype.identifiedSeenStateInfo=function(e){return e in this.seenStateInfos?{seen_states:r.reject(this.seenStateInfos[e].seen_states,a.AnonymousViewerUtils.isAnonymousSeenState)}:null},t.prototype.seenStateCursorHasNext=function(e){return e in this.seenStateCursors?this.seenStateCursors[e].has_next:null},t.prototype.seenStateCursorState=function(e){return e in this.seenStateCursors?this.seenStateCursors[e].cursor_state:null},t.prototype.passFetchingStatus=function(e){return this.passFetchingStatusMap[e]||o.PassFetchingStatus.NOT_YET_KNOWN},t.prototype.getLinkAndGroupSeenStateInfo=function(e){var t=null,n=null;if(!this.seenStateInfos[e])return{linkSeenStateInfo:t,groupSeenStateInfo:n};t=[],n={};for(var r=0,i=this.seenStateInfos[e].seen_states;r<i.length;r++){var o=i[r];if(!a.AnonymousViewerUtils.isAnonymousSeenState(o)){var s=o.seen_state_user.sharing_access_type;if(s)switch(s.type){case"link_only":case"view_link_access":case"edit_link_access":t.push(o);break;case"view_member_access":case"edit_member_access":for(var l=0,c=s.value.group_ids;l<c.length;l++){var u=c[l];u in n||(n[u]=[]),n[u].push(o)}}}}return{linkSeenStateInfo:t,groupSeenStateInfo:n}},t.prototype.anonymousPresence=function(e){return e in this.presenceInfos?a.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[e].getOnlineUserIds()):null},t.prototype.userIdsWithoutSeenStateInfo=function(e){return this.userIdsWithoutSeenStateInfoMap[e]||[]},t.prototype.userIdsWithoutTeamInteractionInfo=function(e){return this.userIdsWithoutTeamInteractionInfoMap[e]||[]},t.prototype.userTeamInteractionInfo=function(e){return this.userTeamInteractionInfoMap[e]||{}},t.prototype.isPassPermissionsPending=function(e){var t=this.passPermissions[e];return null!=t&&!(t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState")&&t.hasOwnProperty("canWritePresence"))},t.prototype.getPassPermissions=function(e){if(!e)return null;var t=this.passPermissions[e];return null==t||this.isPassPermissionsPending(e)?null:t},t.prototype.resetPassInfo=function(e){delete this.seenStateInfos[e],delete this.seenStateCursors[e],delete this.presenceInfos[e],delete this.passFetchingStatusMap[e],delete this.passPermissions[e],delete this.userIdsWithoutSeenStateInfoMap[e],this.emit_change()},t.prototype.setPassPermissionRequest=function(e){this.passPermissions[e]={},this.setPassFetchingStatus(e,o.PassFetchingStatus.FETCHING)},t.prototype.updatePermissions=function(e,t){this.passPermissions.hasOwnProperty(e)&&(this.passPermissions[e]=n.__assign(n.__assign({},this.passPermissions[e]),t),this.emit_change())},t.prototype.markPassConcludedIfNecessary=function(e){var t=this.passPermissions[e];!(t&&t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState"))||t.canReadPresence||t.canReadSeenState||(this.resetPassInfo(e),this.setPassFetchingStatus(e,o.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(e))},t.prototype.receivePresenceDelta=function(e,t,n,r){s.assert(-1===[o.PassFetchingStatus.FETCHING,o.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var i=this.getOnlineUsersForFileId(t);this.updatePresenceInfos(t,n,r),this.updateUserIdsWithoutSeenStateInfo(e,t,i),this.emit_change()},t.prototype.receivePresenceSnapshot=function(e,t,n){s.assert(-1===[o.PassFetchingStatus.FETCHING,o.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");var r=this.getOnlineUsersForFileId(t);this.presenceInfos[t]=new l,this.updatePresenceInfos(t,n,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,r),this.emit_change()},t.prototype.getOnlineUsersForFileId=function(e){return e in this.presenceInfos||(this.presenceInfos[e]=new l),this.presenceInfos[e].getOnlineUserIds()},t.prototype.updatePresenceInfos=function(e,t,n){for(var r=0,i=Object.keys(n);r<i.length;r++)for(var o=i[r],a=0,s=Object.keys(n[o]);a<s.length;a++){var l=s[a];this.presenceInfos[e].removeUniqueUser(o,l)}for(var c=0,u=Object.keys(t);c<u.length;c++)for(var d=u[c],p=0,m=Object.keys(t[d]);p<m.length;p++){l=m[p];this.presenceInfos[e].addUniqueUser(d,l)}},t.prototype.updateUserIdsWithoutSeenStateInfo=function(e,t,n){var i,s,l=a.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileId(t)),c=a.AnonymousViewerUtils.filterAnonymousUserIds(n),u=r.difference(c,l),d=r.difference(l,c);if(t in this.seenStateInfos){var p=void 0,m=this.passFetchingStatus(t);if(-1!==[o.PassFetchingStatus.SEEN_STATE_DISALLOWED,o.PassFetchingStatus.PASS_MIXED_SUCCESS].indexOf(m))s=(i=this.createMinimalBaseSeenStateInfo(t,l)).userIdsWithoutSeenStateInfo,p=i.baseSeenStateInfo,this.updateSeenStateInfo(t,p);else{var f=this.makeSeenStateAgreeWithUpdatedPresence(t,l,u,d);s=f.userIdsWithoutSeenStateInfo,p=f.baseSeenStateInfo}}else s=[];this.userIdsWithoutSeenStateInfoMap[t]=s},t.prototype.makeSeenStateAgreeWithUpdatedPresence=function(e,t,r,i){for(var o=[],a=this.seenStateInfos[e],s=a.seen_states,l=[],c=[],u=[],d=Date.now()/1e3,p=0,m=s;p<m.length;p++){var f=m[p],g=f.seen_state_user.user_id;g&&(o.push(g),i.includes(g)?(f.when_last_seen=d,f.seen_events=f.seen_events||[],c.push(f)):r.includes(g)?(f.when_last_seen=d,f.seen_events=f.seen_events||[],f.seen_events.push({ts:d}),u.push(f)):l.push(f))}return a.seen_states=n.__spreadArrays(c,u,l),{userIdsWithoutSeenStateInfo:t.filter((function(e){return!o.includes(e)})),baseSeenStateInfo:a}},t.prototype.createMinimalBaseSeenStateInfo=function(e,t){for(var n=[],i=[],o=0,a=this.seenStateInfos[e].seen_states;o<a.length;o++){var s=a[o],l=s.seen_state_user.user_id;l&&t.includes(l)&&(n.push(s),i.push(l))}return{userIdsWithoutSeenStateInfo:r.difference(t,i),baseSeenStateInfo:{seen_states:n}}},t.prototype.updateSeenStateInfo=function(e,t,n){void 0===n&&(n=!1),s.assert(-1===[null,o.PassFetchingStatus.FETCHING].indexOf(this.passFetchingStatus(e)),"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled"),n&&e in this.seenStateInfos?this.seenStateInfos[e].seen_states=this.seenStateInfos[e].seen_states.concat(t.seen_states):this.seenStateInfos[e]=t,this.userIdsWithoutTeamInteractionInfoMap[e]=this.userIdsWithoutSeenStateInfoMap[e],this.userIdsWithoutSeenStateInfoMap[e]=[],this.emit_change()},t.prototype.updateSeenStateInfoWithEmptyData=function(e){this.updateSeenStateInfo(e,{seen_states:[]})},t.prototype.setPassFetchingStatus=function(e,t){this.passFetchingStatusMap[e]=t,this.emit_change()},t.prototype.updateSeenStateCursor=function(e,t){t&&(this.seenStateCursors[e]=t,this.emit_change())},t.prototype.assureSeenStateSuccessRegistered=function(e){switch(this.passFetchingStatus(e)){case o.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,o.PassFetchingStatus.SEEN_STATE_SUCCESS);break;case o.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_SUCCESS);break;case o.PassFetchingStatus.SEEN_STATE_DISALLOWED:s.reportStack("Debugging FETCHING_STATUS: pass fetching status is seen state disallowed",{severity:s.SEVERITY.NONCRITICAL,tags:["pass:fetch_seen_state_disallowed"],exc_extra:{storeHasPresence:e in this.presenceInfos,storeHasSeenState:e in this.seenStateInfos,passPermissions:JSON.stringify(this.passPermissions[e]),fetchingStatus:this.passFetchingStatusMap[e]}});break;case o.PassFetchingStatus.NOT_YET_KNOWN:s.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:s.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},t.prototype.onFetchSeenStateDisabled=function(e){switch(this.passFetchingStatus(e)){case o.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case o.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,o.PassFetchingStatus.SEEN_STATE_DISALLOWED);break;case o.PassFetchingStatus.NOT_YET_KNOWN:s.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:s.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},t.prototype.assurePresenceSuccessRegistered=function(e){switch(this.passFetchingStatus(e)){case o.PassFetchingStatus.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_SUCCESS);break;case o.PassFetchingStatus.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,o.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case o.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,o.PassFetchingStatus.PRESENCE_SUCCESS);break;case o.PassFetchingStatus.NOT_YET_KNOWN:s.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:s.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}},t.prototype.updateUserTeamInteractionInfo=function(e,t){if(e in t)for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];this.userTeamInteractionInfoMap[e][i]=t[i]}else this.userTeamInteractionInfoMap[e]=t;this.userIdsWithoutTeamInteractionInfoMap[e]=[],this.emit_change()},t.prototype._new_payload=function(e){var t=e.action,n=t.type,r=t.data;if(r){var i=r.userId,a=r.fileId,s=r.teamId,l=r.seenStateInfo,c=r.seenStateCursor,u=r.onlineUniqueUsers,d=r.offlineUniqueUsers,p=r.partialPermission,m=r.userTeamInteractionInfo,f=r.userTeamInteractionUserIds;switch(i=i,a=a,s=s,l=l,c=c,u=u,d=d,p=p,m=m,f=f,n){case o.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(a,o.PassFetchingStatus.ERROR);break;case o.ActionTypes.FETCH_PASS_CONCLUDED:this.setPassFetchingStatus(a,o.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(a);break;case o.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(a);break;case o.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(a),this.receivePresenceDelta(i,a,u,d);break;case o.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(a),this.receivePresenceSnapshot(i,a,u);break;case o.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(a);break;case o.ActionTypes.UPDATE_PERMISSIONS:this.updatePermissions(a,p),this.markPassConcludedIfNecessary(a);break;case o.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:c={cursor_state:"",has_next:!1},this.updateSeenStateCursor(a,c);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(a),this.updateSeenStateInfo(a,l),this.updateSeenStateCursor(a,c);break;case o.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(a),this.updateSeenStateInfo(a,l,!0),this.updateSeenStateCursor(a,c);break;case o.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:this.onFetchSeenStateDisabled(a),this.updateSeenStateInfoWithEmptyData(a),this.updateUserIdsWithoutSeenStateInfo(i,a,[]);break;case o.ActionTypes.UPDATE_USER_TEAM_INTERACTION_INFO:this.updateUserTeamInteractionInfo(a,m)}}},t})(i.Store);t.PassStore=c,t.passStore=new c})),define("modules/clean/pro_analytics/data/util",["require","exports","modules/constants/file_viewer"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isProAnalyticsExperimentalEnabled=t.isProAnalyticsEnabled=void 0,t.isProAnalyticsEnabled=function(e){return Boolean(e&&n.SMART_LINKS_ANALYTICS_BY_USER_ID[e.id])},t.isProAnalyticsExperimentalEnabled=function(e){return!1}})),define("modules/clean/auth/login_or_register/types",["require","exports"],(function(e,t){"use strict";var n,r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.Mode=t.LoginOrRegisterKind=t.DownloadAction=t.CommentTextVariant=void 0,(function(e){e.COMMENT="comment",e.DOWNLOAD="download",e.IMMEDIATE="immediate",e.SIDEBAR="sidebar",e.POSTDOWNLOAD="postdownload"})(n||(n={})),t.LoginOrRegisterKind=n,(function(e){e.DIRECT_DOWNLOAD="direct_download",e.SAVE_TO_DROPBOX="add_to_dropbox"})(r||(r={})),t.DownloadAction=r,(function(e){e[e.LOGIN=0]="LOGIN",e[e.REGISTER=1]="REGISTER"})(i||(i={})),t.Mode=i,(function(e){e.DEFAULT="",e.POST="post_comment_variant",e.SUBSCRIBE="subscribe_variant"})(o||(o={})),t.CommentTextVariant=o})),define("modules/clean/react/file_viewer/conversions/conversion_utils",["require","exports","modules/constants/file_viewer"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowSplitSignup=t.shouldShowSuggestedTextComments=t.shouldShowSimplifiedModal=t.shouldShowSignupButton=t.shouldOpenModalFromSidebar=t.variantIsGAed=t.ConversionExperimentVariant=void 0,t.ConversionExperimentVariant=function(){return n.PREVIEWS_CONVERSION_EXPERIMENTS},t.variantIsGAed=function(){return"ON"===n.PREVIEWS_CONVERSION_GA||"M1"===n.PREVIEWS_CONVERSION_GA},t.shouldOpenModalFromSidebar=t.variantIsGAed,t.shouldShowSignupButton=t.variantIsGAed,t.shouldShowSimplifiedModal=function(){return"SIMPLIFIED_MODAL"===t.ConversionExperimentVariant()||"SPLIT_SIGNUP"===t.ConversionExperimentVariant()||t.variantIsGAed()},t.shouldShowSuggestedTextComments=function(){return"SUGGESTED_COMMENTS_TEXT"===t.ConversionExperimentVariant()||"M1"===n.PREVIEWS_CONVERSION_GA},t.shouldShowSplitSignup=function(){return"SPLIT_SIGNUP"===t.ConversionExperimentVariant()}})),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","lodash","ts-keycode-enum"],(function(e,t,n,r,i){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.withPreventDefault=t.isKeyboardEvent=t.getPrintKeyBindings=t.getMinusKeyBindings=t.getEqualsKeyBindings=t.addLegacyPropertiesToSimpleKeyboardEvent=t.getSimpleKeyboardEvent=t.getKeyboardEventCriteria=t.hydrateKeyboardBinding=t.generateUnmodifiedSimpleKeyboardEvent=t.generateUnmodifiedKeyboardEventCriteria=t.KeyboardEventCriteriaKeys=t.SimpleKeyboardEventKeys=t.genericKeyboardEventCriteria=t.ExtraKeyCodes=void 0,r=n.__importStar(r),(function(e){e[e.EQUALS=61]="EQUALS",e[e.PLUS_EQUALS_FF=107]="PLUS_EQUALS_FF",e[e.PLUS_EQUALS_FF_GERMAN=171]="PLUS_EQUALS_FF_GERMAN",e[e.MINUS_FF_MAC=173]="MINUS_FF_MAC",e[e.MINUS_FF=109]="MINUS_FF"})(o=t.ExtraKeyCodes||(t.ExtraKeyCodes={})),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};var a={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(a),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=function(e){return n.__assign(n.__assign({},t.genericKeyboardEventCriteria),{which:e})},t.generateUnmodifiedSimpleKeyboardEvent=function(e){return n.__assign(n.__assign({},a),{which:e})};var s=function(){};function l(e){return{keyboardEventCriteria:n.__assign(n.__assign({},t.genericKeyboardEventCriteria),e.keyboardEventCriteria),callback:null!=e.callback?e.callback:s}}function c(e){return r.flatten(e.map((t="shiftKey",function(e){return(function(e,t){var n,r;return[(n={which:e},n[t]=!0,n),(r={which:e},r[t]=!1,r)]})(e,t)})));var t}function u(e,t){return e.map((function(e){return l({keyboardEventCriteria:e,callback:t})}))}t.hydrateKeyboardBinding=l,t.getKeyboardEventCriteria=function(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}},t.getSimpleKeyboardEvent=function(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}},t.addLegacyPropertiesToSimpleKeyboardEvent=function(e){return n.__assign(n.__assign({},e),{keyCode:null!=e.keyCode?e.keyCode:e.which})};var d=c([o.EQUALS,o.PLUS_EQUALS_FF,i.Key.PlusSign,o.PLUS_EQUALS_FF_GERMAN]),p=c([i.Key.Dash,o.MINUS_FF_MAC,o.MINUS_FF]),m=[{which:i.Key.P},{which:i.Key.P,ctrlKey:!0},{which:i.Key.P,metaKey:!0}];function f(e){return void 0!==e.preventDefault}t.getEqualsKeyBindings=function(e){return u(d,e)},t.getMinusKeyBindings=function(e){return u(p,e)},t.getPrintKeyBindings=function(e){return u(m,e)},t.isKeyboardEvent=f,t.withPreventDefault=function(e){return function(t){e(),t&&f(t)&&t.preventDefault()}}})),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardBindingConnector=void 0;var o=(function(e){function t(t,n){var r=e.call(this,t,n)||this;if(!n.registerKeyBindings||!n.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider");return r}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)},t.prototype.componentWillReceiveProps=function(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)},t.prototype.componentWillUnmount=function(){this.context.unregisterKeyBindings(this.registrationIdentifier)},t.prototype.render=function(){return null},t.contextTypes=i.KeyboardBindingProviderContextTypes,t})((r=n.__importDefault(r)).default.Component);t.KeyboardBindingConnector=o})),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","react","prop-types","modules/clean/callback_chain/callback_chain","ts-keycode-enum","modules/clean/react/keyboard_binding/keyboard_binding"],(function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simulateKeyEvent=t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=t.getIndexForkeyboardBindingsByCriteria=t.KeyboardBindingProvider=t.noop=t.KeyboardBindingProviderContextTypes=void 0,r=n.__importDefault(r),i=n.__importDefault(i),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:i.default.func,registerKeyBindings:i.default.func,unregisterKeyBindings:i.default.func,updateKeyBindings:i.default.func};var l=[];t.noop=function(e){};var c=(function(e){function i(n){var r=e.call(this,n)||this;return r.registrationIdentifier=0,r.registeredBindings=[],r.keyboardBindingsByCriteria={},r.allKeyHandlers=[],r.registerKeyBindings=function(e){var n=r.registrationIdentifier++;return r.updateKeyBindings(n,e),r.allKeyHandlers[n]||(r.allKeyHandlers[n]=t.noop),n},r.registerAllKeyCallback=function(e,n){r.allKeyHandlers[e]=null!=n?n:t.noop},r.unregisterKeyBindings=function(e){r.updateKeyBindings(e,[]),r.allKeyHandlers[e]=t.noop},r.updateKeyBindings=function(e,t){r.registeredBindings[e]=null!=t?t:[],r.keyboardBindingsByCriteria=d(r.registeredBindings)},r.onKeyDown=function(e){if(e&&(!s.isKeyboardEvent(e)||(function(e){var t=e.target||e.srcElement;if(!t)return!0;var n=t.tagName,r=e.which,i="INPUT"===n||"SELECT"===n||"TEXTAREA"===n,o=-1!==["submit","button"].indexOf(t.type),s=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();if(i&&!o||s)return r===a.Key.Escape||r===a.Key.Tab;return!0})(e))){var t=r.getCallbacksForKey(e);new o.CallbackChain(t).run(e)}},r.allKeyHandlers=[],r.registeredBindings=[],r}return n.__extends(i,e),i.prototype.componentDidMount=function(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=l.length,l.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()},i.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.onKeyDown),l[this.providerIdentifier]=t.noop,this.props.onDestroy&&this.props.onDestroy()},i.prototype.getChildContext=function(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}},i.prototype.getCallbacksForKey=function(e){var t=u(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)},i.prototype.render=function(){return r.default.Children.only(this.props.children)},i.childContextTypes=t.KeyboardBindingProviderContextTypes,i})(r.default.Component);function u(e){var t=s.getKeyboardEventCriteria(e),n="";return s.KeyboardEventCriteriaKeys.forEach((function(e){n+=e+":"+t[e]+","})),n}function d(e){return e.reduce((function(e,t){return t.reduce((function(e,t){var n=t.keyboardEventCriteria,r=t.callback,i=u(n);return e[i]=e[i]||[],e[i].push(r),e}),e)}),{})}t.KeyboardBindingProvider=c,t.getIndexForkeyboardBindingsByCriteria=u,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=d,t.simulateKeyEvent=function(e){var t=s.addLegacyPropertiesToSimpleKeyboardEvent(e);new o.CallbackChain(l).run(t)}})),define("modules/clean/react/previews/video/audio_waveform/utils",["require","exports","modules/clean/average_counter"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.returnWaveform=t.buildFromBuffer=void 0,t.buildFromBuffer=function(e,t,r,i,o){var a=e.getChannelData(0),s=new Array(t);setTimeout((function e(l){return function(){if(l>=t)o(s);else{var c=[],u=Math.ceil(l*a.length/t),d=Math.ceil((l+1)*a.length/t),p=d-u;if(p>r)for(var m=0;m<r;m++){var f=Math.floor(Math.random()*p)+u;c.push(Math.abs(a[f]))}else for(m=u;m<d;m++){var g=Math.floor(Math.abs(a[m]));c.push(g)}var _=new n.AverageCounter;_.addArray(c),s[l]=_.getAverage(),i()&&setTimeout(e(l+1),0)}}})(0),0)},t.returnWaveform=function(e,t,r){void 0===r&&(r=1);var i=[];if(0===e.length||t<=0||isNaN(t))return i;for(var o=[],a=0;a<t;a++)o.push(new n.AverageCounter);var s=0,l=0;for(a=0;a<e.length;a++){var c=e[a],u=Math.floor(a*t/e.length),d=o[u];d.add(c),i[u]=d.getAverage(),u!==l&&(s=Math.max(s,i[l]),l=u)}return s=Math.max(s,i[t-1]),i.map((function(e){return e*r/s}))}})),define("modules/clean/react/file_sidebar/managed_comments_tab",["require","exports","tslib","react","react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/components/comments_tab","modules/clean/file_store/utils"],(function(e,t,n,r,i,o,a,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManagedCommentsTab=t.streamFromProps=void 0,r=n.__importDefault(r),t.streamFromProps=function(e){var t=e.currentFile,n=e.currentFile,r=n.bytes,i=n.file_id,o=n.ns_id,a=n.sjid,s=e.sharedLinkInfo,c=e.isVersionHistoryMode,u=e.reelId;return{id:i,linkUrl:s&&s.url,ns_id:o,sjid:a,type:"file",fq_path:"fq_path"in t?t.fq_path:void 0,isVersionHistoryMode:c,bytes:r,filename:l.getFilename(t),reel_id:u}};var c=(function(e){function l(n){var r=e.call(this,n)||this;return r.setContext=function(e){r.store.dispatch(o.Actions.setFileContext({stream:t.streamFromProps(e),viewer:e.user}))},r.store=a.getStoreForComments2(),r}return n.__extends(l,e),l.prototype.componentDidMount=function(){this.setContext(this.props)},l.prototype.componentWillUpdate=function(e){this.setContext(e)},l.prototype.render=function(){return this.store?r.default.createElement(i.Provider,{store:this.store},r.default.createElement(s.CommentsTab,n.__assign({},this.props))):null},l})(r.default.Component);t.ManagedCommentsTab=c})),define("modules/clean/react/comments2/data/sidebar_watcher",["require","exports","tslib","eventemitter3"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMENTS_HIDDEN_SIGNAL=t.COMMENTS_VISIBLE_SIGNAL=t.sideChannelEventEmitter=void 0,r=n.__importDefault(r),t.sideChannelEventEmitter=new r.default,t.COMMENTS_VISIBLE_SIGNAL="comments_visible",t.COMMENTS_HIDDEN_SIGNAL="comments_hidden"})),define("modules/clean/reel/lib/utils",["require","exports","modules/constants/reel"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reelBetaSyncCollabEnabled=t.reelBetaEnabled=void 0,t.reelBetaEnabled=function(){return"OFF"!==n.REEL_FEATURE_FLAG},t.reelBetaSyncCollabEnabled=function(){return"BETA_SYNC"===n.REEL_FEATURE_FLAG||"BETA_VERSIONS_SYNC"===n.REEL_FEATURE_FLAG}})),define("file-transfers/common/constants",["require","exports","file-transfers/common/types"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FEEDBACK_FORM_MAX_COMMENT_LENGTH=t.S3_STATIC_URL=t.DEFAULT_MAX_UNEXPIRED_DAYS=t.DEFAULT_EXPIRATION_OPTION=t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=t.COLOR_STONE=t.BYTES_IN_GIGABYTE=t.BYTES_IN_MEGABYTE=t.BYTES_IN_KILOBYTE=t.MILLISECONDS_IN_DAY=void 0,t.MILLISECONDS_IN_DAY=864e5,t.BYTES_IN_KILOBYTE=1024,t.BYTES_IN_MEGABYTE=1048576,t.BYTES_IN_GIGABYTE=1073741824,t.COLOR_STONE="#637282",t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1,t.DEFAULT_EXPIRATION_OPTION=n.ExpirationOption.SEVEN_DAYS,t.DEFAULT_MAX_UNEXPIRED_DAYS=365,t.S3_STATIC_URL="https://showcase-marketing.dropboxstatic.com/file_transfers/backgrounds/",t.FEEDBACK_FORM_MAX_COMMENT_LENGTH=2e3})),define("file-transfers/common/types",["require","exports"],(function(e,t){"use strict";var n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.TransferShareStatus=t.ExpirationOption=void 0,(n=t.ExpirationOption||(t.ExpirationOption={}))[n.SEVEN_DAYS=7]="SEVEN_DAYS",n[n.THIRTY_DAYS=30]="THIRTY_DAYS",n[n.NINETY_DAYS=90]="NINETY_DAYS",n[n.CUSTOM=0]="CUSTOM",(r=t.TransferShareStatus||(t.TransferShareStatus={})).EXPIRED="expired",r.SHARED="shared"})),define("file-transfers/feedback-form/index",["require","exports","tslib","react","spectrum/radio_button/index","spectrum/input/index","react-intl","file-transfers/common/constants"],(function(e,t,n,r,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackForm=void 0,r=n.__importStar(r),t.FeedbackForm=function(e){var t=e.comment,n=e.rating,i=e.commentPrompt,c=e.onRatingChange,u=e.onCommentsChange,d=a.useIntl(),p=function(e){c(parseInt(e.target.value,10))};return r.createElement("div",{className:"feedback-form"},r.createElement("div",{className:"feedback-form__satisfaction-rating-container"},r.createElement("div",{className:"feedback-form__satisfaction-rating-radio-buttons"},r.createElement(l,{currentRating:n,buttonRating:1,text:r.createElement(a.FormattedMessage,{id:"Ak0AwV",defaultMessage:"Extremely dissatisfied"}),onChange:p}),r.createElement(l,{currentRating:n,buttonRating:2,onChange:p}),r.createElement(l,{currentRating:n,buttonRating:3,text:r.createElement(a.FormattedMessage,{id:"WAMYrD",defaultMessage:"Neutral"}),onChange:p}),r.createElement(l,{currentRating:n,buttonRating:4,onChange:p}),r.createElement(l,{currentRating:n,buttonRating:5,text:r.createElement(a.FormattedMessage,{id:"WAXhkk",defaultMessage:"Extremely satisfied"}),onChange:p}),r.createElement(l,{currentRating:n,buttonRating:s.NOT_APPLICABLE_SATISFACTION_RATING_VALUE,text:r.createElement(a.FormattedMessage,{id:"TFC4CE",defaultMessage:"N/A"}),onChange:p}))),r.createElement("div",{className:"feedback-form__comments-container"},r.createElement("span",{className:"feedback-form__comments-prompt"},r.createElement("label",{htmlFor:"feedback-form__comments-textarea"},i)),r.createElement(o.TextArea,{className:"feedback-form__comments-textarea",id:"feedback-form__comments-textarea",placeholder:d.formatMessage({id:"r60TD+",defaultMessage:"Optional"}),value:t,onChange:function(e){u(e.currentTarget.value)},maxLength:s.FEEDBACK_FORM_MAX_COMMENT_LENGTH})))};var l=function(e){return r.createElement("div",{className:"satisfaction-rating-radio-button-block"},r.createElement(i.RadioButton,{name:"satisfaction-rating-radio-button","aria-checked":e.currentRating===e.buttonRating,checked:e.currentRating===e.buttonRating,id:e.buttonRating.toString(),onChange:e.onChange,value:e.buttonRating,className:"satisfaction-rating-radio-button"}),r.createElement("div",{className:"satisfaction-rating-radio-button-block__label"},r.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-number"},e.buttonRating!==s.NOT_APPLICABLE_SATISFACTION_RATING_VALUE&&e.buttonRating),e.text&&r.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-description"},e.text)))};l.displayName="SatisfactionRatingRadioButtonBlock"})),define("spectrum/tabbed_header/index",["require","exports","tslib","spectrum/tabbed_header/tabbed_header","spectrum/tabbed_header/tab"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.__exportStar(r,t),n.__exportStar(i,t)})),define("spectrum/tabbed_header/tab",["require","exports","tslib","classnames","react","react-aria-tabpanel"],(function(e,t,n,r,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tab=void 0,r=n.__importDefault(r),i=n.__importStar(i),t.Tab=function(e){var t=e.children,a=e.className,s=e.id,l=e.ref,c=n.__rest(e,["children","className","id","ref"]),u=r.default("mc-tabbed-header-tab",a);return i.createElement(o.Tab,Object.assign({id:s,tag:"div",className:u,ref:l},c),(function(e){var n=e.isActive,o=r.default("mc-tabbed-header-tab-content",{"mc-tabbed-header-tab-content-selected":n});return[i.createElement("span",{key:"space",className:"mc-tabbed-header-tab-content-space"},t),i.createElement("span",{key:"content",className:o},t)]}))},t.Tab.displayName="Tab"})),define("spectrum/tabbed_header/tabbed_header",["require","exports","tslib","react","react-aria-tabpanel"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabbedHeader=void 0,r=n.__importStar(r),t.TabbedHeader=function(e){var t=e.children,o=e.onSelection,a=n.__rest(e,["children","onSelection"]);return r.createElement(i.Wrapper,Object.assign({className:"mc-tabbed-header",onChange:o},a),r.createElement(i.TabList,{tag:"ul",className:"mc-tabbed-header-list"},t&&r.Children.map(t,(function(e){return r.createElement("li",{className:"mc-tabbed-header-item",key:e.key||void 0,role:"presentation"},e)}))))},t.TabbedHeader.displayName="TabbedHeader"})),define("modules/clean/react/file_viewer/surface_existing_teams_header",["require","exports","tslib","react","react-intl","dig-components/buttons","modules/clean/react/components/css","modules/core/i18n","modules/clean/react/sprite","modules/clean/react/teams/team_discovery/data/model","modules/clean/react/teams/team_discovery/data/client","modules/clean/react/teams/team_discovery/data/logger","modules/core/notify","modules/clean/react/teams/team_discovery/data/logger","modules/core/browser","api_v2/user_client"],(function(e,t,n,r,i,o,a,s,l,c,u,d,p,m,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SurfaceExistingTeamsHeader=t.SurfaceExistingTeamsHeaderComponent=void 0,r=n.__importStar(r),f=n.__importStar(f);var _=i.defineMessage({id:"JTdDYP",defaultMessage:"Request sent. Watch for your invite at {user_email}"}),h=i.defineMessage({id:"wFT2+k",defaultMessage:"Success! Watch for your invite at {user_email}"}),v=s.intl.formatMessage({id:"xFjOJt",defaultMessage:"Couldn’t send request. Try asking to join in person."}),b=s.intl.formatMessage({id:"cL+GSY",defaultMessage:"Couldn’t send request. Check your connection."}),w=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={submitting:!1},n.logger=new d.Logger,n}return n.__extends(t,e),t.prototype.recordHeaderDismissed=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){switch(n.label){case 0:return[4,(new g.UserApiV2Client).ns("team_discovery").rpc("joinable_teams/dismiss",{team_id:t.id},{subjectUserId:e.id})];case 1:return n.sent(),[2]}}))}))},t.prototype.requestToJoin=function(e,t,n){var r=this,i=new u.LegacyClient,o=s.intl.formatMessage(_,{user_email:e.email}),a=s.intl.formatMessage(h,{user_email:e.email});i.joinTeam(t.id,"preview").then((function(e){switch(e?e.result:void 0){case c.JoinApiResultEnum.RequestSent:p.Notify.success(o),n();break;case c.JoinApiResultEnum.RequestNotSent:e.reason===c.JoinApiRetReason.Conflict?p.Notify.success(o):p.Notify.error(v),n();break;case c.JoinApiResultEnum.CanJoin:p.Notify.success(a),n();break;case void 0:p.Notify.error(b),r.setState({submitting:!1});break;default:p.Notify.error(v),n()}}),(function(){p.Notify.error(b),r.setState({submitting:!1})}))},t.prototype.render=function(){var e=this,t=this.props,n=t.suggestTeamInfo,i=t.dismissHeader,a=t.user,c=s.intl.formatMessage({id:"mkG9ta",defaultMessage:"Are you part of {team_name}?"},{team_name:n.joinableTeam.name}),u=s.intl.formatMessage({id:"xIv/b5",defaultMessage:"Join this Dropbox team for easier collaboration and instant access to team files."});return r.createElement("div",{className:"surface-existing-teams-header"},r.createElement("div",{className:"surface-existing-teams-header__primary-text"},c," "),r.createElement("div",{className:"surface-existing-teams-header__secondary-text"},u," "),r.createElement("div",{className:"surface-existing-teams-header__buttons"},r.createElement(o.Button,{inverse:!0,variant:"primary",className:"surface-existing-teams-header__primary-button",disabled:this.state.submitting,onClick:function(){e.setState({submitting:!0}),e.requestToJoin(a,n.joinableTeam,i);var t="1"===f.get_uri().getQuery().new_user;e.logger.logClickedRequestToJoinEvent(n.joinableTeam.id,a.id,m.TeamJoinRequestOrigin.Preview,t)}},"can_auto_join"===n.joinableTeam.joinTeamRequestState[".tag"]?s.intl.formatMessage({id:"TL22S6",defaultMessage:"Join"}):s.intl.formatMessage({id:"Ugdb/e",defaultMessage:"Ask to Join"})),r.createElement(o.Button,{variant:"transparent",className:"close-button dismiss-x-icon",onClick:function(){e.recordHeaderDismissed(a,n.joinableTeam),i()},"aria-label":s.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"})},r.createElement(l.Sprite,{group:"web",name:"close_small",alt:s.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"})}))))},t})(r.Component);t.SurfaceExistingTeamsHeaderComponent=w,t.SurfaceExistingTeamsHeader=a.requireCssWithComponent(w,["/static/css/file_viewer/surface_existing_teams_header-vflN4Ae2w.css","/static/css/dig-components/index.web-vflx3F5Tv.css"])})),define("modules/clean/react/teams/team_discovery/data/action",["require","exports","tslib","lodash","modules/core/browser","modules/core/i18n","modules/core/notify","modules/clean/react/teams/team_discovery/data/model","modules/clean/react/teams/team_discovery/data/logger","react","modules/clean/react/snackbar","modules/clean/react/teams/team_discovery/data/utils"],(function(e,t,n,r,i,o,a,s,l,c,u,d){"use strict";var p;function m(e){var t=c.default.createElement(u.Snackbar,n.__assign({},e,{closeButtonText:"Close",id:"teamDiscovery"}));u.Snackbar.show(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreator=t.MEMBER_TO_FETCH_LIMIT=t.showSnackbar=t.ActionType=void 0,r=n.__importStar(r),i=n.__importStar(i),c=n.__importDefault(c),(function(e){e.FetchInitData="FetchInitData",e.AskToJoinTeam="AskToJoinTeam",e.PopulateServerProps="PopulateServerProps",e.UpdateRequestState="UpdateRequestState",e.LoadUserData="LoadUserData",e.LoadCurrentAccountData="LoadCurrentAccountData"})(p=t.ActionType||(t.ActionType={})),t.showSnackbar=m,t.MEMBER_TO_FETCH_LIMIT=5;var f=(function(){function e(e,t,n,r,i,o){void 0===o&&(o=!1),this.apiClient=e,this.logger=t,this.selector=n,this.contUrl=r||"/install",this.signupTag=i,this.isViralFlow=o}return e.prototype.redirectAndNotify=function(e,t){var n=this,r=function(){return i.redirect(n.contUrl)};e?a.Notify.success(o.intl.formatMessage({id:"5lxkC0",defaultMessage:"Your request to join the team was sent successfully! Redirecting..."}),t,r):a.Notify.error(o.intl.formatMessage({id:"ZPbWOT",defaultMessage:"Something went wrong with your team join request. Redirecting..."}),t,r)},e.prototype.joinTeamAction=function(e,t,n,r,o,a,c){var u=this;return void 0===r&&(r=!0),void 0===c&&(c=3),function(d,f){d({type:p.UpdateRequestState,payload:{teamId:e.id,requestState:s.RequestState.Sending}});var g=l.TeamSuggestPageDesign.New;return u.apiClient.ns("team_discovery").rpc("joinable_teams/join",{team_id:e.id,source:t,extra:{design:g,origin:t,signup_tag:void 0===u.signupTag?"":u.signupTag,preselect_team_id:void 0===a?"":a.toString()}},{subjectUserId:n}).then((function(n){var l,_,h=n?n.result[".tag"]:void 0;switch(h){case s.JoinApiResultEnum.RequestSent:d({type:p.AskToJoinTeam}),l="ask_to_join",_="request_sent",d({type:p.UpdateRequestState,payload:{teamId:e.id,requestState:s.RequestState.PendingApproval}}),r?u.redirectAndNotify(!0,c):m({title:s.JoinApiRetReasonToLabel(_),variant:"complete"});break;case s.JoinApiResultEnum.RequestNotSent:(_=n.result.reason[".tag"])===s.JoinApiV2RetReason.Conflict?(d({type:p.AskToJoinTeam}),l="ask_to_join",r?u.redirectAndNotify(!0,c):m({title:s.JoinApiRetReasonToLabel(_),variant:"fail"})):(u.logger.logAskToJoinErrorEvent(e.id,u.selector.getTeamDiscoveryStoreState(f()).userId,h||"unknown",_||"unknown",t),r?u.redirectAndNotify(!1,c):m({title:s.JoinApiRetReasonToLabel(_),variant:"fail"})),d({type:p.UpdateRequestState,payload:{teamId:e.id}});break;case s.JoinApiResultEnum.CanJoin:l="can_auto_join",_="can_join",r?u.isViralFlow?u.redirectAndNotify(!0,c):i.redirect(n.result.url):m({title:"Joined team",variant:"complete"}),d({type:p.UpdateRequestState,payload:{teamId:e.id,requestState:s.RequestState.Joined}});break;default:u.logger.logAskToJoinErrorEvent(e.id,u.selector.getTeamDiscoveryStoreState(f()).userId,"unknown","other",t),d({type:p.UpdateRequestState,payload:{teamId:e.id}}),r?u.redirectAndNotify(!1,c):m({title:s.JoinApiRetReasonToLabel("other"),variant:"fail"})}u.logger.logAskToJoinEvent({teamId:e.id,userId:u.selector.getTeamDiscoveryStoreState(f()).userId,joinState:l,reason:_,origin:t,team_index:o,url:"team/discover/suggest",design:g,signupTag:u.signupTag,preselectTeamId:a})}))}},e.prototype.fetchInitialData=function(e,n,l,c){var u=this;return void 0===n&&(n=t.MEMBER_TO_FETCH_LIMIT),void 0===l&&(l=!0),void 0===c&&(c=""),function(t,m){return t({type:p.PopulateServerProps,payload:{userEmail:e.userEmail,userId:e.userId}}),u.apiClient.ns("team_discovery").rpc("joinable_teams/list",{member_to_fetch_limit:n,sharer_dbx_team_id:e.sharerDbxTeamId,include_user_collab_teams:!0},{subjectUserId:e.userId}).then((function(i){var o,a,c,f=r.map(i.values,s.toJoinableTeam);l&&u.logger.logExposedToSETOnSignupPage(u.selector.getTeamDiscoveryStoreState(m()).userId,d.findSignupOriginType(!!e.sharerDbxTeamId,e.signupTag),e.signupTag,f.length,null===(o=d.preselectTeam(f,e.sharerName,e.sharerDbxTeamId))||void 0===o?void 0:o.id,n,null===(a=f[0])||void 0===a?void 0:a.isSameDomain,null===(c=f[0])||void 0===c?void 0:c.isCollaborator),t({type:p.FetchInitData,payload:{joinableTeams:f,domainName:i.domain_name}})})).catch((function(e){if(!c)throw e;var t=o.intl.formatMessage({id:"/uOUwu",defaultMessage:"We encountered an error trying to fetch teams for you to join. Redirecting to the next page..."});a.Notify.error(t,3,(function(){return i.redirect(c)}))}))}},e.prototype.fetchUserData=function(e,t){var n=this;return function(r,i){return n.apiClient.ns("team_discovery").rpc("joinable_teams/user",{dbx_account_id:t},{subjectUserId:e}).then((function(e){r({type:p.LoadUserData,payload:{userId:t,teamId:e.dbx_team_id}})}))}},e.prototype.fetchCurrentAccount=function(e){var t=this;return function(n,r){return t.apiClient.ns("users").rpc("get_current_account",void 0,{subjectUserId:e}).then((function(e){var t;n({type:p.LoadCurrentAccountData,payload:{suggestMembersEnabled:!!(null===(t=e.team)||void 0===t?void 0:t.team_user_permissions.suggest_members_enabled)}})}))}},e.prototype.continueToNextPage=function(e,t){var n=this;return function(r,o){e.preventDefault(),n.logger.logContinueToInstallEvent(n.selector.getTeamDiscoveryStoreState(o()).userId,t),e.metaKey?i.open_tab(n.contUrl):i.redirect(n.contUrl)}},e})();t.ActionCreator=f})),define("modules/clean/react/teams/team_discovery/data/client",["require","exports","modules/clean/deprecated_ajax/ajax_as_promised_jquery"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyClient=void 0;var r=(function(){function e(){}return e.prototype.joinTeam=function(e,t,r,i,o){return n.WebRequest({url:"/team/discover/join_ajax",data:{team_id:e,isServerView:!1,skip_email_verify:!0,source:t,design:r,origin:t,signup_tag:i,preselect_team_id:o}}).then((function(e){if(e)return JSON.parse(e)}))},e})();t.LegacyClient=r})),define("modules/clean/react/teams/team_discovery/data/logger",["require","exports","tslib","modules/clean/analytics","modules/core/browser"],(function(e,t,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.AMPNamespace=t.TeamSuggestPageDesign=t.TeamJoinRequestOrigin=void 0,i=n.__importStar(i);var o,a;(function(e){e.Signup="signup",e.Preview="preview",e.Requests="requests",e.Pass="pass",e.SignupViralInband="signup_viral_inband",e.SignupViralLinksharing="signup_viral_linksharing",e.SurfaceExistingTeamHomepage="surface_existing_teams_homepage",e.ShareRequestAccessPage="share_request_access_page",e.TeamDiscoveryPageRefresh="team_discovery_page_refresh"})(o=t.TeamJoinRequestOrigin||(t.TeamJoinRequestOrigin={})),(function(e){e.New="new",e.Old="old"})(a=t.TeamSuggestPageDesign||(t.TeamSuggestPageDesign={})),(function(e){e.TEAM_DISCOVERY="team_discovery"})(t.AMPNamespace||(t.AMPNamespace={}));var s=(function(){function e(){}return e.prototype.logAskToJoinEvent=function(e){var t=e.teamId,n=e.userId,i=e.joinState,o=e.reason,a=e.origin,s=e.team_index,l=e.url,c=e.design,u=e.signupTag,d=e.preselectTeamId,p=e.numAskToJoin,m=e.numAutoJoin;r.TeamsWebActionsLogger.log("clicked_req_to_join",{team_id:t,user_id:n,url:l,join_state:i,reason:o,origin:a,design:c,signup_tag:u,preselect_team_id:d,team_index:s+1,num_ask_to_join:p,num_auto_join:m})},e.prototype.logAskToJoinErrorEvent=function(e,t,n,i,o){r.TeamsWebActionsLogger.log("requested_access_to_team_error",{team_id:e,user_id:t,url:"team/discover/suggest",join_state:n,reason:i,origin:o})},e.prototype.logAcceptInvitation=function(e){r.TeamsWebActionsLogger.log("clicked_accept_invite",{team_id:e})},e.prototype.logTeamDiscoveryPageSeen=function(e,t,n){for(var o,a=[],s=[],l=[],c=[],u=0,d=e;u<d.length;u++){var p=d[u];"request_approved"===p.joinTeamRequestState[".tag"]?a.push(p):"waiting_for_approval"===p.joinTeamRequestState[".tag"]?s.push(p):"can_auto_join"===p.joinTeamRequestState[".tag"]?l.push(p):"approval_required"===p.joinTeamRequestState[".tag"]&&c.push(p)}o={has_pending_invite:!!t,has_outstanding_request:s.length>0,has_approved_request:a.length>0,num_auto_join:l.length,num_ask_to_join:c.length,verified:n,_tk:i.get_pathname(),url:i.get_uri().toString()},r.TeamsWebActionsLogger.log_for_category("saw_team_promo_page",r.TeamsWebActionsLogger.LOG_CATEGORY.PROMO_TEAMS,o)},e.prototype.logClickCancelJoinRequest=function(e,t){r.TeamsWebActionsLogger.log("cancel_request_to_join",{num_team_members:t,origin:o.TeamDiscoveryPageRefresh,source:"team_discovery_page",team_id:e})},e.prototype.logClickStartNewTeamLink=function(){r.TeamsWebActionsLogger.log("clicked_create_team_cta")},e.prototype.logEmailVerificationModalShown=function(e,t){r.TeamsWebActionsLogger.log("email_verification_modal_shown",{user_id:e,team_id:t})},e.prototype.logEmailVerifiedSnackbarShown=function(e){r.TeamsWebActionsLogger.log("email_verified_snackbar_shown",{user_id:e})},e.prototype.logContinueToInstallEvent=function(e,t){void 0===t&&(t=!1),r.TeamsWebActionsLogger.log("surface_existing_team_continue_to_install",{user_id:e,url:"team/discover/suggest",is_cancel:t},(function(){}),e)},e.prototype.logExposedToSETOnPreviewEvent=function(e,t,n,i,o,a,s){r.TeamsWebActionsLogger.log("exposed_to_set_on_preview",{team_id:o,user_id:e,url:"scl/fi/:sckey/:file_name",is_cdm_member:t,user_root_permissions:n,team_member_count:a,saw_ask_to_join:i,is_new_user:s},(function(){}),e)},e.prototype.logClickedRequestToJoinEvent=function(e,t,n,i){r.TeamsWebActionsLogger.log("clicked_req_to_join",{team_id:e,user_id:t,url:"scl/fi/:sckey/:file_name",origin:n,is_new_user:i},(function(){}),t)},e.prototype.logExposedToSETOnSignupPage=function(e,t,n,i,o,s,l,c){r.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page",{design:a.New,origin:t,signup_tag:n,number_of_teams:i,preselect_team_id:o,member_to_fetch_limit:s,first_team_same_domain:l,first_team_tc:c},(function(){}),e)},e.prototype.logExposedToSETOnSignupPageLoadingScreen=function(e,t){r.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page_loading",{origin:t},(function(){}),e)},e.prototype.logUserSelectedJoinableTeam=function(e,t,n,r,i){this._logUserJoinableTeamChoice("user_selected_joinable_team",e,t,n,r,i)},e.prototype.logUserUnselectedJoinableTeam=function(e,t,n,r,i){this._logUserJoinableTeamChoice("user_unselected_joinable_team",e,t,n,r,i)},e.prototype._logUserJoinableTeamChoice=function(e,t,n,i,o,s){r.TeamsWebActionsLogger.log(e,{team_id:t,design:a.New,origin:i,signup_tag:o,preselect_team_id:s},(function(){}),n)},e})();t.Logger=s})),define("modules/clean/react/teams/team_discovery/data/model",["require","exports","tslib","lodash","modules/core/i18n"],(function(e,t,n,r,i){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.toTeamInvite=t.toJoinableTeam=t.Pages=t.RequestState=t.JoinApiRetReasonToLabel=t.JoinApiV2RetReason=t.JoinApiRetReason=t.JoinApiResultEnum=void 0,r=n.__importStar(r),(function(e){e.RequestSent="request_sent",e.RequestNotSent="request_not_sent",e.CanJoin="can_join"})(t.JoinApiResultEnum||(t.JoinApiResultEnum={})),(function(e){e[e.Conflict=5]="Conflict"})(t.JoinApiRetReason||(t.JoinApiRetReason={})),(function(e){e.ExistsSameTeam="exists_same_team",e.ExistsDifferentTeam="exists_different_team",e.Conflict="conflict",e.MaxTeamSizeAchieved="max_team_size_achieved",e.Rejected="rejected",e.Other="other"})(t.JoinApiV2RetReason||(t.JoinApiV2RetReason={})),t.JoinApiRetReasonToLabel=function(e){return{request_sent:i.intl.formatMessage({id:"sQbTsQ",defaultMessage:"Request sent. Once it’s approved, you’ll get an invite from the team."}),exists_same_team:i.intl.formatMessage({id:"oZNXJZ",defaultMessage:"Looks like you’ve already asked to join this team."}),exists_different_team:i.intl.formatMessage({id:"mHIpiE",defaultMessage:"Looks like you already asked to join a different team."}),rejected:i.intl.formatMessage({id:"H8TlMC",defaultMessage:"Looks like this team already denied your request."}),max_team_size_achieved:i.intl.formatMessage({id:"dEJ+SP",defaultMessage:"Looks like this team size has already been reached"})}[e]||i.intl.formatMessage({id:"s86tt6",defaultMessage:"Couldn’t send request. Try asking to join in person."})},(function(e){e.Sending="sending",e.PendingApproval="pending_approval",e.Joined="joined"})(o=t.RequestState||(t.RequestState={})),(function(e){e.Suggest="TeamDiscovery/Suggest",e.Confirm="TeamDiscovery/Confirm"})(t.Pages||(t.Pages={})),t.toJoinableTeam=function(e){return{dbxTeamId:e.dbx_team_id,id:e.team_id,name:e.team_name,adminsCount:e.admins_count,membersCount:e.members_count,requestState:e.pending_request?o.PendingApproval:void 0,joinTeamRequestState:e.join_request_state,joinRequestStateDate:e.join_request_state_date,isSameDomain:e.is_same_domain,isCollaborator:e.is_collaborator,sharedFolderCount:e.shared_folder_count,sharedFileCount:e.shared_file_count,lastShareTimestamp:e.last_share_timestamp,members:r.map(e.members,(function(e){return{memberId:e.member_id,name:e.member_name,isAdmin:e.is_admin,avatarURL:e.photo_url}}))}},t.toTeamInvite=function(e){return null==e?null:{teamId:e.team_id,userName:e.inviting_user_name,signupKey:e.signup_key,isNewInviteLinkInvitation:e.is_new_invite_link_invitation}}})),define("modules/clean/react/teams/team_discovery/data/utils",["require","exports","tslib","react","modules/clean/react/teams/team_discovery/data/logger","modules/core/i18n"],(function(e,t,n,r,i,o){"use strict";function a(e,t,n){var r=o.intl.formatMessage({id:"Om3b8J",defaultMessage:"{remainder, plural, =0{{adminName}} one{{adminName} + {remainder} more} few{{adminName} + {remainder} more} other{{adminName} + {remainder} more}}"},{adminName:e,remainder:t-1});return n?o.intl.formatMessage({id:"LQZIyx",defaultMessage:"{teamAdminCount, plural, one{Admin: {adminList}} other{Admins: {adminList}}}"},{teamAdminCount:t,adminList:r}):o.intl.formatMessage({id:"T2wYhx",defaultMessage:"{teamAdminCount, plural, one{Team admin: {adminList}} other{Team admins: {adminList}}}"},{teamAdminCount:t,adminList:r})}Object.defineProperty(t,"__esModule",{value:!0}),t.getSharedContentCountsText=t.toFacepileMember=t.getLastShareTimeStr=t.getSharedFolderCountStr=t.getAdminNamesStrForTeam=t.getAdminNamesStr=t.shouldShowTeamCollabContext=t.preselectTeam=t.findSignupOriginType=void 0,r=n.__importDefault(r),t.findSignupOriginType=function(e,t){return e?"shared_content_link_register"===t?i.TeamJoinRequestOrigin.SignupViralInband:i.TeamJoinRequestOrigin.SignupViralLinksharing:i.TeamJoinRequestOrigin.Signup},t.preselectTeam=function(e,t,n){var r=e[0],i=1===e.length,o=t&&n&&r&&r.dbxTeamId===n;return i||o?r:void 0},t.shouldShowTeamCollabContext=function(e){return Array.isArray(e)||(e=[e]),e.length>0&&e.every((function(e){return void 0!==e.sharedFolderCount}))},t.getAdminNamesStr=a,t.getAdminNamesStrForTeam=function(e,t){return a((function(e){var t=e.members.find((function(e){return e.isAdmin}));if(void 0===t)throw new Error("No admin on team given to team card");return t.name})(e),e.adminsCount,t)},t.getSharedFolderCountStr=function(e){return o.intl.formatMessage({id:"8Izk7L",defaultMessage:"Shared {sharedFolderCount} {sharedFolderCount, plural, one {folder} other {folders}} with you"},{sharedFolderCount:e})},t.getLastShareTimeStr=function(e){return o.intl.formatMessage({id:"1Yl7QT",defaultMessage:"Last worked together {lastShareDate, date, medium}"},{lastShareDate:new Date(1e3*e)})},t.toFacepileMember=function(e){return{memberKey:e.memberId.toString(),active:!0,alt:null,avatarColorSeed:e.memberId.toString(),initials:e.name.charAt(0),photoUrl:void 0===e.avatarURL?null:e.avatarURL,tooltipContent:r.default.createElement("div",null,e.name)}},t.getSharedContentCountsText=function(e){var t,n,r=(null!==(t=e.sharedFolderCount)&&void 0!==t?t:0)>0,i=(null!==(n=e.sharedFileCount)&&void 0!==n?n:0)>0,a={sharedContextText:o.intl.formatMessage({id:"VbL6qJ",defaultMessage:"Shared with you:"}),getFolderInfoText:function(e){return o.intl.formatMessage({id:"RUN5MW",defaultMessage:"{folderCount, plural, one {# folder} other {# folders}}"},{folderCount:e.sharedFolderCount})},getFileInfoText:function(e){return o.intl.formatMessage({id:"7Ql6Hu",defaultMessage:"{fileCount, plural, one {# file} other {# files}}"},{fileCount:e.sharedFileCount})}},s=a.sharedContextText,l=a.getFolderInfoText,c=a.getFileInfoText;return r&&i?s+" "+l(e)+", "+c(e):r?s+" "+l(e):i?s+" "+c(e):null}})),define("prod_assets_web_modules/react-aria-tabpanel",["react","./common/_commonjsHelpers"],(function(e,t){"use strict";var n=(function(e){return e&&e.__esModule?e:{default:e}})(e);function r(){}function i(){}i.resetWarningCache=r;var o=t.createCommonjsModule((function(e){e.exports=(function(){function e(e,t,n,r,i,o){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==o){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:r};return n.PropTypes=n,n})()})),a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;function c(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var u=(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}})()?Object.assign:function(e,t){for(var n,r,i=c(e),o=1;o<arguments.length;o++){for(var u in n=Object(arguments[o]))s.call(n,u)&&(i[u]=n[u]);if(a){r=a(n);for(var d=0;d<r.length;d++)l.call(n,r[d])&&(i[r[d]]=n[r[d]])}}return i},d={},p=function(e,t,n,r,i,o,a,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,i,o,a,s],u=0;(l=new Error(t.replace(/%s/g,(function(){return c[u++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}};if(void 0===n.default)throw Error("create-react-class could not find the React object. If you are using script tags, make sure that React is being loaded before create-react-class.");var m=(new n.default.Component).updater,f=(function(e,t,n){var r=[],i={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",UNSAFE_componentWillMount:"DEFINE_MANY",UNSAFE_componentWillReceiveProps:"DEFINE_MANY",UNSAFE_componentWillUpdate:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"},o={getDerivedStateFromProps:"DEFINE_MANY_MERGED"},a={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)l(e,t[n])},childContextTypes:function(e,t){e.childContextTypes=u({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=u({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=m(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,t){e.propTypes=u({},e.propTypes,t)},statics:function(e,t){!(function(e,t){if(t)for(var n in t){var r=t[n];if(t.hasOwnProperty(n)){if(p(!(n in a),'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',n),n in e){var i=o.hasOwnProperty(n)?o[n]:null;return p("DEFINE_MANY_MERGED"===i,"ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",n),void(e[n]=m(e[n],r))}e[n]=r}}})(e,t)},autobind:function(){}};function s(e,t){var n=i.hasOwnProperty(t)?i[t]:null;v.hasOwnProperty(t)&&p("OVERRIDE_BASE"===n,"ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",t),e&&p("DEFINE_MANY"===n||"DEFINE_MANY_MERGED"===n,"ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",t)}function l(e,n){if(n){p("function"!=typeof n,"ReactClass: You're attempting to use a component class or function as a mixin. Instead, just use a regular object."),p(!t(n),"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object.");var r=e.prototype,o=r.__reactAutoBindPairs;for(var l in n.hasOwnProperty("mixins")&&a.mixins(e,n.mixins),n)if(n.hasOwnProperty(l)&&"mixins"!==l){var c=n[l],u=r.hasOwnProperty(l);if(s(u,l),a.hasOwnProperty(l))a[l](e,c);else{var d=i.hasOwnProperty(l);if("function"!=typeof c||d||u||!1===n.autobind)if(u){var g=i[l];p(d&&("DEFINE_MANY_MERGED"===g||"DEFINE_MANY"===g),"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",g,l),"DEFINE_MANY_MERGED"===g?r[l]=m(r[l],c):"DEFINE_MANY"===g&&(r[l]=f(r[l],c))}else r[l]=c;else o.push(l,c),r[l]=c}}}}function c(e,t){for(var n in p(e&&t&&"object"==typeof e&&"object"==typeof t,"mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects."),t)t.hasOwnProperty(n)&&(p(void 0===e[n],"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",n),e[n]=t[n]);return e}function m(e,t){return function(){var n=e.apply(this,arguments),r=t.apply(this,arguments);if(null==n)return r;if(null==r)return n;var i={};return c(i,n),c(i,r),i}}function f(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function g(e,t){return t.bind(e)}var _={componentDidMount:function(){this.__isMounted=!0}},h={componentWillUnmount:function(){this.__isMounted=!1}},v={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e,t)},isMounted:function(){return!!this.__isMounted}},b=function(){};return u(b.prototype,e.prototype,v),function(e){var t=function(e,r,i){this.__reactAutoBindPairs.length&&(function(e){for(var t=e.__reactAutoBindPairs,n=0;n<t.length;n+=2){var r=t[n],i=t[n+1];e[r]=g(e,i)}})(this),this.props=e,this.context=r,this.refs=d,this.updater=i||n,this.state=null;var o=this.getInitialState?this.getInitialState():null;p("object"==typeof o&&!Array.isArray(o),"%s.getInitialState(): must return an object or null",t.displayName||"ReactCompositeComponent"),this.state=o};for(var o in t.prototype=new b,t.prototype.constructor=t,t.prototype.__reactAutoBindPairs=[],r.forEach(l.bind(null,t)),l(t,_),l(t,e),l(t,h),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),p(t.prototype.render,"createClass(...): Class specification must implement a `render` method."),i)t.prototype[o]||(t.prototype[o]=null);return t}})(n.default.Component,n.default.isValidElement,m),g=function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&(e[r]||n[r]||(e[r]=t[r]))},_={children:o.oneOfType([o.node,o.func]).isRequired,id:o.string.isRequired,tag:o.string,role:o.string,index:o.number,active:o.bool,letterNavigationText:o.string},h=f({displayName:"AriaTabPanel-Tab",propTypes:_,getDefaultProps:function(){return{tag:"div",role:"tab"}},contextTypes:{atpManager:o.object.isRequired},getInitialState:function(){return{isActive:this.context.atpManager.memberStartsActive(this.props.id)||!1}},handleFocus:function(){this.context.atpManager.handleTabFocus(this.props.id)},handleRef:function(e){e&&(this.elRef=e,this.registerWithManager(this.elRef))},updateActiveState:function(e){this.setState({isActive:e})},registerWithManager:function(e){this.isRegistered||(this.isRegistered=!0,this.context.atpManager.registerTab({id:this.props.id,node:e,update:this.updateActiveState,index:this.props.index,letterNavigationText:this.props.letterNavigationText,active:void 0===this.props.active?this.state.isActive:this.props.active}))},unregisterWithManager:function(){var e=this.props;this.context.atpManager.unregisterTab(e.id)},render:function(){var e=this.props,t=void 0===e.active?this.state.isActive:e.active,r="function"==typeof e.children?e.children({isActive:t}):e.children,i={id:e.id,tabIndex:t?0:-1,onClick:this.handleClick,onFocus:this.handleFocus,role:e.role,"aria-selected":t,"aria-controls":this.context.atpManager.getTabPanelId(e.id),ref:this.handleRef};return g(i,e,_),n.default.createElement(e.tag,i,r)},componentWillUnmount:function(){this.unregisterWithManager()}}),v={children:o.node.isRequired,tag:o.string,role:o.string},b=f({displayName:"AriaTabPanel-TabList",propTypes:v,getDefaultProps:function(){return{tag:"div",role:"tablist"}},render:function(){var e=this.props,t={role:e.role};return g(t,e,v),n.default.createElement(e.tag,t,e.children)}}),w={children:o.oneOfType([o.node,o.func]).isRequired,tabId:o.string.isRequired,tag:o.string,role:o.string,active:o.bool},y=f({displayName:"AriaTabPanel-TabPanel",propTypes:w,getDefaultProps:function(){return{tag:"div",role:"tabpanel"}},contextTypes:{atpManager:o.object.isRequired},getInitialState:function(){return{isActive:this.context.atpManager.memberStartsActive(this.props.tabId)||!1}},handleKeyDown:function(e){e.ctrlKey&&"ArrowUp"===e.key&&(e.preventDefault(),this.context.atpManager.focusTab(this.props.tabId))},updateActiveState:function(e){this.setState({isActive:e})},registerWithManager:function(e){this.isRegistered||(this.isRegistered=!0,this.context.atpManager.registerTabPanel({node:e,update:this.updateActiveState,tabId:this.props.tabId}))},render:function(){var e=this.props,t=void 0===e.active?this.state.isActive||!1:e.active,r="function"==typeof e.children?e.children({isActive:t}):e.children,i=e.style||{};t||(i.display="none");var o={className:e.className,id:this.context.atpManager.getTabPanelId(e.tabId),onKeyDown:this.handleKeyDown,role:e.role,style:i,"aria-hidden":!t,"aria-describedby":e.tabId,ref:this.registerWithManager};return g(o,e,w),n.default.createElement(e.tag,o,r)}});function S(e){e=e||{},this._settings={forwardArrows:e.forwardArrows||["down"],backArrows:e.backArrows||["up"],wrap:e.wrap,stringSearch:e.stringSearch,stringSearchDelay:800},this._searchString="",this._members=[],e.members&&this.setMembers(e.members),this._boundHandleKeydownEvent=this._handleKeydownEvent.bind(this)}function E(e){e&&e.focus&&(e.focus(),"input"===e.tagName.toLowerCase()&&e.select())}function P(e){this.options=e;var t={wrap:!0,forwardArrows:["down","right"],backArrows:["up","left"],stringSearch:e.letterNavigation};this.focusGroup=(function(e){return new S(e)})(t),this.tabs=[],this.tabPanels=[],this.activeTabId=e.activeTabId}S.prototype.activate=function(){return document.addEventListener("keydown",this._boundHandleKeydownEvent,!0),this},S.prototype.deactivate=function(){return document.removeEventListener("keydown",this._boundHandleKeydownEvent,!0),this._clearSearchStringRefreshTimer(),this},S.prototype._handleKeydownEvent=function(e){if(-1!==this._getActiveElementIndex()){var t=(function(e){return"ArrowUp"===e.key||38===e.keyCode?"up":"ArrowDown"===e.key||40===e.keyCode?"down":"ArrowLeft"===e.key||37===e.keyCode?"left":"ArrowRight"===e.key||39===e.keyCode?"right":null})(e);if(t)return-1!==this._settings.forwardArrows.indexOf(t)?(e.preventDefault(),void this.moveFocusForward()):-1!==this._settings.backArrows.indexOf(t)?(e.preventDefault(),void this.moveFocusBack()):void 0;this._handleNonArrowKey(e)}},S.prototype.moveFocusForward=function(){var e,t=this._getActiveElementIndex();return e=t<this._members.length-1?t+1:this._settings.wrap?0:t,this.focusNodeAtIndex(e),e},S.prototype.moveFocusBack=function(){var e,t=this._getActiveElementIndex();return e=t>0?t-1:this._settings.wrap?this._members.length-1:t,this.focusNodeAtIndex(e),e},S.prototype._handleNonArrowKey=function(e){if(this._settings.stringSearch){if(""!==this._searchString&&(" "===e.key||32===e.keyCode))return e.preventDefault(),-1;if(!((t=e.keyCode)>=65&&t<=90))return-1;var t;if(e.ctrlKey||e.metaKey||e.altKey)return-1;e.preventDefault(),this._addToSearchString(String.fromCharCode(e.keyCode)),this._runStringSearch()}},S.prototype._clearSearchString=function(){this._searchString=""},S.prototype._addToSearchString=function(e){this._searchString+=e.toLowerCase()},S.prototype._startSearchStringRefreshTimer=function(){var e=this;this._clearSearchStringRefreshTimer(),this._stringSearchTimer=setTimeout((function(){e._clearSearchString()}),this._settings.stringSearchDelay)},S.prototype._clearSearchStringRefreshTimer=function(){clearTimeout(this._stringSearchTimer)},S.prototype._runStringSearch=function(){this._startSearchStringRefreshTimer(),this.moveFocusByString(this._searchString)},S.prototype.moveFocusByString=function(e){for(var t,n=0,r=this._members.length;n<r;n++)if((t=this._members[n]).text&&0===t.text.indexOf(e))return E(t.node)},S.prototype._findIndexOfNode=function(e){for(var t=0,n=this._members.length;t<n;t++)if(this._members[t].node===e)return t;return-1},S.prototype._getActiveElementIndex=function(){return this._findIndexOfNode(document.activeElement)},S.prototype.focusNodeAtIndex=function(e){var t=this._members[e];return t&&E(t.node),this},S.prototype.addMember=function(e,t){var n=e.node||e,r=e.text||n.getAttribute("data-focus-group-text")||n.textContent||"";return this._checkNode(n),e={node:n,text:r.replace(/[\W_]/g,"").toLowerCase()},null!=t?this._members.splice(t,0,e):this._members.push(e),this},S.prototype.removeMember=function(e){var t="number"==typeof e?e:this._findIndexOfNode(e);if(-1!==t)return this._members.splice(t,1),this},S.prototype.clearMembers=function(){return this._members=[],this},S.prototype.setMembers=function(e){this.clearMembers();for(var t=0,n=e.length;t<n;t++)this.addMember(e[t]);return this},S.prototype.getMembers=function(){return this._members},S.prototype._checkNode=function(e){if(!e.nodeType||e.nodeType!==window.Node.ELEMENT_NODE)throw new Error("focus-group: only DOM nodes allowed");return e},P.prototype.activate=function(){this.focusGroup.activate()},P.prototype.memberStartsActive=function(e){return this.activeTabId===e||void 0===this.activeTabId&&(this.activeTabId=e,!0)},P.prototype.registerTab=function(e){void 0===e.index?this.tabs.push(e):this.tabs.splice(e.index,0,e);var t=e.letterNavigationText?{node:e.node,text:e.letterNavigationText}:e.node;this.focusGroup.addMember(t,e.index);var n=this.activeTabId;(!this.activeTabId||e.active&&e.id!==this.activeTabId)&&(n=e.id),this.activateTab(n)},P.prototype.unregisterTab=function(e){var t,n;this.tabs&&this.tabs.length>0&&(this.tabs.forEach((function(r,i){r.id===e&&(t=i,n=r)})),n&&n.node&&(this.tabs.splice(t,1),this.focusGroup.removeMember(n.node)))},P.prototype.registerTabPanel=function(e){this.tabPanels.push(e),this.activateTab(this.activeTabId),this.activateTab(this.activeTabId||e.tabId)},P.prototype.activateTab=function(e){e!==this.activeTabId&&(this.activeTabId=e,this.options.onChange?this.options.onChange(e):(this.tabPanels.forEach((function(t){t.update(e===t.tabId)})),this.tabs.forEach((function(t){t.update(e===t.id)}))))},P.prototype.handleTabFocus=function(e){this.activateTab(e)},P.prototype.focusTab=function(e){var t=this.tabs.find((function(t){return t.id===e}));t&&t.node.focus()},P.prototype.destroy=function(){this.focusGroup.deactivate()},P.prototype.getTabPanelId=function(e){return e+"-panel"};var C={children:o.node.isRequired,activeTabId:o.string,letterNavigation:o.bool,onChange:o.func,tag:o.string};return{Tab:h,TabList:b,TabPanel:y,Wrapper:f({displayName:"AriaTabPanel-Wrapper",propTypes:C,getDefaultProps:function(){return{tag:"div"}},childContextTypes:{atpManager:o.object.isRequired},getChildContext:function(){return{atpManager:this.manager}},componentWillMount:function(){this.manager=new P({onChange:this.props.onChange,activeTabId:this.props.activeTabId,letterNavigation:this.props.letterNavigation})},componentWillUnmount:function(){this.manager.destroy()},componentDidMount:function(){this.manager.activate()},componentDidUpdate:function(e){e.activeTabId===this.manager.activeTabId&&e.activeTabId!==this.props.activeTabId&&this.manager.activateTab(this.props.activeTabId)},render:function(){var e=this.props,t={};return g(t,e,C),n.default.createElement(e.tag,t,e.children)}})}}));
//# sourceMappingURL=pkg-file_viewer.min.js-vflazJiiB.map